#!/usr/bin/env node
import fs from 'node:fs';
import path from 'node:path';

const cwd = process.cwd();
const pkgPath = path.join(cwd, 'package.json');
const outPath = path.join(cwd, 'src', 'build-info.ts');

const mode = String(process.env.BUILD_MODE || process.env.RCC_BUILD_MODE || 'release').toLowerCase();
const valid = new Set(['dev', 'release']);
const buildMode = valid.has(mode) ? mode : 'release';

let version = '0.0.0';
try {
  version = JSON.parse(fs.readFileSync(pkgPath, 'utf-8')).version || version;
} catch {}

const content = `// Auto-generated by scripts/gen-build-info.mjs
export interface BuildInfo { mode: 'dev' | 'release'; version: string; buildTime: string }
export const buildInfo: BuildInfo = {
  mode: '${buildMode}',
  version: '${version}',
  buildTime: '${new Date().toISOString()}'
};
`;

fs.mkdirSync(path.dirname(outPath), { recursive: true });
fs.writeFileSync(outPath, content, 'utf-8');
console.log(`[build-info] mode=${buildMode} version=${version} â†’ ${outPath}`);

