<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>RouteCodex Token Daemon é¢„è§ˆï¼ˆæ ‘çŠ¶è§†å›¾ï¼‰</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #020617;
      color: #e5e7eb;
    }
    header {
      padding: 14px 20px;
      border-bottom: 1px solid #111827;
      background: radial-gradient(circle at top left, #1d4ed8 0, #020617 50%);
    }
    header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
    header .subtitle {
      font-size: 12px;
      color: #cbd5f5;
      margin-top: 4px;
    }
    header .meta {
      margin-top: 4px;
      font-size: 11px;
      color: #9ca3af;
    }
    main {
      padding: 12px 20px 24px;
    }
    .layout {
      display: flex;
      gap: 16px;
    }
    .panel {
      flex: 1;
      min-width: 0;
      background-color: #020617;
      border-radius: 10px;
      border: 1px solid #111827;
      padding: 10px 12px 12px;
    }
    .panel h2 {
      margin: 0 0 8px;
      font-size: 14px;
      font-weight: 500;
    }
    .panel .hint {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 6px;
    }
    .mono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 12px;
    }

    /* Tree */
    .tree {
      font-size: 12px;
      line-height: 1.4;
    }
    .tree ul {
      list-style: none;
      margin: 0;
      padding-left: 16px;
      border-left: 1px solid #1f2937;
    }
    .tree-root {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tree-node {
      position: relative;
      padding: 3px 0 3px 12px;
    }
    .tree-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .tree-node::before {
      content: "";
      position: absolute;
      left: 0;
      top: 10px;
      width: 10px;
      height: 1px;
      background-color: #1f2937;
    }
    .icon {
      font-size: 11px;
      opacity: 0.8;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0 6px;
      border-radius: 999px;
      font-size: 10px;
      border: 1px solid transparent;
    }
    .badge.online {
      background-color: rgba(34, 197, 94, 0.15);
      border-color: rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
    }
    .badge.offline {
      background-color: rgba(148, 163, 184, 0.15);
      border-color: rgba(148, 163, 184, 0.5);
      color: #e5e7eb;
    }
    .badge.apikey {
      background-color: rgba(59, 130, 246, 0.1);
      border-color: rgba(59, 130, 246, 0.6);
      color: #bfdbfe;
    }
    .badge.oauth {
      background-color: rgba(52, 211, 153, 0.1);
      border-color: rgba(52, 211, 153, 0.6);
      color: #a7f3d0;
    }
    .badge.none {
      background-color: rgba(156, 163, 175, 0.1);
      border-color: rgba(156, 163, 175, 0.6);
      color: #e5e7eb;
    }
    .badge.status-valid {
      background-color: rgba(34, 197, 94, 0.15);
      border-color: rgba(34, 197, 94, 0.5);
      color: #bbf7d0;
    }
    .badge.status-expiring {
      background-color: rgba(234, 179, 8, 0.15);
      border-color: rgba(234, 179, 8, 0.5);
      color: #facc15;
    }
    .badge.status-expired {
      background-color: rgba(239, 68, 68, 0.15);
      border-color: rgba(239, 68, 68, 0.5);
      color: #fecaca;
    }
    .badge.status-invalid {
      background-color: rgba(148, 163, 184, 0.15);
      border-color: rgba(148, 163, 184, 0.5);
      color: #e5e7eb;
    }
    .scope-switch {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 11px;
    }
    .scope-pill {
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #1f2937;
      background-color: #020617;
      color: #9ca3af;
      cursor: default;
    }
    .scope-pill.active {
      border-color: rgba(59, 130, 246, 0.7);
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.35), #020617 60%);
      color: #e5e7eb;
    }
    .tag {
      padding: 0 4px;
      border-radius: 4px;
      border: 1px solid #1f2937;
      font-size: 10px;
      color: #9ca3af;
      background-color: #020617;
    }
    .dim {
      color: #6b7280;
    }
  </style>
</head>
<body>
  <header>
    <h1>RouteCodex Token Daemon é¢„è§ˆ</h1>
    <div class="subtitle">æ ‘çŠ¶ç»“æ„ï¼šæœåŠ¡å™¨ â†’ Providers â†’ Tokens / Tokens â†’ Used By</div>
    <div class="meta">
      æ‰€æœ‰æ•°æ®ä¸ºé™æ€ç¤ºä¾‹ï¼Œç»“æ„å¯¹é½ CLI è¾“å‡ºï¼š<span class="mono">token-daemon servers/providers/tokens --json</span>ï¼›
      ç³»ç»Ÿç»Ÿè®¡å¯¹åº” <span class="mono">StatsSnapshot</span>ï¼ˆ<span class="mono">router.global</span> / <span class="mono">providers.global</span>ï¼‰
    </div>
  </header>

  <main>
    <!-- é¡¶éƒ¨ç»Ÿè®¡åŒº -->
    <section style="margin-bottom: 12px; display:flex; gap:12px; flex-wrap:wrap;">
      <div style="flex:1; min-width:180px; background:#020617; border:1px solid #111827; border-radius:10px; padding:8px 10px;">
        <div style="font-size:11px; color:#9ca3af; margin-bottom:4px;">ç³»ç»Ÿç»Ÿè®¡ï¼ˆVirtual Routerï¼‰</div>
        <div class="scope-switch">
          <span class="dim">èŒƒå›´ï¼š</span>
          <span class="scope-pill active">å½“å‰ Serverï¼ˆlocal-5555ï¼‰</span>
          <span class="scope-pill">å½“å‰ Configï¼ˆ~/.routecodex/config.jsonï¼‰</span>
          <span class="scope-pill">æ‰€æœ‰ Server</span>
          <span class="scope-pill">æ‰€æœ‰ Config</span>
        </div>
        <div class="dim" style="font-size:11px; margin-bottom:4px;">
          ç¤ºä¾‹ï¼šå½“å‰ Server è§†è§’ï¼Œå¯¹åº”è¯¥è¿›ç¨‹çš„ <span class="mono">StatsSnapshot.router.global</span> /
          <span class="mono">StatsSnapshot.providers.global</span>
        </div>
        <div style="display:flex; flex-wrap:wrap; gap:12px; font-size:12px;">
          <div>
            <div class="dim" style="font-size:11px;">Requests</div>
            <div class="mono">
              12,345
              <span class="dim">(router.global.requestCount)</span>
            </div>
          </div>
          <div>
            <div class="dim" style="font-size:11px;">Success / Error</div>
            <div class="mono">
              12,000 / 345
              <span class="dim">(providers.global.successCount / errorCount)</span>
            </div>
          </div>
          <div>
            <div class="dim" style="font-size:11px;">Avg Latency</div>
            <div class="mono">
              210 ms
              <span class="dim">(providers.global.latencySumMs / requestCount)</span>
            </div>
          </div>
          <div>
            <div class="dim" style="font-size:11px;">Tokens</div>
            <div class="mono">
              prompt=23k / completion=18k / total=41k
              <span class="dim">(providers.global.usage)</span>
            </div>
          </div>
        </div>
      </div>
      <div style="flex:0 0 220px; min-width:200px; background:#020617; border:1px solid #111827; border-radius:10px; padding:8px 10px;">
        <div style="font-size:11px; color:#9ca3af; margin-bottom:4px;">æ“ä½œ</div>
        <div style="display:flex; flex-direction:column; gap:6px;">
          <button style="font-size:12px; padding:4px 8px; border-radius:6px; border:none; cursor:default; background:linear-gradient(90deg,#4f46e5,#06b6d4); color:#f9fafb;">
            âŸ³ é‡å¯æ‰€æœ‰å—å½±å“çš„ Providers
          </button>
          <div class="dim" style="font-size:11px;">
            å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œå¯ä»¥è°ƒç”¨åç«¯ APIï¼Œä¾‹å¦‚ï¼š
            <span class="mono">routecodex restart</span>ï¼ˆå¹¿æ’­ï¼‰æˆ– <span class="mono">routecodex restart --port &lt;port&gt;</span>ï¼ˆæŒ‡å®šç«¯å£ï¼‰ã€‚
          </div>
        </div>
      </div>
    </section>

    <div class="layout">
      <!-- å·¦ä¾§ï¼šServer â†’ Providers â†’ Tokens è§†è§’ -->
      <section class="panel">
        <h2>Server è§†è§’ï¼ˆè‡ªä¸Šè€Œä¸‹ï¼‰</h2>
        <div class="hint">
          å…¥å£ï¼š<span class="mono">servers + providers</span>ï¼ŒæŒ‰ã€ŒæœåŠ¡å™¨ â†’ Provider â†’ TokenFileã€ç»„ç»‡ã€‚
        </div>

        <div class="tree">
          <div class="tree-root">
            <span class="icon">ğŸ–¥</span>
            <span class="mono">Servers</span>
          </div>
          <ul>
            <li class="tree-node">
              <div class="tree-label">
                <span class="icon">ğŸ“¦</span>
                <span class="mono">local-5520</span>
                <span class="badge offline">offline</span>
                <span class="dim mono">(~/.routecodex/config.json)</span>
              </div>
              <ul>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ¤–</span>
                    <span class="mono">glm</span>
                    <span class="tag">protocol=openai</span>
                    <span class="badge apikey">apikey</span>
                    <span class="dim mono">source=inline value=6484â€¦ttZB</span>
                  </div>
                </li>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ¤–</span>
                    <span class="mono">qwen</span>
                    <span class="tag">protocol=openai</span>
                    <span class="badge oauth">oauth</span>
                    <span class="dim mono">tokenFile=~/.routecodex/auth/qwen-oauth.json</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ”‘</span>
                        <span class="mono">token: work (qwen-oauth-1-work.json)</span>
                        <span class="badge status-expired">expired</span>
                        <span class="dim mono">expiresAt=2025-12-25T23:10Z</span>
                      </div>
                    </li>
                  </ul>
                </li>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ¤–</span>
                    <span class="mono">iflow</span>
                    <span class="tag">protocol=openai</span>
                    <span class="badge oauth">oauth</span>
                    <span class="dim mono">tokenFile=~/.routecodex/auth/iflow-oauth-1-186.json</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ”‘</span>
                        <span class="mono">token: 186 (iflow-oauth-1-186.json)</span>
                        <span class="badge status-valid">valid</span>
                        <span class="dim mono">å‰©ä½™=652min</span>
                      </div>
                    </li>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ”‘</span>
                        <span class="mono">token: 173 (iflow-oauth-2-173.json)</span>
                        <span class="badge status-expiring">expiring</span>
                        <span class="dim mono">å‰©ä½™=12min</span>
                      </div>
                    </li>
                  </ul>
                </li>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ¤–</span>
                    <span class="mono">gemini</span>
                    <span class="tag">protocol=openai</span>
                    <span class="badge apikey">apikey</span>
                    <span class="dim mono">source=inline value=AIzaâ€¦3mEQ</span>
                  </div>
                </li>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ¤–</span>
                    <span class="mono">lmstudio</span>
                    <span class="tag">protocol=responses</span>
                    <span class="badge apikey">apikey</span>
                    <span class="dim mono">value=${LM_STUDIO_API_KEY:-}</span>
                  </div>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </section>

      <!-- å³ä¾§ï¼šToken â†’ Used By è§†è§’ + é‡å¯æŒ‰é’® -->
      <section class="panel">
        <h2>Token è§†è§’ï¼ˆè‡ªä¸‹è€Œä¸Šï¼‰</h2>
        <div class="hint">
          å…¥å£ï¼š<span class="mono">tokens</span>ï¼ŒæŒ‰ã€ŒToken â†’ ä½¿ç”¨å®ƒçš„æœåŠ¡å™¨/Providersã€ç»„ç»‡ã€‚
          åœ¨è¿™ä¸ªè§†è§’ä¸‹ç‚¹å‡»æŸä¸ª usedBy èŠ‚ç‚¹å¯ä»¥è§¦å‘å¯¹åº” Provider çš„é‡å¯ã€‚
        </div>

        <div class="tree">
          <div class="tree-root">
            <span class="icon">ğŸ”‘</span>
            <span class="mono">Tokens</span>
          </div>
          <ul>
            <li class="tree-node">
              <div class="tree-label">
                <span class="icon">ğŸŒ</span>
                <span class="mono">iflow</span>
              </div>
              <ul>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ—</span>
                    <span class="mono">186 (iflow-oauth-1-186.json)</span>
                    <span class="badge status-valid">valid</span>
                    <span class="dim mono">expiresAt=2025-12-26T11:46:37Z, å‰©ä½™=652min</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ“¦</span>
                        <span class="mono">usedBy: local-5520:iflow</span>
                        <span class="tag">protocol=openai</span>
                        <button style="margin-left:6px; font-size:11px; padding:1px 6px; border-radius:6px; border:none; background:#1f2937; color:#e5e7eb; cursor:default;">
                          âŸ³ é‡å¯è¯¥ Provider
                        </button>
                      </div>
                    </li>
                  </ul>
                </li>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ—</span>
                    <span class="mono">173 (iflow-oauth-2-173.json)</span>
                    <span class="badge status-expiring">expiring</span>
                    <span class="dim mono">expiresAt=2025-12-26T11:47:24Z, å‰©ä½™=12min</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ“¦</span>
                        <span class="mono">usedBy: local-5520:iflow</span>
                        <span class="tag">protocol=openai</span>
                        <button style="margin-left:6px; font-size:11px; padding:1px 6px; border-radius:6px; border:none; background:#1f2937; color:#e5e7eb; cursor:default;">
                          âŸ³ é‡å¯è¯¥ Provider
                        </button>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>

            <li class="tree-node">
              <div class="tree-label">
                <span class="icon">ğŸŒ</span>
                <span class="mono">qwen</span>
              </div>
              <ul>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ—</span>
                    <span class="mono">work (qwen-oauth-1-work.json)</span>
                    <span class="badge status-expired">expired</span>
                    <span class="dim mono">expiresAt=2025-12-25T23:10:00Z, å‰©ä½™=-5min</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ“¦</span>
                        <span class="mono">usedBy: local-5520:qwen</span>
                        <span class="tag">protocol=openai</span>
                        <button style="margin-left:6px; font-size:11px; padding:1px 6px; border-radius:6px; border:none; background:#1f2937; color:#e5e7eb; cursor:default;">
                          âŸ³ é‡å¯è¯¥ Provider
                        </button>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>

            <li class="tree-node">
              <div class="tree-label">
                <span class="icon">ğŸŒ</span>
                <span class="mono">gemini-cli</span>
              </div>
              <ul>
                <li class="tree-node">
                  <div class="tree-label">
                    <span class="icon">ğŸ—</span>
                    <span class="mono">primary (gemini-oauth-1-primary.json)</span>
                    <span class="badge status-invalid">invalid</span>
                    <span class="dim mono">æ— æœ‰æ•ˆ access_token/api_key</span>
                  </div>
                  <ul>
                    <li class="tree-node">
                      <div class="tree-label">
                        <span class="icon">ğŸ“¦</span>
                        <span class="mono">usedBy: -</span>
                        <span class="dim">(å°šæœªç»‘å®šåˆ°ä»»ä½• provider)</span>
                      </div>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </section>
    </div>
  </main>
</body>
</html>
