{"id":"routecodex-1","title":"Epic: Antigravity å¯¹é½ï¼ˆé˜¶æ®µä¸€å‰©ä½™ + transport/tool schemaï¼‰","description":"ä» task.md è¿ç§»ï¼šAntigravity å¯¹é½ï¼ˆé˜¶æ®µä¸€ï¼‰ä»åœ¨è¿›è¡Œä¸­çš„æ¡ç›®ï¼ˆğŸŸ¡ï¼‰ï¼Œä»¥åŠä¸å…¶å¼ºç›¸å…³çš„ transport/tool schema æ”¶æ•›ä»»åŠ¡ã€‚\\n\\néªŒæ”¶ï¼š\\n- A5/A6/A7/D1 ç­‰å¯¹é½é¡¹æœ‰å¯å›æ”¾éªŒè¯ï¼ˆsamples dry-run/blackboxï¼‰\\n- ç›¸å…³è·¯ç”±/é…é¢ç­–ç•¥åªé€šè¿‡ quotaView äº§å‡ºï¼Œä¸å†ä¾èµ– router-local health","status":"open","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:34:06.69878+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:34:06.69878+08:00"}
{"id":"routecodex-1.1","title":"Antigravityï¼šA5 Endpoint/è·¯å¾„æ„é€ ","description":"å¯¹é½ Antigravity Tools æœ€æ–°è·¯å¾„æ„é€ ï¼ˆ/v1internal:generateContent | :streamGenerateContentï¼‰ã€‚å‚è€ƒï¼šsrc/client/gemini-cli/gemini-cli-protocol-client.ts + Antigravity-Manager upstream client.rsã€‚éªŒæ”¶ï¼šå›æ”¾å¯¹æ¯” URL/path ä¸ upstream ä¸€è‡´","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:29.766493+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:29.766493+08:00","dependencies":[{"issue_id":"routecodex-1.1","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.390859+08:00","created_by":"import"}]}
{"id":"routecodex-1.10","title":"Antigravityï¼šReasoning/Thinking å—ç­–ç•¥ï¼ˆClaude via Antigravityï¼‰éªŒæ”¶","description":"é»˜è®¤å¯¹ antigravity.* + claude-* å»é™¤ \u003cthink\u003e/\u003creflection\u003eï¼Œå…è®¸ keep_thinking/keep_reasoning opt-inã€‚éªŒæ”¶ï¼šå›å½’æ ·æœ¬ + å¼€å…³è¡Œä¸ºç¨³å®š","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.84796+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.84796+08:00","dependencies":[{"issue_id":"routecodex-1.10","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.391484+08:00","created_by":"import"}]}
{"id":"routecodex-1.11","title":"Antigravity IDE: æœ¬åœ°é€ä¼ ä»£ç†æœ€å°å®ç°ï¼ˆè®°å½•+è½¬å‘ï¼‰","description":"ä¸º Antigravity IDE æä¾›ä¸€ä¸ªæœ¬åœ° forward proxyï¼ˆHTTP + CONNECTï¼‰ç”¨äº best-effort é€ä¼ ä¸è®°å½•ï¼ˆè‡³å°‘è®°å½• CONNECT ç›®æ ‡/è€—æ—¶/å­—èŠ‚æ•°ï¼›è‹¥æœ‰æ˜æ–‡ HTTP ä¹Ÿè®°å½• method/url/statusï¼‰ã€‚ä¸ä¿®æ”¹ RouteCodex ä¸»é“¾è·¯ï¼Œåªä½œä¸º scripts å·¥å…·ã€‚","acceptance_criteria":"- æä¾› scripts å¯æ‰§è¡Œå…¥å£ï¼šå¯åŠ¨æœ¬åœ°ä»£ç†ç«¯å£ï¼ˆé»˜è®¤ 127.0.0.1:8080ï¼‰\\n- æ”¯æŒ CONNECT éš§é“è½¬å‘å¹¶è®°å½•ç›®æ ‡ host:port + å­—èŠ‚è®¡æ•°\\n- æ”¯æŒæ˜æ–‡ HTTP proxy è¯·æ±‚å¹¶è®°å½• method/url/statusï¼ˆå¯é€‰è®°å½• bodyï¼Œå¿…é¡»è„±æ• Authorization/Cookieï¼‰\\n- æä¾› docsï¼šå¦‚ä½•åœ¨ Antigravity settings.json é…ç½® http.proxy å¹¶éªŒè¯æ˜¯å¦ç”Ÿæ•ˆ\\n- ç»™å‡ºå¯å¤ç°çš„éªŒè¯å‘½ä»¤ï¼ˆcurl é€šè¿‡ä»£ç†ï¼‰","notes":"Evidence (2026-02-04):\\n- Script: scripts/antigravity-ide-forward-proxy.mjs\\n- Docs: docs/ANTIGRAVITY_IDE_FORWARD_PROXY.md\\n- Smoke: curl via proxy works\\n  - HTTP: curl -x http://127.0.0.1:18080 http://example.com -I\\n  - HTTPS: curl -x http://127.0.0.1:18080 https://example.com -I\\n  - Log sample: /tmp/antigravity-proxy.jsonl contains kind=connect_start/connect_end for example.com:443","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T09:37:36.003588+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T09:40:41.435913+08:00","closed_at":"2026-02-04T09:40:41.435913+08:00","close_reason":"Implemented local forward proxy (HTTP + CONNECT) + docs; verified via curl with connect_start/connect_end logs.","dependencies":[{"issue_id":"routecodex-1.11","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-04T10:46:20.753723+08:00","created_by":"import"}]}
{"id":"routecodex-1.12","title":"Antigravity: 403 verify-account auto OAuth + 30min cooldown","description":"Acceptance Criteria:\\n- Antigravity/Gemini upstream 403 containing verify/validation_required/accounts.google.com/signin/continue triggers interactive OAuth (Camoufox) exactly once per alias/token within cooldown.\\n- Subsequent requests within 30 minutes do NOT re-open OAuth; error is returned but without repeated auth attempts.\\n- Portal readiness wait uses 300s default (configurable).\\n- Add logs/metrics to confirm when repair is skipped due to cooldown.","notes":"Started implementation: improve 403 status extraction + Camoufox auto repair env + 30min cooldown guard. Pending full build:dev + install:global verification.\nEvidence\\n- 403 status extraction now checks nested response.status/response.statusCode: src/providers/auth/oauth-lifecycle.ts\\n- 403 verify/validation_required triggers interactive OAuth via Camoufox with cooldown guard: src/providers/auth/oauth-lifecycle.ts + src/providers/auth/oauth-repair-cooldown.ts\\n- Camoufox auto mode wired for antigravity/qwen/gemini in auto repair: src/providers/auth/oauth-repair-env.ts\\n\\nTests\\n- npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle.google-verify.spec.ts tests/providers/auth/oauth-repair-cooldown.spec.ts â†’ PASS\\n\\nVerification\\n- npm run build:dev â†’ OK (includes install:global; routecodex --version = 0.89.1685)","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T19:02:07.322261+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T19:24:03.49233+08:00","closed_at":"2026-02-04T19:24:03.49233+08:00","close_reason":"Antigravity 403 verify-account auto OAuth + cooldown; verified","dependencies":[{"issue_id":"routecodex-1.12","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-04T19:32:25.357272+08:00","created_by":"import"}]}
{"id":"routecodex-1.13","title":"OAuth: antigravity-auto confirmç¨³å®šåŒ– + CLIè‡ªåŠ¨â†’æ‰‹åŠ¨å›é€€","description":"## Context\n- antigravity-auto åœ¨ Google OAuth é¡µé¢å‡ºç°ç¡®è®¤æŒ‰é’®ä½†å› æ–‡æœ¬ä¸åŒ¹é…è·³è¿‡ç‚¹å‡»ï¼Œå¯¼è‡´ç­‰å¾… callback è¶…æ—¶ã€‚\n- CLI `routecodex oauth *-auto` å½“å‰å¤±è´¥ä¼šç›´æ¥æŠ›é”™/é€€å‡ºï¼›æœŸæœ›è‡ªåŠ¨æ¨¡å¼å¤±è´¥åå›é€€åˆ°æ‰‹åŠ¨( headed ) Camoufoxã€‚\n\n## Acceptance Criteria\n- antigravity-auto ä¸ä¾èµ–æŒ‰é’®æ–‡æœ¬ï¼Œä½¿ç”¨ selector/role ç‚¹å‡» primary actionï¼ˆç¡®è®¤/ç»§ç»­/å…è®¸ï¼‰ï¼Œå¹¶ä¸”ä¸å†ä¾èµ–æ–° page event æ‰èƒ½ç»§ç»­ã€‚\n- `routecodex oauth antigravity-auto|gemini-auto|qwen-auto \u003ctoken\u003e`ï¼šè‡ªåŠ¨æµç¨‹å¤±è´¥æ—¶è‡ªåŠ¨å›é€€åˆ°æ‰‹åŠ¨ Camoufoxï¼ˆheadedï¼‰ï¼Œä¸å‡ºç° Node æœªæ•è·å¼‚å¸¸å´©æºƒã€‚\n- portal/é¡µé¢ç­‰å¾…ç›¸å…³çš„ 10-30s timeout æå‡åˆ°å¯é…ç½®ä¸”é»˜è®¤ 300sï¼ˆé¿å…ç½‘ç»œæ…¢å¯¼è‡´è¯¯åˆ¤ï¼‰ã€‚\n- `npm run build:dev` + `npm run install:global` é€šè¿‡ã€‚","notes":"2026-02-07 verification rerun: manual oauth path (routecodex oauth \u003ctoken\u003e --headful) now stays manual/open-only (no auto selectors) and auth URL contains hl=en to stabilize Google UI rendering. Evidence: ROUTECODEX_OAUTH_DEBUG=1 routecodex oauth '/Users/fanzhang/.routecodex/auth/antigravity-oauth-3-antonsoltan.json' --headful prints OAuth URL with hl=en and camoufox-launch-auth log 'open-only mode enabled'. Validation passed: npm run jest:run -- --runTestsByPath tests/providers/core/config/camoufox-launcher.os-policy.unit.test.ts tests/providers/core/oauth-refresh-permanent-errors.spec.ts tests/token-daemon/interactive-refresh.spec.ts tests/commands/oauth-command.behavior.spec.ts tests/providers/auth/oauth-lifecycle.nonblocking-repair.spec.ts ; npm run build:dev (includes npm run install:global).","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T07:50:49.964254+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T01:19:58.89702+08:00","dependencies":[{"issue_id":"routecodex-1.13","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T08:05:56.680718+08:00","created_by":"import"}]}
{"id":"routecodex-1.14","title":"OAuth: qwen refresh/auto ä¸ä¸­æ–­ + ç»Ÿä¸€README","description":"## Context\n- qwen token refresh å¯èƒ½è¿”å› permanent invalid_requestï¼Œå½“å‰ä¼šè¾“å‡ºå¤±è´¥æ—¥å¿—ï¼›å¿…é¡»ä¿è¯ä¸é˜»å¡ server/requestã€‚\n- éœ€è¦ç»Ÿä¸€ OAuth ä½¿ç”¨/åˆ·æ–°/è®¤è¯æ–‡æ¡£ï¼ŒåŒ…å« camoufox è‡ªåŠ¨/æ‰‹åŠ¨è¯´æ˜ã€åˆ·æ–°çª—å£ã€ä»¥åŠ tokenFile çº¦å®šï¼ˆqwen default pinnedï¼‰ã€‚\n\n## Acceptance Criteria\n- qwen refresh å¤±è´¥ä¸ä¼šé˜»å¡ server å¯åŠ¨/è¯·æ±‚ï¼›token daemon å¯¹ permanent å¤±è´¥å†™å…¥ norefresh åä¸å†é‡å¤å°è¯•ã€‚\n- æä¾›ç»Ÿä¸€ READMEï¼ˆæˆ– docsï¼‰è¯´æ˜ï¼šå¦‚ä½•åˆ·æ–°ã€å¦‚ä½•è‡ªåŠ¨ oauthã€å¦‚ä½•æ‰‹åŠ¨ oauthã€å¦‚ä½•æ’æŸ¥ camoufox æœªå®‰è£…ã€‚\n- `npm run build:dev` + `npm run install:global` é€šè¿‡ã€‚","notes":"- Qwen tokenFile=default is pinned to `~/.routecodex/auth/qwen-oauth-1-default.json` (server reads the same file as `routecodex oauth ...`).\n- `routecodex oauth` uses Camoufox qwen auto by default and now autoâ†’manual fallback is implemented in `src/token-daemon/index.ts`.\n- Unified OAuth guide updated with Camoufox timeout envs: `docs/OAUTH.md`.\n\nVerified docs/build after Camoufox timeout doc update: `npm run build:dev` OK (v0.89.1695).","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T07:50:50.095666+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T08:05:18.980954+08:00","dependencies":[{"issue_id":"routecodex-1.14","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T08:05:56.681397+08:00","created_by":"import"}]}
{"id":"routecodex-1.15","title":"Routing: antigravity gemini-3-pro-low maxContext=256k + longcontext backup","description":"## Context\n- antigravity provider config currently declares gemini-3-pro-low maxContext=1,000,000 and routes it as longcontext primary.\n- Actual gemini-3-pro-low context is 256k; when token estimates exceed 256k this should not be a primary longcontext target.\n\n## Acceptance Criteria\n- Update config so antigravity gemini-3-pro-low maxContext=256000 (and used by VirtualRouter).\n- Move antigravity.gemini-3-pro-low from longcontext primary pool to longcontext backup pool.\n- Update provider default catalog so newly-inited configs carry the same maxContext for gemini-3-pro-low.\n- Verify `npm run build:dev` and `npm run install:global`.","notes":"Implemented config+catalog updates for gemini-3-pro-low context/routing; running full build verification next.\nEvidence:\n- Updated local config: ~/.routecodex/config.json\n  - virtualrouter.providers.antigravity.models.gemini-3-pro-low.maxContext = 256000\n  - virtualrouter.routing.longcontext: removed antigravity.gemini-3-pro-low from longcontext-gemini-primary; added to longcontext-backup\n- Updated default init catalog: src/cli/config/init-provider-catalog.ts (gemini-3-pro-low maxContext=256000)\n- Verified: npm run build:dev (includes npm run install:global) succeeded (v0.89.1699)","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-05T09:45:22.858315+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T09:49:13.657159+08:00","closed_at":"2026-02-05T09:49:13.657159+08:00","close_reason":"Set gemini-3-pro-low maxContext=256k and moved it to longcontext backup.","dependencies":[{"issue_id":"routecodex-1.15","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T10:38:56.799735+08:00","created_by":"import"}]}
{"id":"routecodex-1.16","title":"CLI oauth: surface quota authIssue (verify required) to match daemon-admin","description":"## Context\n- daemon-admin Credentials shows token validity plus quota authIssue (e.g. google_account_verification =\u003e \"verify required\").\n- CLI `routecodex oauth \u003cselector\u003e` may print \"Token is still valid; skip interactive\" or \"è®¤è¯å®Œæˆ\" without surfacing that the alias is quarantined (reason=authVerify) and still needs Google account verification.\n- Users perceive CLI vs WebUI as conflicting.\n\n## Acceptance Criteria\n- When a token is valid but quota-manager indicates google_account_verification for the same provider+alias, CLI prints a clear warning and the verification URL hint.\n- When OAuth refresh/reauth completes, CLI prints the same warning if verify-required remains flagged.\n- Add unit test coverage for the warning logic.\n- `npm run build:dev` + `npm run install:global` pass.","notes":"Implemented CLI warning for quota-manager google_account_verification (verify required) so CLI and daemon-admin no longer conflict.\n\nEvidence\n- Reads ~/.routecodex/quota/quota-manager.json and detects authIssue.kind=google_account_verification: src/token-daemon/quota-auth-issue.ts\n- routecodex oauth \u003cselector\u003e now warns even when token is valid/skip OAuth, and after successful reauth: src/token-daemon/index.ts\n- Tests: tests/token-daemon/interactive-refresh.spec.ts (added coverage)\n\nVerification\n- npm run build:dev (includes npm run install:global) PASS (RouteCodex v0.89.1701)\n","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T09:55:06.356598+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T10:38:09.938766+08:00","closed_at":"2026-02-05T10:38:09.938766+08:00","close_reason":"CLI oauth surfaces verify-required quota authIssue","dependencies":[{"issue_id":"routecodex-1.16","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T10:38:56.800429+08:00","created_by":"import"}]}
{"id":"routecodex-1.17","title":"bug(quota-ui): reset action doesn't clear antigravity alias + remove health sorting","description":"## Context\n- daemon-admin Quota table sorts by health (inPool/cooldown/blacklist) on every poll, which makes rows jump and selection unstable.\n- WebUI reset on an antigravity providerKey may not clear alias-level quarantine/blacklist across models; expected one reset to recover the whole alias.\n\n## Acceptance Criteria\n- Quota table ordering is stable across polling (sort by providerKey only; no health-based reordering).\n- POST /quota/providers/:providerKey/reset and /recover reset/recover the whole antigravity alias group (all providerKeys under antigravity.\u003calias\u003e.*).\n- Verified by npm run build:dev (includes install:global).\n","notes":"Fixes daemon-admin quota UX + reset semantics.\n\nEvidence\n- Quota table no longer health-sorts on every poll (stable providerKey sort): docs/daemon-admin-ui.html\n- Reset/Recover for antigravity now expands to whole alias group (antigravity.\u003calias\u003e.*) using quota admin snapshot: src/server/runtime/http-server/daemon-admin/quota-handler.ts\n\nVerification\n- npm run build:dev (includes npm run install:global) PASS (RouteCodex v0.89.1701)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T10:35:17.016978+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T10:38:19.992792+08:00","closed_at":"2026-02-05T10:38:19.992792+08:00","close_reason":"Stable quota UI ordering + alias-group reset/recover","dependencies":[{"issue_id":"routecodex-1.17","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T10:38:56.801008+08:00","created_by":"import"}]}
{"id":"routecodex-1.18","title":"feat(oauth): CLI auto-open google verify URL in Camoufox","description":"## Context\n- CLI `routecodex oauth \u003cselector\u003e` may report success/valid token while quota-manager still marks the alias as `google_account_verification` (verify required).\n- Today CLI prints the verification URL, but user must manually copy/paste or switch to daemon-admin UI to click open.\n\n## Acceptance Criteria\n- When CLI detects verify-required and URL is present, it can open the verification URL in Camoufox automatically in headed mode (open-only, no callback wait).\n- Default behavior: prompt the user to open (TTY). If `--headful` is used or env `ROUTECODEX_OAUTH_AUTO_OPEN_VERIFY=1`, auto-open without prompt.\n- URL is sanitized (strip newlines / trailing text; extract first https URL).\n- Unit tests cover auto-open path.\n- `npm run build:dev` + `npm run install:global` pass.\n","notes":"Evidence (2026-02-05)\\n- Auto-open verify URL (Camoufox open-only): src/token-daemon/index.ts\\n- Sanitize quota-manager authIssue.url (strip newlines/trailing text): src/token-daemon/quota-auth-issue.ts\\n- Unit test: tests/token-daemon/interactive-refresh.spec.ts (auto open when ROUTECODEX_CAMOUFOX_DEV_MODE=1 / --headful)\\n\\nVerification\\n- npm test (PASS)\\n- npm run build:dev (PASS, includes install:global) â€” RouteCodex v0.89.1702","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T11:01:34.078167+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T11:09:42.129293+08:00","closed_at":"2026-02-05T11:09:42.129293+08:00","close_reason":"CLI can open google verify URL in Camoufox (open-only) when quota-manager flags verify-required.","dependencies":[{"issue_id":"routecodex-1.18","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T11:12:22.11897+08:00","created_by":"import"}]}
{"id":"routecodex-1.19","title":"bug(token-daemon): refreshAhead default 30min + permanent refresh suppression","description":"## Context\n- `docs/OAUTH.md` says token-daemon refreshes **30 minutes** before expiry and supports env override `ROUTECODEX_TOKEN_REFRESH_AHEAD_MIN`, but code default is 5 minutes and doesn't read that env var.\n- Permanent refresh failures (e.g. qwen invalid refresh token/client_id) should persistently suppress further background refresh attempts without getting cleared by daemon's own token-file writes.\n\n## Acceptance Criteria\n- TokenDaemon default refreshAhead is 30 minutes.\n- Env override works: `ROUTECODEX_TOKEN_REFRESH_AHEAD_MIN` / `RCC_TOKEN_REFRESH_AHEAD_MIN`.\n- Permanent refresh failure writes `noRefresh` and history uses post-write mtime so auto-suspension isn't cleared immediately.\n- Docs updated to reflect actual behavior (CLI auto-open verify URL + refreshAhead env).\n- `npm run build:dev` passes (includes install:global).\n","notes":"Evidence (2026-02-05)\\n- TokenDaemon refreshAhead default=30 + env override: src/token-daemon/token-daemon.ts\\n- Permanent refresh failure writes noRefresh + uses post-write mtime in history: src/token-daemon/token-daemon.ts\\n- TokenHistoryStore paths now resolved per-instance (respects /Users/fanzhang in tests/edge env): src/token-daemon/history-store.ts\\n- Tests: tests/token-daemon/token-daemon.auto-refresh-noninteractive.spec.ts (noRefresh + mtime)\\n- Tests: tests/token-daemon/token-daemon.refresh-ahead.spec.ts (default + env override)\\n- Test suite list updated: package.json ()\\n- Docs: CLI verify-required now offers Camoufox one-step open + env flag: docs/OAUTH.md\\n\\nVerification\\n- npm run build:dev PASS (RouteCodex v0.89.1705; includes install:global)\nNote: package.json test:routing-instructions now includes tests/token-daemon/token-daemon.refresh-ahead.spec.ts (so build:dev runs it). TokenHistoryStore now resolves paths from process.env.HOME at runtime (so tests can sandbox state).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T11:25:56.240469+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T11:42:58.378077+08:00","closed_at":"2026-02-05T11:42:31.068275+08:00","dependencies":[{"issue_id":"routecodex-1.19","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-05T11:27:19.613248+08:00","created_by":"import"}]}
{"id":"routecodex-1.2","title":"Antigravityï¼šA6 requestType è§£æï¼ˆagent/web_search/image_genï¼‰","description":"å¯¹é½ Antigravity Tools çš„ request_type åˆ¤å®šï¼ˆ-online åç¼€ / networking tools / image æ¨¡å‹ï¼‰ã€‚éªŒæ”¶ï¼šsamples è¦†ç›–å¹¶èƒ½ç¨³å®šå‘½ä¸­ search/tools/vision è·¯ç”±","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:29.879347+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:29.879347+08:00","dependencies":[{"issue_id":"routecodex-1.2","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.391987+08:00","created_by":"import"}]}
{"id":"routecodex-1.20","title":"Camoufox ä¹±ç ä¿®å¤ + Claude/Gemini å¯¹é½ Antigravity-Manager","description":"## Context\\nç”¨æˆ·åé¦ˆ antigravity OAuth åœ¨ Camoufox æ‰“å¼€çš„ Google é¡µé¢ä»å‡ºç°ä¹±ç ï¼›åŒæ—¶è¦æ±‚å°†å½“å‰ Claude/Gemini ç›¸å…³è¡Œä¸ºä¸ Antigravity-Manager å¯¹é½ã€‚\\n\\n## Scope\\n- ä¿®å¤ Camoufox æ‰“å¼€ OAuth/verify é¡µé¢ä¹±ç æˆ–æ˜¾ç¤ºå¼‚å¸¸ã€‚\\n- å¯¹é½ Gemini/Claude ç›¸å…³ provider/transport ç»†èŠ‚åˆ° Antigravity-Manager å½“å‰è¡Œä¸ºï¼ˆä»…é™å·²ç¡®è®¤å·®å¼‚ï¼‰ã€‚\\n- ä¿æŒæ‰‹åŠ¨ä¸è‡ªåŠ¨ OAuth æ¨¡å¼ä¸¥æ ¼åˆ†ç¦»ï¼ˆmanual ä¸è§¦å‘ auto selectorï¼‰ã€‚","acceptance_criteria":"- æ‰‹åŠ¨ oauth --headful æ‰“å¼€é¡µé¢ä¸å†å‡ºç°å¯å¤ç°ä¹±ç ï¼ˆè‡³å°‘é€šè¿‡æœ¬åœ°æœ€å°å¤ç°å‘½ä»¤éªŒè¯è¾“å‡ºé“¾è·¯å’Œå…³é”®å‚æ•°ï¼‰ã€‚\\n- Gemini/Claude å¯¹é½ç‚¹å…·å¤‡æ˜ç¡®ä»£ç ä¸æµ‹è¯•è¦†ç›–ã€‚\\n- npm run jest:run å¯¹æ–°å¢/å˜æ›´æµ‹è¯•é€šè¿‡ï¼›npm run build:dev é€šè¿‡ï¼›npm run install:global å¯ç”¨ã€‚","notes":"2026-02-07 implementation: (1) Camoufox locale hardening for OAuth: added locale env propagation (LANG/LC_ALL/LANGUAGE) from ROUTECODEX_OAUTH_GOOGLE_HL in src/providers/core/config/camoufox-launcher.ts and scripts/camoufox/launch-auth.mjs; added firefoxUserPrefs intl.accept_languages for all Playwright-launched Camoufox contexts; detached/manual Camoufox binary launch now also receives locale env. (2) Antigravity manager alignment for Gemini/Claude request envelope: antigravity requestId prefix now consistently agent-* even in minimal header mode in src/providers/core/runtime/gemini-http-provider.ts and src/providers/core/runtime/gemini-cli-http-provider.ts (matching Antigravity-Manager wrappers). (3) tests updated: tests/providers/core/config/camoufox-launcher.os-policy.unit.test.ts + tests/providers/core/runtime/gemini-cli-http-provider.unit.test.ts. Validation: npm run jest:run -- --runTestsByPath tests/providers/core/config/camoufox-launcher.os-policy.unit.test.ts tests/providers/core/runtime/gemini-cli-http-provider.unit.test.ts tests/providers/core/runtime/gemini-http-provider.unit.test.ts tests/token-daemon/interactive-refresh.spec.ts tests/commands/oauth-command.behavior.spec.ts ; npm run build:dev passed (includes install:global and blackbox antigravity parity).\n2026-02-07 follow-up: added Camoufox font/user.js managed prefs patch in scripts/camoufox/launch-auth.mjs (UTF-8 fallback + zh/ja/ko/western font prefs) to mitigate OAuth page garbling; added token-daemon auto auth coverage for gemini-cli in src/token-daemon/token-daemon.ts and iflow env scoping in src/providers/auth/oauth-repair-env.ts. Tests passed: npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-repair-env.antigravity.spec.ts tests/token-daemon/token-daemon.auto-refresh-noninteractive.spec.ts tests/commands/oauth-command.behavior.spec.ts. Full validation passed: npm run build:dev (includes install:global + regression stack + antigravity blackbox parity).\n2026-02-07 auth-ui revamp: redesigned daemon-admin Auth page layout to mirror Antigravity-Manager workflow (Auth Inventory + Auth Workbench + Manual/Auto split + Verify Center + Run Console) in docs/daemon-admin-ui.html. Added explicit mode handling to /daemon/oauth/authorize in src/server/runtime/http-server/daemon-admin/credentials-handler.ts: mode=manual clears ROUTECODEX_CAMOUFOX_AUTO_MODE/ROUTECODEX_OAUTH_AUTO_CONFIRM, mode=auto uses withOAuthRepairEnv; headful control split (manual default headed, auto headed only with debug flag). Validation: npm run jest:run -- --runTestsByPath tests/commands/oauth-command.behavior.spec.ts; npm run build:dev passed (full stack + install:global + blackbox parity).","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T01:28:40.898028+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T10:29:59.577736+08:00","dependencies":[{"issue_id":"routecodex-1.20","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-07T01:41:46.682692+08:00","created_by":"import"}]}
{"id":"routecodex-1.3","title":"Antigravityï¼šA7 googleSearch æ³¨å…¥ \u0026 tools æ¸…ç†","description":"ä»… Antigravity åˆ†æ”¯ï¼šgoogleSearch æ³¨å…¥è¡Œä¸ºä¸ tools æ¸…ç†ä¸€è‡´ã€‚éªŒæ”¶ï¼šdry-run å¯¹æ¯” request.tools ä¸ upstream ä¸€è‡´ï¼Œä¸” followup ä¸ä¸¢å·¥å…·","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:29.987425+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:29.987425+08:00","dependencies":[{"issue_id":"routecodex-1.3","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.392469+08:00","created_by":"import"}]}
{"id":"routecodex-1.4","title":"Antigravityï¼šB2 protected_models æŒä¹…åŒ– + è·¯ç”±å½±å“éªŒè¯","description":"éªŒè¯æ¨¡å‹çº§ä¿æŠ¤/æ¢å¤æœºåˆ¶ä¸è·¯ç”±å‘½ä¸­å½±å“ï¼ˆé€šè¿‡ quotaView å”¯ä¸€äº§å‡ºï¼‰ã€‚éªŒæ”¶ï¼šquota view é‡Œå¯è§ protected çŠ¶æ€ä¸”è·¯ç”±è·³è¿‡","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.103651+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.103651+08:00","dependencies":[{"issue_id":"routecodex-1.4","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.392927+08:00","created_by":"import"}]}
{"id":"routecodex-1.5","title":"Antigravityï¼šB3 è´¦å·çº§é™æµéªŒè¯","description":"éªŒè¯è´¦å·çº§é™æµä¸ session stickiness ä¸€è‡´ï¼›ç¡®ä¿ä¸ä¼šå¯¼è‡´ alias å…¨å±€ stickyã€‚éªŒæ”¶ï¼š429/é™æµè¡Œä¸ºæŒ‰ç­–ç•¥ç§»å‡º pool","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.215219+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.215219+08:00","dependencies":[{"issue_id":"routecodex-1.5","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.393385+08:00","created_by":"import"}]}
{"id":"routecodex-1.6","title":"Antigravityï¼šC2 æ¨¡å‹åè§„èŒƒåŒ–ï¼ˆprovider ä¾§é…ç½®ï¼‰","description":"Provider ä¸åšæ¨¡å‹é™çº§/å›é€€ï¼›åªåšåç¼€è§„èŒƒåŒ–ï¼ˆ-low/-high/-medium/-minimalï¼‰ã€‚éªŒæ”¶ï¼šé…ç½®/è·¯ç”±ä¾§æ˜ å°„å¯æ§","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.341506+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.341506+08:00","dependencies":[{"issue_id":"routecodex-1.6","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.393905+08:00","created_by":"import"}]}
{"id":"routecodex-1.7","title":"Antigravityï¼šD1 UA / X-Goog-Api-Client / Client-Metadata å¯¹é½","description":"Antigravity åˆ†æ”¯ä»…ä½¿ç”¨ UAï¼ˆä¸åŠ  Gemini CLI header tripletï¼‰ï¼Œå¯¹é½æœ€æ–° Antigravity Toolsã€‚éªŒæ”¶ï¼šæŠ“åŒ…/å›æ”¾ header ä¸€è‡´","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.470878+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.470878+08:00","dependencies":[{"issue_id":"routecodex-1.7","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.394527+08:00","created_by":"import"}]}
{"id":"routecodex-1.8","title":"Antigravityï¼šTransportï¼šAntigravity baseUrl çº§è”éªŒæ”¶ + å›å½’","description":"å·²å®ç° baseUrl candidates + header æ•è·ï¼›è¡¥é½éªŒè¯ä¸å›å½’ï¼ˆç½‘ç»œ/timeout/5xx/403/404 + 429/400ï¼‰ã€‚éªŒæ”¶ï¼šåˆ‡ baseUrl ä¼˜å…ˆäºåˆ‡ alias","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.595431+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.595431+08:00","dependencies":[{"issue_id":"routecodex-1.8","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.395049+08:00","created_by":"import"}]}
{"id":"routecodex-1.9","title":"Antigravityï¼šå·¥å…· schema æ¸…æ´—ï¼ˆGemini functionDeclarationsï¼‰è¡¥é½","description":"æ›´è´´è¿‘ä¸Šæ¸¸ parameters å­é›†ï¼ˆconstâ†’enumã€ä¸¢å¼ƒä¸æ”¯æŒ keyã€ç»„åˆå™¨æ”¶æ•›ï¼‰ã€‚éªŒæ”¶ï¼šå·¥å…·å£°æ˜ä¸ä¼šè§¦å‘ä¸Šæ¸¸ 400ï¼Œä¸”ä¸ç ´åæœ¬åœ° tool use","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:30.721769+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:30.721769+08:00","dependencies":[{"issue_id":"routecodex-1.9","depends_on_id":"routecodex-1","type":"parent-child","created_at":"2026-02-03T19:28:31.395705+08:00","created_by":"import"}]}
{"id":"routecodex-10","title":"ä¿®å¤ config init åœ¨ Jest ä¸‹è¯¯è¿›å…¥äº¤äº’å¯¼è‡´è¶…æ—¶","description":"## Problem\n`tests/cli/config-command.spec.ts` åœ¨æœ¬åœ° TTY ç¯å¢ƒä¸‹ä¼šè¿›å…¥äº¤äº’å¼ provider é€‰æ‹©å¹¶é˜»å¡ï¼Œå¯¼è‡´è¶…æ—¶ï¼›æœŸæœ›åœ¨æµ‹è¯•ç¯å¢ƒï¼ˆJestï¼‰é»˜è®¤è§†ä¸º non-interactiveï¼Œé™¤éæ˜¾å¼æ³¨å…¥ ctx.promptã€‚\n\n## Acceptance Criteria\n- åœ¨ Jest ç¯å¢ƒï¼ˆJEST_WORKER_ID æˆ– NODE_ENV=testï¼‰ä¸‹ï¼Œconfig init åœ¨æœªæä¾› --providers/--template æ—¶ä¸è¿›å…¥ readline äº¤äº’ï¼Œè€Œæ˜¯èµ° Non-interactive error åˆ†æ”¯\n- `npm run jest:run -- --runTestsByPath tests/cli/config-command.spec.ts` é€šè¿‡","notes":"Fix: disable readline-based interactive prompt in Jest unless ctx.prompt is explicitly provided.\n\nChange:\n- src/cli/commands/config.ts: buildInteractivePrompt returns null when JEST_WORKER_ID or NODE_ENV=test.\n\nEvidence:\n- npm run jest:run -- --runTestsByPath tests/cli/config-command.spec.ts (PASS)","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T12:29:04.673839+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T12:30:02.85342+08:00","closed_at":"2026-02-04T12:30:02.85342+08:00","close_reason":"Jest ä¸‹ç¦ç”¨ readline äº¤äº’ï¼Œé¿å… config init é˜»å¡è¶…æ—¶","labels":["bug","cli","test"]}
{"id":"routecodex-100","title":"clock_auto: finish_reason=stop æ—¶æœªå‘½ä¸­ stopMessage ä¹Ÿåº” hold åˆ°çª—å£å¹¶è§¦å‘ followup","acceptance_criteria":"1) å½“å“åº” stop/length ä¸” stop_message_auto æœªè§¦å‘æ—¶ï¼Œclock_auto åœ¨å­˜åœ¨æœªæŠ•é€’ä»»åŠ¡ä¸”æœªåˆ°çª—å£æ—¶å¿…é¡» hold åˆ° threshold åè§¦å‘ followupï¼›2) å½“ä»»åŠ¡å·²åœ¨è§¦å‘çª—å£å†…(at\u003e=dueAt-dueWindow)æ—¶ï¼Œæœ¬è½®åº”ç›´æ¥è§¦å‘ followupï¼ˆä¸å†è¦æ±‚ä¸‹ä¸€è½®è¯·æ±‚ï¼‰ï¼›3) éæµå¼é»˜è®¤åº”å…è®¸ holdï¼ˆä¸æ–‡æ¡£ä¸€è‡´ï¼‰ï¼Œä¸”å¯é€šè¿‡ holdNonStreaming=false æ˜¾å¼å…³é—­ï¼›4) å¢åŠ å›å½’æµ‹è¯•è¦†ç›– stream/non-stream + in-window + out-of-window åœºæ™¯ã€‚","notes":"Implemented and validated requested stop/clock hold behavior. Evidence: sharedmodule/llmswitch-core/src/servertool/clock/config.ts; sharedmodule/llmswitch-core/src/servertool/handlers/clock-auto.ts; sharedmodule/llmswitch-core/src/conversion/hub/process/chat-process.ts; tests/servertool/servertool-clock.spec.ts. Validation: npm run jest:run -- --runTestsByPath tests/servertool/servertool-clock.spec.ts (16 passed); npm run build:dev (full workflow passed).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T23:26:18.438059+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T23:38:14.456354+08:00","closed_at":"2026-02-07T23:38:14.456354+08:00","labels":["clock","servertool","stopmessage"]}
{"id":"routecodex-101","title":"stopMessage add 900s guard and 5+5 loop breaker","description":"Acceptance Criteria\n- stop_message_flow followup chain is hard-capped at 900 seconds and returns fetch failed/network style error once exceeded.\n- detect identical request+response signature for stop_message_flow; at 5 consecutive repeats inject loop-break warning into followup.\n- if identical signature reaches 10 consecutive repeats, abort with fetch failed/network style error.\n- add regression tests covering warning-at-5 and fail-at-10 behavior.\n- run targeted stopMessage test suite and build:dev.","notes":"- Implemented stopMessage hard guard in sharedmodule/llmswitch-core/src/servertool/engine.ts:\n  - 900s stage cap for stop_message_flow followup chain; timeout now returns fetch failed style network error (code=SERVERTOOL_TIMEOUT, status=502).\n  - Identical request/response pair loop detection for stop_message_flow: warn at 5, hard stop at 10.\n  - Warning injected as system text into followup payload once threshold reached.\n- Added regressions in tests/servertool/stop-message-auto.spec.ts:\n  - injects loop-break warning after 5 identical rounds\n  - returns fetch failed after 10 identical rounds\n  - returns fetch failed when elapsed \u003e 900s\n- Verification:\n  - npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts --runInBand\n  - npm run jest:run -- --runTestsByPath tests/servertool/stopmessage-session-scope.spec.ts tests/servertool/servertool-progress-logging.spec.ts --runInBand\n  - npm run build:dev (includes install:global) âœ…","status":"closed","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-08T11:00:45.518766+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T11:08:56.19089+08:00","closed_at":"2026-02-08T11:08:56.19089+08:00","close_reason":"Implemented 900s stopMessage timeout + 5/10 loop breaker with regressions and build:dev verification"}
{"id":"routecodex-102","title":"apply_patch errorsamples: classify new shapes and add compat regressions","description":"Acceptance Criteria\n- Re-check current ~/.routecodex/errorsamples/apply_patch samples and classify newly appeared failures into fixable/non-fixable with concrete shape patterns.\n- Implement minimal single-point compat normalization for newly fixable shape(s) only.\n- Add/extend regression tests for each newly fixed shape and keep fail-fast for unsafe/unfixable shapes.\n- Verify with targeted tests plus build checks (sharedmodule + routecodex relevant checks).","notes":"Reclassified apply_patch errorsamples (2026-02-08):\n- Fixable: missing_changes/sample_3822f76126d86adb.json (command-envelope string with embedded apply_patch patch).\n- Non-fixable by design (kept fail-fast): invalid_file/sample_30314d85377023cc.json, invalid_json/sample_443d3f3d04c258a8.json, invalid_json/sample_f4347c9ca07aab6b.json, invalid_lines/sample_1d7e5fbc277f2418.json, invalid_lines/sample_e18cff34dbd89dcb.json, missing_changes/sample_e917bf14bee10bb0.json.\nImplementation:\n- Added command field extraction in apply_patch normalizer default action list.\n- Added regressions in sharedmodule tests + tool-governance check.\nVerification:\n- cd sharedmodule/llmswitch-core \u0026\u0026 npm run build (matrix passed).\n- cd sharedmodule/llmswitch-core \u0026\u0026 node scripts/tests/tool-governance-check.mjs (passed).\n- Dist validation over ~/.routecodex/errorsamples/apply_patch now shows sample_3822... =\u003e ok, others unchanged fail-fast.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T12:27:03.997672+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T12:38:33.974544+08:00","closed_at":"2026-02-08T12:38:33.974544+08:00","close_reason":"Fixed command-envelope apply_patch missing_changes shape; added regressions and verified build/matrix"}
{"id":"routecodex-103","title":"Auth Inventory: action-column recover flow + refresh endpoint check","description":"Acceptance Criteria\n- Auth Inventory ä¸åœ¨ status åˆ—å†…åµŒé“¾æ¥ï¼Œæ”¹ä¸ºç‹¬ç«‹ action åˆ—æŒ‰é’®ï¼ˆRecover/Open Verifyï¼‰ã€‚\n- Recover æŒ‰é’®æ‰§è¡Œ refresh -\u003e auto oauth -\u003e manual fallbackã€‚\n- /daemon/credentials/:id/refresh è·¯ç”±å¯ç”¨ï¼Œå¹¶æœ‰ e2e è¦†ç›–ï¼ˆè‡³å°‘ unknown id è¿”å› 404ï¼‰ã€‚\n- build:dev ä¸ install:global å®Œæˆå¹¶é€šè¿‡ã€‚","notes":"- UI action column + recovery button wired: docs/daemon-admin-ui.html\n- refresh endpoint availability regression: tests/server/http-server/daemon-admin.e2e.spec.ts\n- verification: npm run jest:run -- --runTestsByPath tests/server/http-server/daemon-admin.e2e.spec.ts --runInBand\n- verification: npm run build:dev (includes install:global) passed","status":"closed","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T19:27:23.338159+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T19:27:59.529741+08:00","closed_at":"2026-02-08T19:27:59.529741+08:00","close_reason":"Auth Inventory recover UX + refresh route validation completed"}
{"id":"routecodex-104","title":"daemon-admin: oauth auth tabs should not trigger main panel tab switch","description":"Acceptance Criteria\n- Clicking Manual Auth/Auto Auth tabs never hides main panels.\n- Start Manual Auth/Run Auto Auth buttons remain clickable and produce run-console logs.\n- Main top tab switching keeps working as before.","notes":"- root cause: oauth mode buttons reused `.tab` class and were captured by global `document.querySelectorAll(\".tab\")` click binder\n- fix: scope main tab logic to `.tab[data-tab]` only in selectTab/getActiveTab/event binding\n- verification: script syntax check + npm run install:global passed","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T19:57:01.976838+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T19:57:11.973806+08:00","closed_at":"2026-02-08T19:57:11.973806+08:00","close_reason":"Scoped main tab selectors to data-tab, oauth controls clickable again"}
{"id":"routecodex-105","title":"daemon-admin: token portal should use actual running server port","description":"Acceptance Criteria\n- OAuth portal URL is generated even when ROUTECODEX_PORT/RCC_PORT env is unset.\n- Server publishes actual listen port for oauth lifecycle usage.\n- Manual auth from daemon-admin opens portal/camoufox as expected.","notes":"- root cause: portal base resolver relied on ROUTECODEX_PORT/RCC_PORT only; daemon-admin process often starts with config port and no env.\n- fix: server start exports ROUTECODEX_SERVER_PORT from actual bound port; resolver now falls back to ROUTECODEX_SERVER_PORT.\n- verification: daemon-admin.e2e + install:global passed.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T20:06:05.32161+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T20:06:05.600123+08:00","closed_at":"2026-02-08T20:06:05.600123+08:00","close_reason":"Portal base now resolves against live server port"}
{"id":"routecodex-106","title":"qwen oauth device polling interval unit mismatch blocks token save","description":"Acceptance Criteria\n- Qwen device flow does not wait 5000 seconds between token polls when polling.interval=5000.\n- Manual auth completion updates token file and status transitions from expired on next refresh.\n- Add regression test covering interval normalization behavior.","notes":"- root cause: poll interval used `(config.polling.interval || 5) * 1000` while configs already use milliseconds (5000), causing 5,000,000ms sleep.\n- fix: normalize interval units and prefer device-code response interval when provided.\n- files: src/providers/core/strategies/oauth-device-flow.ts, tests/providers/core/oauth-device-flow-polling-interval.spec.ts\n- verification: jest targeted suite + install:global passed.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T20:17:27.059996+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T20:17:27.346357+08:00","closed_at":"2026-02-08T20:17:27.346357+08:00","close_reason":"Polling interval normalization fixed; qwen manual oauth can complete and persist token"}
{"id":"routecodex-107","title":"Global process kill/shutdown audit logging","description":"Acceptance Criteria\n- RouteCodex writes lifecycle events to ~/.routecodex/logs/process-lifecycle.jsonl.\n- Every signal-handler entry logs receipt + trigger (SIGTERM/SIGINT/SIGUSR2/uncaughtException).\n- Every internal kill attempt (port cleanup / restart/shutdown self-kill) logs target pid, signal, and outcome.\n- Console prints concise blue lifecycle line for stop-related events to aid live diagnosis.\n- Add regression test for logger write + non-crash behavior.","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T20:44:20.705699+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T20:44:25.53049+08:00"}
{"id":"routecodex-108","title":"VirtualRouter: add multimodal route category with media-first routing","description":"Context\n- Add a dedicated multimodal route category distinct from vision detour.\n- For requests with image/video in latest user turn, prefer routing.multimodal directly.\n- If routing.multimodal is missing/empty, fallback directly to routing.vision.\n\nAcceptance Criteria\n- Introduce route category `multimodal` in Virtual Router priority/order and classification reasoning.\n- Media requests prioritize `routing.multimodal`; missing/empty multimodal falls back to `vision`.\n- Support pool priority inside multimodal route: iflow.kimi-k2.5 first, tab.gpt-5.2-codex fallback (config-driven).\n- Existing non-media routing behavior remains unchanged.\n- Add/update regression tests for classifier + route candidates + fallback behavior.\n- sharedmodule/llmswitch-core build/tests pass for touched scope.","acceptance_criteria":"- media latest-turn -\u003e multimodal\n- multimodal absent -\u003e vision\n- non-media unchanged\n- targeted router tests pass\n- sharedmodule build passes","notes":"Implementation completed:\n- Added `multimodal` to Virtual Router route priority and media classifier mapping.\n- Media routing now prefers `routing.multimodal`; falls back to `vision` when multimodal pool is absent.\n- Limited kimi/responses inline media boosting to multimodal route tier selection.\n- Updated route color mapping for multimodal hits.\n- Updated router regression scripts/tests for multimodal + fallback behavior.\n- Updated local runtime config: ~/.routecodex/config.json with multimodal primary(iflow.kimi-k2.5)/backup(tab.gpt-5.2-codex).\n\nVerification evidence:\n- cd sharedmodule/llmswitch-core \u0026\u0026 node scripts/tests/run-matrix-ci.mjs âœ… (Matrix passed)\n- cd /Users/fanzhang/Documents/github/routecodex \u0026\u0026 npm run -s build:dev âœ…\n- RouteCodex build stack also completed install:global + mock regressions + blackbox checks in build:dev pipeline.","status":"closed","priority":0,"issue_type":"feature","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T21:29:53.85335+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T21:41:41.792777+08:00","closed_at":"2026-02-08T21:41:41.792777+08:00","close_reason":"multimodal route category implemented and verified","labels":["multimodal","routing","virtual-router","vision"]}
{"id":"routecodex-109","title":"CLI stop requires password and align /shutdown auth","description":"Acceptance Criteria\n- `routecodex stop` requires explicit `--password` and rejects missing/invalid credentials.\n- Password can be overridden via env (`ROUTECODEX_STOP_PASSWORD` / `RCC_STOP_PASSWORD`).\n- Add/keep regression tests for password gate behavior.\n- Track whether `/shutdown` route should adopt the same password requirement and document decision.","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-08T21:40:27.616268+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T21:40:27.616268+08:00"}
{"id":"routecodex-11","title":"Qwen userInfo 404 æ—¶é™çº§å¹¶å›å¡« api_key","description":"## Problem\nQwen OAuth å¯åŠ¨æ—¶å°è¯•é€šè¿‡ userInfo æ¥å£è¡¥é½ api_keyï¼Œä½†å½“å‰ userInfo ç«¯ç‚¹è¿”å› 404ï¼Œå¯¼è‡´æ—¥å¿—æŠ¥é”™ä¸”æ— æ³•è¡¥é½ã€‚\n\n## Acceptance Criteria\n- å½“ userInfo 404 æ—¶ï¼Œä¸å†æŠ¥é”™ï¼ˆé™çº§ä¸º debugï¼‰ï¼Œå¹¶å°† api_key å›å¡«ä¸º access_tokenï¼ˆç­‰ä»·äºç°æœ‰ Authorization è¡Œä¸ºï¼Œä¸”å¯é¿å…é‡å¤å°è¯• userInfoï¼‰\n- fetchQwenUserInfo ä¸å†æŠŠ access_token æ”¾åœ¨ URL queryï¼ˆä¼˜å…ˆ Authorization headerï¼‰ï¼Œå¹¶æ”¯æŒå¤šç§ query å‚æ•°åä½œä¸ºå…¼å®¹\n- Jest è¦†ç›–ï¼šuserInfo 404 æ—¶ ensureValidOAuthToken ä»å†™å…¥ api_key","notes":"Fix: when Qwen userInfo endpoint returns 404, treat access_token as api_key and avoid repeated userInfo calls; also fetchQwenUserInfo no longer leaks tokens in URL (prefers Authorization header, then query fallback).\n\nChanges:\n- src/providers/auth/qwen-userinfo-helper.ts: supports env override for userInfo URL; tries bearer first\n- src/providers/auth/oauth-lifecycle.ts: 404 =\u003e merge api_key=access_token; log downgraded to debug\n- tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts: adds 404 fallback test\n\nEvidence:\n- npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts (PASS)","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T12:42:18.643264+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T12:44:52.651002+08:00","closed_at":"2026-02-04T12:44:52.651002+08:00","close_reason":"Qwen userInfo 404 é™çº§ï¼šå›å¡« api_key=access_token","labels":["auth","bug","qwen"]}
{"id":"routecodex-110","title":"Fix exec_command(apply_patch) compatibility rewrite","description":"Acceptance Criteria\n- Reproduce latest codex sample showing exec_command wrapping apply_patch.\n- Rewrite these tool calls to apply_patch in llmswitch-core response/request tool governance.\n- Add regression tests proving rewrite for response and request history.","notes":"Evidence: codex sample req_1770602912613_f8001c03 had function.name=exec_command wrapping apply_patch; after rewrite in llmswitch-core tool-governor, normalizeApplyPatchToolCallsOnResponse outputs function.name=apply_patch and request path injects [Codex NestedApplyPatch Policy]. Tests passed: tool-governor-apply-patch-rewrite + tool-guidance-exec-command.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-09T10:19:59.010734+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T10:33:07.963759+08:00","closed_at":"2026-02-09T10:20:14.610299+08:00","close_reason":"Added llmswitch-core rewrite for exec_command(apply_patch) and regression tests."}
{"id":"routecodex-111","title":"æ”¯æŒ !provider.model:passthrough å¯¹è¯çº§ç›´é€šä¸åŸå§‹å¿«ç…§","description":"Acceptance Criteria\n- æ”¯æŒåœ¨æ¶ˆæ¯ä¸­ä½¿ç”¨ \u003c**!provider.model:passthrough**\u003e æŒ‡å®šæœ¬æ¬¡å¯¹è¯è·¯ç”±åˆ°ç›®æ ‡ provider.model ä¸” processMode=passthroughã€‚\n- passthrough ç”Ÿæ•ˆæ—¶ä¿ç•™å¹¶è®°å½•å…¥å£åŸå§‹è¯·æ±‚ä¸åŸå§‹å“åº”å¿«ç…§ï¼Œä¾¿äºæ’æŸ¥å¯¹è¯ä¸­æ–­ã€‚\n- ä¸å½±å“æœªä½¿ç”¨è¯¥å‘½ä»¤çš„ç°æœ‰è·¯ç”±è¡Œä¸ºã€‚\n- è‡³å°‘è¡¥å……/æ›´æ–°ä¸€æ¡å›å½’éªŒè¯ï¼ˆè„šæœ¬æˆ–æµ‹è¯•ï¼‰ã€‚","notes":"Execution progress: parser/state/pipeline passthrough audit changes completed with targeted tests + tsc pass. Remaining: same-shape + control replay evidence collection before close.","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-09T10:35:06.296446+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:22:56.549669+08:00"}
{"id":"routecodex-111.1","title":"parser: passthrough mode gating + suffix fallback","description":"å®ç° \u003c**!provider.model:passthrough**\u003e çš„è§£æä¸æ¨¡å¼é—¨æ§ï¼Œå¹¶ä¿è¯æœªå£°æ˜ passthrough æ—¶ä¿æŒ chatã€‚","acceptance_criteria":"- ä»…å½“æ ‡ç­¾å†…åŒ…å« :passthrough æ‰è®¾ç½® processMode=passthrough\\n- æ— åç¼€æˆ–æœªçŸ¥åç¼€æ—¶æŒ‰ chat å¤„ç†\\n- ä¸å½±å“ allow/disable/enable/force æ—¢æœ‰è§£æ","notes":"Implemented parser mode-gating in sharedmodule/llmswitch-core/src/router/virtual-router/routing-instructions.ts: only :passthrough enables passthrough; unknown suffix falls back to regular mode.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-09T11:11:25.445239+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:22:47.991062+08:00","closed_at":"2026-02-09T11:22:47.991062+08:00","dependencies":[{"issue_id":"routecodex-111.1","depends_on_id":"routecodex-111","type":"parent-child","created_at":"2026-02-09T12:26:01.655158+08:00","created_by":"import"}]}
{"id":"routecodex-111.2","title":"state: persist processMode in force/sticky/prefer","description":"å°† processMode ä»æŒ‡ä»¤è§£æç»“æœå†™å…¥ force/sticky/prefer çŠ¶æ€ï¼Œå¹¶éšä¼šè¯æ¢å¤ã€‚","acceptance_criteria":"- applyRoutingInstructions ä¸‰ç±» target å‡æŒä¹…åŒ– processMode\\n- ååºåˆ—åŒ–å processMode ä¸ä¸¢å¤±\\n- è·¯ç”±å‘½ä¸­å target.processMode ä¸æŒ‡ä»¤ä¸€è‡´","notes":"Persisted processMode for force/sticky/prefer in applyRoutingInstructions and propagated instruction mode into selected target metadata in sharedmodule/llmswitch-core/src/router/virtual-router/engine.ts.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-09T11:11:25.571692+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:22:48.09856+08:00","closed_at":"2026-02-09T11:22:48.09856+08:00","dependencies":[{"issue_id":"routecodex-111.2","depends_on_id":"routecodex-111","type":"parent-child","created_at":"2026-02-09T12:26:01.656212+08:00","created_by":"import"}]}
{"id":"routecodex-111.3","title":"chat-process: passthrough parse+record only","description":"passthrough ä¸‹ chat_process ä»…åšè§£æä¸è®°å½•ï¼Œä¸è§¦å‘æ²»ç†æ³¨å…¥ã€‚","acceptance_criteria":"- passthrough ä¸‹ä¸è¿›å…¥ tool governance/continue_execution æ³¨å…¥\\n- è®°å½• parse-only å®¡è®¡èŠ‚ç‚¹\\n- é passthrough è¡Œä¸ºä¸å˜","notes":"Added parse+record-only branch for passthrough in HubPipeline request governance stage with explicit node metadata skip reason.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-09T11:11:25.701872+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:22:48.20593+08:00","closed_at":"2026-02-09T11:22:48.20593+08:00","dependencies":[{"issue_id":"routecodex-111.3","depends_on_id":"routecodex-111","type":"parent-child","created_at":"2026-02-09T12:26:01.656853+08:00","created_by":"import"}]}
{"id":"routecodex-111.4","title":"pipeline: raw inbound/providerInput + todo in/out","description":"æ–°å¢ passthrough å®¡è®¡å¿«ç…§ï¼šraw inbound/providerInput ä¸ todo.inbound/outboundã€‚","acceptance_criteria":"- è®°å½• metadata.passthroughAudit.raw.inbound\\n- è®°å½• metadata.passthroughAudit.raw.providerInput\\n- è®°å½• todo.inbound ä¸ todo.outbound","notes":"Added metadata.passthroughAudit raw/todo snapshots (inbound/providerInput + todo.inbound/outbound + governance skip marker) in both request-stage and chat_process entry pipelines.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-09T11:11:25.82688+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:22:48.314317+08:00","closed_at":"2026-02-09T11:22:48.314317+08:00","dependencies":[{"issue_id":"routecodex-111.4","depends_on_id":"routecodex-111","type":"parent-child","created_at":"2026-02-09T12:26:01.657441+08:00","created_by":"import"}]}
{"id":"routecodex-111.5","title":"regression: same-shape + control replay matrix","description":"è¡¥é½ parser/state/passthrough çš„å›å½’æµ‹è¯•ä¸ same-shape/control å¤ç°è®°å½•ã€‚","acceptance_criteria":"- è‡³å°‘æ–°å¢ 1 æ¡ parser+state å•æµ‹\\n- è‡³å°‘æ–°å¢ 1 æ¡ pipeline passthrough å®¡è®¡å•æµ‹\\n- æä¾› same-shape + control replay è¯æ®","notes":"Added/updated regression tests: tests/servertool/routing-instructions.spec.ts, tests/servertool/virtual-router-routing-instructions.spec.ts, tests/servertool/hub-pipeline-passthrough-audit.spec.ts. Local replay evidence pending manual same-shape/control run.\nVerification: npm run jest:run -- --runTestsByPath tests/servertool/routing-instructions.spec.ts tests/servertool/virtual-router-routing-instructions.spec.ts tests/servertool/hub-pipeline-passthrough-audit.spec.ts (PASS 41 tests). Verification: npx tsc --noEmit (PASS). build:dev attempt blocked by verify:repo-sanity due pre-existing untracked files tests/sharedmodule/tool-governor-apply-patch-rewrite.spec.ts and tests/sharedmodule/tool-guidance-exec-command.spec.ts.","status":"in_progress","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-09T11:11:25.953907+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-09T11:25:24.637222+08:00","dependencies":[{"issue_id":"routecodex-111.5","depends_on_id":"routecodex-111","type":"parent-child","created_at":"2026-02-09T12:26:01.658009+08:00","created_by":"import"}]}
{"id":"routecodex-12","title":"Fix Qwen OAuth userInfo endpoint + stable api_key","description":"## Context\nQwen OAuth login completes but token appears to not persist / keeps reauthing; logs show userInfo 404 and refresh failures.\n\n## Acceptance Criteria\n- Default Qwen userInfo endpoint no longer 404s in normal flows (switch to chat.qwen.ai and keep portal fallback).\n- If userInfo returns a stable api_key (different from access_token), token file is written with `norefresh: true`.\n- If api_key == access_token (fallback), treat it as non-stable and keep trying to enrich when possible.\n- Unit tests cover enrich + fallback behaviors.","notes":"- Evidence:\n  - `npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts tests/server/http-server/apikey-secret-resolution.spec.ts tests/server/http-server/httpserver-apikey-env-resolution.spec.ts` (PASS)\n  - `npm run install:global` builds + installs; `routecodex --version` prints 0.89.1669\n- Changes:\n  - Qwen userInfo default switched to `https://chat.qwen.ai/api/v1/user/info` with portal fallback: `src/providers/auth/qwen-userinfo-helper.ts`\n  - Qwen tokens: mark `norefresh: true` when api_key is stable; treat api_key==access_token as non-stable: `src/providers/auth/oauth-lifecycle.ts`, `src/providers/auth/qwen-userinfo-helper.ts`\n  - OAuth config default userInfoUrl aligned: `src/providers/core/config/provider-oauth-configs.ts`\n  - Tests updated/added: `tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts`","status":"closed","priority":0,"issue_type":"bug","assignee":"fanzhang","owner":"bot@routecodex.com","created_at":"2026-02-04T13:17:35.362682+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T13:18:29.09656+08:00","closed_at":"2026-02-04T13:18:29.09656+08:00","close_reason":"Qwen userInfo default uses chat.qwen.ai; stable api_key marked norefresh; enrich/fallback tests pass."}
{"id":"routecodex-13","title":"Allow startup with missing env apikeys (non-blocking provider init)","description":"## Context\nWhen config uses env refs (e.g. `${CRS_API_KEY}`) but env var is missing, RouteCodex currently aborts server startup. This makes shareable repo configs hard to use unless all keys are present.\n\n## Acceptance Criteria\n- Server can start even if some providers fail to init due to missing env var (emit provider error events + keep running).\n- Routing/request path fails over when a selected provider has no runtime handle.\n- Local providers (e.g. LM Studio localhost) can keep `auth.apiKey: \"\"` without fake keys and without blocking startup.","notes":"- Evidence:\n  - `routecodex start --config ~/.routecodex/config.json` now starts even with missing `${CRS_API_KEY}` etc; emits `[route-error] ... source=provider.provider.runtime.init` and continues.\n  - `lmstudio` runtime initializes with `auth.apiKey: \"\"` (no fake key) when endpoint is `http://127.0.0.1:...`.\n  - Tests: `npm run jest:run -- --runTestsByPath tests/server/http-server/apikey-secret-resolution.spec.ts tests/cli/start-command.spec.ts tests/sharedmodule/virtual-router-routing-model-validation.spec.ts` (PASS).\n- Implementation:\n  - Non-blocking provider init + failover for missing runtimes: `src/server/runtime/http-server/index.ts`.\n  - Local-noauth handling: `src/server/runtime/http-server/index.ts`, `src/providers/core/runtime/provider-factory.ts`, `src/providers/auth/apikey-auth.ts`.\n  - Local baseURL empty apikey allowed in llmswitch-core bootstrap: `sharedmodule/llmswitch-core/src/router/virtual-router/bootstrap.ts`.","status":"closed","priority":0,"issue_type":"bug","assignee":"fanzhang","owner":"bot@routecodex.com","created_at":"2026-02-04T13:52:58.463205+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T13:53:33.206022+08:00","closed_at":"2026-02-04T13:53:33.206022+08:00","close_reason":"Provider init no longer aborts startup on missing env apikey; local LM Studio accepts empty key; routing fails over when runtime missing."}
{"id":"routecodex-14","title":"Config: apikey env refs + startup gating","description":"## Goal\n- é»˜è®¤/ç¤ºä¾‹ config ä¸å«æ˜æ–‡ apikeyï¼Œæ”¯æŒ `${ENV}` å¼•ç”¨ï¼›å…¼å®¹ apikey ç›´å†™ï¼›OAuth ä¸æ”¹\n- å¯åŠ¨é˜¶æ®µï¼šåœ¨ runtime åˆå§‹åŒ–å®Œæˆå‰ hold /v1/chat|responses|messages è¯·æ±‚ï¼Œä¸åšæ— æ„ä¹‰å‘½ä¸­\n- provider ç¼ºå¤± apikey/auth ä¸åº”é˜»å¡å¯åŠ¨ï¼ˆæ ‡è®° unhealthy + è·¯ç”±å¯ failoverï¼‰\n\n## Acceptance Criteria\n- `tests/cli/config-command.spec.ts` å…¨éƒ¨é€šè¿‡ï¼ˆå°¤å…¶ non-interactive init ä¸è¿›å…¥äº¤äº’ï¼‰\n- server åœ¨å­˜åœ¨ç¼ºå¤± auth çš„ provider æ—¶ä»èƒ½å¯åŠ¨ï¼Œ/health æ˜¾ç¤º starting-\u003eok\n- runtime æœª ready æ—¶å¯¹ /v1/responses ç­‰è¯·æ±‚ä¼šç­‰å¾…ç›´åˆ° readyï¼ˆæˆ–è¶…æ—¶è¿”å› 503ï¼‰\n- configsamples/config.json ä¸ ~/.routecodex/config.json æ¨¡æ¿ä¸€è‡´ä¸”å¯æ”¾å…¥ repoï¼ˆæ— æ˜æ–‡ keyï¼‰","notes":"Evidence (2026-02-04):\n- Core: `cd sharedmodule/llmswitch-core \u0026\u0026 npm run build` (PASS)\n- Host: `npm run test:cli` (PASS)\n- Host: `npm run build:dev` (PASS; includes unified-hub-shadow, e2e-toolcall, routing-instructions, cli, install:global, mock:regressions, blackbox antigravity parity)\n- Startup gating: /v1/chat|messages|responses handlers wait on runtime-ready (timeout via ROUTECODEX_STARTUP_HOLD_MS)\n- Optional auth: llmswitch-core VirtualRouter no longer blocks bootstrap when apiKey auth missing; provider init errors are surfaced via ProviderErrorEvent without crashing server\n- Config template: apikey uses `${ENV}` (shareable config); LM Studio sample uses empty apiKey for no-auth local baseURL\n","status":"closed","priority":0,"issue_type":"task","assignee":"fanzhang","owner":"bot@routecodex.com","created_at":"2026-02-04T14:11:34.570463+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T14:23:21.492246+08:00","closed_at":"2026-02-04T14:23:21.492246+08:00","close_reason":"Implemented env-based apikey + startup hold + non-blocking missing auth; verified via build:dev","labels":["auth","config","server"]}
{"id":"routecodex-15","title":"TokenFileAuthProvider picks up token created after init","description":"## Problem\nWhen OAuth token file is created *after* provider initialization (common when user completes device-code login after server starts), TokenFileAuthProvider may keep failing and server appears to \"not take token\" until restart.","acceptance_criteria":"- TokenFileAuthProvider can start with missing token file (status invalid) but later, after token file appears, buildHeaders succeeds without requiring restart/re-init.\n- Unit test covers late token creation.","notes":"Fix:\n- TokenFileAuthProvider now starts leniently (token file may be missing at init) and re-reads token from disk on each buildHeaders/validateCredentials, so tokens created after OAuth complete are picked up without restart.\n\nFiles:\n- src/providers/auth/tokenfile-auth.ts\n- tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts\n\nEvidence:\n- npm run jest:run -- --runTestsByPath tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts tests/providers/auth/tokenfile-auth.iflow.spec.ts (PASS)\n- npm run build:dev (PASS)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T15:30:56.189143+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T15:41:01.545528+08:00","closed_at":"2026-02-04T15:41:01.545528+08:00","close_reason":"TokenFileAuthProvider can pick up late-created token files","labels":["auth","tokenfile"]}
{"id":"routecodex-16","title":"Antigravity 403 verify-account triggers interactive OAuth","description":"## Problem\nAntigravity/Gemini upstream may return HTTP 403 with messages like \"verify your account\" / \"validation_required\" / \"accounts.google.com/signin/continue\". Today this does not trigger interactive OAuth repair, so requests fail without auto portal/browser flow.","acceptance_criteria":"- When upstream error is 403 and message contains verify-account/validation_required/accounts.google.com/signin/continue (or support.google.com/accounts?p=al_alert), provider triggers interactive OAuth repair (openBrowser=true) via oauth-lifecycle.\n- Unit test covers classification.","notes":"Fix:\n- Treat Antigravity/Gemini HTTP 403 verify-account / validation_required / accounts.google.com/signin/continue as an interactive OAuth repair trigger (openBrowser flow).\n\nFiles:\n- src/providers/auth/oauth-lifecycle.ts\n- tests/providers/auth/oauth-lifecycle-antigravity-verify-account.spec.ts\n\nEvidence:\n- npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle-antigravity-verify-account.spec.ts (PASS)\n- npm run build:dev (PASS)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T15:30:56.389448+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T15:41:01.734337+08:00","closed_at":"2026-02-04T15:41:01.734337+08:00","close_reason":"403 verify-account now triggers interactive OAuth repair","labels":["antigravity","oauth"]}
{"id":"routecodex-17","title":"Qwen oauth command should not force reauth when token valid","description":"## Problem\n`routecodex oauth \u003ctokenFile\u003e` currently always runs interactive OAuth with `forceReauthorize=true`, so even after a successful authorization it keeps asking the user to authenticate again, causing a perceived \"infinite auth loop\".\n\nAdditionally, when user config has no qwen provider, the token file will never be used, which increases confusion.","acceptance_criteria":"- `routecodex oauth \u003cselector\u003e` skips opening browser when the token state is valid and not near expiry, unless `--force` is provided.\n- When token is expiring/expired/invalid, it attempts non-forced refresh first and only falls back to interactive flow when needed.\n- For qwen tokens, prints a clear warning if loaded user config has no qwen provider entry.","notes":"Fix:\n- `routecodex oauth \u003cselector\u003e` no longer forces interactive reauth every time. It skips when token is valid, and only does forced reauth when `--force` is used.\n- Explicit reauth commands (token-daemon refresh, oauth *-auto, reauth-required) keep forcing reauth.\n- For qwen token, warns when user config has no qwen provider entry (token would never be used).\n\nFiles:\n- src/token-daemon/index.ts\n- src/commands/oauth.ts\n- src/commands/token-daemon.ts\n- tests/token-daemon/interactive-refresh.spec.ts\n- scripts/tests/ci-jest.mjs\n- package.json\n\nEvidence:\n- npm run jest:run -- --runTestsByPath tests/token-daemon/interactive-refresh.spec.ts (PASS)\n- npm run build:dev (PASS)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T15:46:31.442492+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T15:53:30.31494+08:00","closed_at":"2026-02-04T15:53:30.31494+08:00","close_reason":"OAuth command no longer forces reauth when token valid","labels":["cli","oauth","qwen"]}
{"id":"routecodex-18","title":"Qwen Camoufox auto: click confirm on authorize page","description":"## Goal\nAdd a `qwen-auto` OAuth helper similar to `gemini-auto`/`antigravity-auto`, using Camoufox automation to click Qwen's authorize confirmation button after portal redirect.\n\n## Context\nQwen authorize page shows a Confirm button like: `button.qwen-confirm-btn` (span text: Confirm).\n\n## Acceptance Criteria\n- New CLI command: `routecodex oauth qwen-auto \u003cselector\u003e` runs Camoufox in auto mode `qwen` (headless by default) and performs the confirm click.\n- `scripts/camoufox/launch-auth.mjs` supports `--auto-mode qwen` and clicks `button.qwen-confirm-btn` when present.\n- `npm run build:dev` passes (includes global install).\n","notes":"Implemented Qwen auto confirm click.\n\nChanges:\n- src/commands/oauth.ts: add `qwen-auto` command (Camoufox automation mode=qwen)\n- scripts/camoufox/launch-auth.mjs: support auto-mode qwen, click `button.qwen-confirm-btn`\n\nEvidence:\n- npm run build:dev (PASS, includes install:global)\n\nUsage:\n- routecodex oauth qwen-auto qwen-oauth-1-default.json\n","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T15:58:54.140874+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T16:03:36.868305+08:00","closed_at":"2026-02-04T16:03:36.868305+08:00","close_reason":"qwen-auto added; camoufox clicks confirm button","labels":["camoufox","oauth","qwen"]}
{"id":"routecodex-19","title":"Qwen qwen-auto: wait for confirm settle + fix manual fallback (no localhost callback)","description":"## Problem\nQwen uses a device-code style authorize page (e.g. https://chat.qwen.ai/authorize?user_code=...), not a localhost OAuth callback.\n\nCurrent `qwen-auto` clicks `button.qwen-confirm-btn` but closes shortly after, and the auto fallback path (headed manual assist) waits for a localhost callback that will never happen for Qwen.\n\n## Acceptance Criteria\n- After clicking `button.qwen-confirm-btn`, qwen-auto waits for a reasonable \"settled\" signal (URL change, button disappearance, or success UI) before closing the browser.\n- If auto selector matching fails and we fall back to headed mode, Qwen fallback does NOT wait for a localhost callback; it should instead keep the browser open for manual completion and exit when the user closes it or after a timeout.\n- Add a small unit test ensuring `qwen-auto` subcommand is registered under `oauth`.\n- `npm run build:dev` passes.\n","notes":"Fix:\n- TokenDaemon background refresh no longer opens interactive OAuth (prevents Qwen auth popups during build/install).\n- qwen-auto automation waits for confirm to settle and has a Qwen-specific headed fallback that does not wait for localhost callback.\n- Added unit tests and included them in routing/CI test lists.\n\nFiles:\n- src/token-daemon/token-daemon.ts\n- scripts/camoufox/launch-auth.mjs\n- tests/token-daemon/token-daemon.auto-refresh-noninteractive.spec.ts\n- tests/commands/oauth-command.qwen-auto.spec.ts\n- package.json\n- scripts/tests/ci-jest.mjs\n\nEvidence:\n- npm run build:dev (PASS, includes install:global)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T16:06:09.420148+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T16:18:24.501065+08:00","closed_at":"2026-02-04T16:18:24.318598+08:00","close_reason":"Stop qwen auth popups during build; harden qwen-auto","labels":["camoufox","oauth","qwen"]}
{"id":"routecodex-2","title":"Epic: Init-only Web UIï¼ˆrcc init / rcc startï¼‰","description":"ä» task.md è¿ç§»ï¼šI1-I4 init-only Web UI æ–¹æ¡ˆå®ç°ä¸éªŒæ”¶ã€‚\\n\\néªŒæ”¶ï¼š\\n- rcc init å¯å¯åŠ¨ init-only server+UI\\n- rcc start åœ¨æ—  config æ—¶è¿›å…¥ init UI\\n- OAuth alias é»˜è®¤è§„åˆ™è½åœ°\\n- ç”Ÿæˆçš„ routing è‡³å°‘åŒ…å« default target","status":"open","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:34:15.241737+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:34:15.241737+08:00"}
{"id":"routecodex-2.1","title":"Init UIï¼šI1 init-only server + UI","description":"å®ç° init-only server + UIï¼ˆæœ¬åœ°è®¿é—®ã€æ”¯æŒ OAuth/ApiKeyã€é»˜è®¤ route æ± ã€å¯å›é€€åˆ° adminï¼‰ã€‚å‚è€ƒï¼šsrc/server/runtime/init-server.ts, docs/init-ui.html","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:47.755495+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:47.755495+08:00","dependencies":[{"issue_id":"routecodex-2.1","depends_on_id":"routecodex-2","type":"parent-child","created_at":"2026-02-03T19:28:31.396242+08:00","created_by":"import"}]}
{"id":"routecodex-2.2","title":"Init UIï¼šI2 CLI å…¥å£è¡Œä¸ºå¯¹é½","description":"rcc init å¯åŠ¨ init-onlyï¼›rcc start æ—  config è‡ªåŠ¨è¿›å…¥ init UIã€‚å‚è€ƒï¼šsrc/cli/commands/init.ts, src/cli/commands/start.ts, src/index.ts","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:47.879322+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:47.879322+08:00","dependencies":[{"issue_id":"routecodex-2.2","depends_on_id":"routecodex-2","type":"parent-child","created_at":"2026-02-03T19:28:31.396704+08:00","created_by":"import"}]}
{"id":"routecodex-2.3","title":"Init UIï¼šI3 OAuth alias é»˜è®¤è§„åˆ™","description":"alias é»˜è®¤å– email @ å‰ç¼€å¹¶å»æ‰ . ä¸æ ‡ç‚¹ï¼Œä»…å­—æ¯/æ•°å­—ã€‚å‚è€ƒï¼šsrc/server/runtime/init-server.ts","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:48.005137+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:48.005137+08:00","dependencies":[{"issue_id":"routecodex-2.3","depends_on_id":"routecodex-2","type":"parent-child","created_at":"2026-02-03T19:28:31.39714+08:00","created_by":"import"}]}
{"id":"routecodex-2.4","title":"Init UIï¼šI4 è·¯ç”±æ± é…ç½® + é»˜è®¤è·¯ç”±","description":"é»˜è®¤ default è·¯ç”±å¿…é¡»è‡³å°‘ä¸€ä¸ª targetï¼›UI å¿…é¡»å¼ºæ ¡éªŒã€‚å‚è€ƒï¼šdocs/init-ui.html, src/server/runtime/init-server.ts","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:48.124449+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:48.124449+08:00","dependencies":[{"issue_id":"routecodex-2.4","depends_on_id":"routecodex-2","type":"parent-child","created_at":"2026-02-03T19:28:31.397568+08:00","created_by":"import"}]}
{"id":"routecodex-20","title":"Docs: unify OAuth README (auth + refresh + auto modes)","description":"## Goal\nProvide a single, up-to-date OAuth README that explains:\n- How to authenticate (manual + Camoufox automation)\n- How refresh works (background silent vs explicit interactive)\n- Token file naming and `tokenFile` alias usage\n- Common troubleshooting (\"authorized but server doesn't use token\")\n\n## Acceptance Criteria\n- Add `docs/OAUTH.md` as the canonical OAuth guide.\n- Update `README.md` docs list to include it.\n- Update existing older OAuth docs (`docs/oauth-authentication-guide.md`, `src/providers/auth/README_OAUTH.md`) to point to `docs/OAUTH.md` (keep old content but clearly mark as legacy).\n- Update `docs/PROVIDERS_BUILTIN.md` Qwen snippet to use `tokenFile: \"default\"`.\n- `npm run verify:repo-sanity` passes.\n","notes":"Evidence\\n- Added canonical OAuth doc: docs/OAUTH.md\\n- Linked from README.md and aligned Qwen config in docs/PROVIDERS_BUILTIN.md\\n- Marked legacy docs to defer to docs/OAUTH.md: docs/oauth-authentication-guide.md, docs/oauth-iflow-implementation.md, src/providers/auth/README_OAUTH.md\\n- Updated daemon docs to avoid legacy qwen-oauth.json naming: docs/token-refresh-daemon-plan.md, docs/token-daemon-preview.html\\n\\nVerification\\n- npm run verify:repo-sanity  â†’ [repo-sanity] ok\\n- npm run build:dev           â†’ OK (full dev verification stack)\\n- npm run install:global      â†’ OK (routecodex --version = 0.89.1682)\\n","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T16:26:23.902201+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T16:36:18.672769+08:00","closed_at":"2026-02-04T16:36:18.672769+08:00","close_reason":"Unified OAuth docs + aligned Qwen tokenFile alias; verified with repo-sanity/build:dev/global install","labels":["docs","oauth"]}
{"id":"routecodex-21","title":"fix(qwen): invalid refresh token should not spam/block","description":"## Steps to Reproduce\n1. Have a Qwen OAuth token file where refresh_token is invalid (revoked/expired) or client_id mismatch.\n2. Start server (TokenDaemon enabled) or wait for TokenDaemon tick.\n3. Observe repeated logs like: OAuth error: invalid_request - Invalid refresh token or client_id.\n\n## Expected\n- Auto-refresh should fail fast on permanent refresh errors and stop retrying/spamming until token file changes.\n- Non-Qwen traffic should not be impacted by Qwen refresh failures.\n\n## Actual\n- Refresh retries multiple times and keeps trying periodically, producing noisy logs and perceived blocking.\n\n## Acceptance Criteria\n- Abort OAuth refresh retry loop early on permanent refresh errors (invalid_request/invalid_grant/invalid_client related to refresh token/client_id).\n- TokenDaemon auto-suspends token immediately on permanent refresh failure until token file mtime changes.\n- Add/adjust unit tests covering this behavior.\n- Run verification: npm run verify:repo-sanity + targeted jest.\n","notes":"Evidence\\n- Early abort for permanent refresh errors: src/providers/core/strategies/oauth-device-flow.ts, src/providers/core/strategies/oauth-auth-code-flow.ts, src/providers/core/strategies/oauth-refresh-errors.ts\\n- TokenDaemon now classifies permanent refresh failure and immediately auto-suspends the token until token file mtime changes: src/token-daemon/token-daemon.ts, src/token-daemon/history-store.ts\\n\\nTests\\n- npm run verify:repo-sanity  â†’ [repo-sanity] ok\\n- npm run jest:run -- --runTestsByPath tests/token-daemon/history-store.auto-suspend-immediate.spec.ts tests/providers/core/oauth-refresh-permanent-errors.spec.ts  â†’ PASS\\n","status":"closed","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T16:47:05.704363+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T16:53:32.892995+08:00","closed_at":"2026-02-04T16:53:32.892995+08:00","close_reason":"Stop repeated Qwen refresh retries on permanent errors; auto-suspend until token changes; verified by tests","labels":["oauth","qwen","token-daemon"]}
{"id":"routecodex-22","title":"feat(qwen): pin tokenFile=default to qwen-oauth-1-default.json","description":"## Goal\nMake Qwen token references easier/safer by keeping a single stable default token file.\n\n## Acceptance Criteria\n- For Qwen only, `auth.tokenFile: \"default\"` resolves to `~/.routecodex/auth/qwen-oauth-1-default.json` when it exists; otherwise fall back to the latest `qwen-oauth-*-default.json`.\n- Update docs (`docs/OAUTH.md`) to reflect the pinned default behavior.\n- Add unit test covering the pinned behavior when both seq1 and seq2 exist.\n- Run verification (repo-sanity + relevant jest; ideally build:dev + global install).\n","notes":"Evidence\\n- Qwen tokenFile=\"default\" now prefers pinned seq=1 if present: src/providers/auth/tokenfile-auth.ts\\n- Qwen synthetic default token file path aligned to qwen-oauth-1-default.json: src/token-daemon/token-daemon.ts\\n- Docs updated: docs/OAUTH.md\\n\\nTests\\n- npm run verify:repo-sanity â†’ ok\\n- npm run jest:run -- --runTestsByPath tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts â†’ PASS\\n\\nVerification\\n- npm run build:dev â†’ OK\\n- npm run install:global â†’ OK (routecodex --version = 0.89.1684)\\n","status":"closed","priority":2,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T17:05:24.923216+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T17:09:05.482887+08:00","closed_at":"2026-02-04T17:09:05.482887+08:00","close_reason":"Pin Qwen tokenFile=default to stable qwen-oauth-1-default.json; verified","labels":["docs","oauth","qwen"]}
{"id":"routecodex-23","title":"bug(antigravity): 403 reauth should use camoufox auto + increase portal wait","description":"## Steps to Reproduce\n1. Antigravity upstream returns HTTP 403 with keywords like: \"verify your account\" / \"validation_required\" / \"accounts.google.com/signin/continue\".\n2. RouteCodex detects it and triggers interactive OAuth repair.\n3. Observe it does not use existing Camoufox auto flow, and portal readiness wait is too short under slow networks.\n\n## Expected\n- Interactive OAuth repair for Antigravity uses Camoufox auto flow (same as `routecodex oauth antigravity-auto ...`).\n- Portal readiness wait is sufficiently long (300s) to tolerate slow startup/latency before opening browser.\n\n## Actual\n- Repair opens without auto-mode, and portal readiness check can time out quickly.\n\n## Acceptance Criteria\n- When `handleUpstreamInvalidOAuthToken()` triggers for provider `antigravity`, it sets Camoufox auto mode to `antigravity` for the duration of the repair call.\n- OAuth portal readiness check timeout increases to 300 seconds (configurable via env), instead of ~3 seconds.\n- Add unit test(s) for the new portal wait configuration and/or the env-scoped auto-mode behaviour.\n- Run verification: `npm run verify:repo-sanity` + targeted jest (and ideally `npm run build:dev` + `npm run install:global`).\n","status":"in_progress","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T18:49:34.576862+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T18:49:42.433049+08:00","labels":["antigravity","camoufox","oauth"]}
{"id":"routecodex-24","title":"Qwen OAuth: stop reauth loop; add qwen-auto confirm click","description":"Acceptance Criteria:\\n- Server startup/build does not trigger interactive Qwen OAuth popups by default.\\n- On real request: attempt silent refresh; if refresh fails/invalid, trigger interactive OAuth flow and successfully writes token file.\\n- Qwen portal auto flow clicks Confirm button after portal redirect (Camoufox automation).\\n- Document: how to refresh vs reauth Qwen.","notes":"Started implementation: qwen auto confirm via Camoufox auto mode; reduce noisy refresh logs; skip token-daemon refresh for unconfigured providers. Pending full build:dev + install:global verification.\nEvidence\n- Auto repair env uses Camoufox + qwen auto mode: src/providers/auth/oauth-repair-env.ts\n- Manual `routecodex oauth qwen-oauth-1-default.json` defaults to qwen Camoufox auto mode (Confirm button): src/token-daemon/index.ts\n- Background token refresh skips unconfigured providers (override: ROUTECODEX_TOKEN_DAEMON_REFRESH_UNCONFIGURED=1): src/token-daemon/token-daemon.ts\n- Per-attempt refresh failures moved to debug logging to reduce noise: src/providers/core/strategies/oauth-device-flow.ts\n\nDocs\n- Updated docs/OAUTH.md with qwen auto default note + 403 cooldown + portal ready timeout envs\n\nVerification\n- npm run build:dev OK (includes install:global; routecodex --version = 0.89.1685)","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T19:02:07.443979+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T19:24:31.222069+08:00","closed_at":"2026-02-04T19:24:31.222069+08:00","close_reason":"Qwen OAuth loop mitigations + qwen auto confirm wiring; verified"}
{"id":"routecodex-25","title":"Remove polling health-sort behavior","description":"Acceptance Criteria:\\n- Remove any health-based sorting applied during polling/round-robin selection (keep availability/cooldown/blacklist gating).\\n- No config/route logic changes outside removing the sort behavior.\\n- Verify with routecodex build:dev + llmswitch-core virtual-router tests.\\n","notes":"Evidence\\n- Sharedmodule change: sharedmodule/llmswitch-core/src/router/virtual-router/engine-selection/tier-selection-select.ts (remove penalty-based ordering + retry best-pick)\\n- Sharedmodule commit: e60e673\\n\\nVerification\\n- sharedmodule/llmswitch-core: npm run test:virtual-router â†’ OK\\n- routecodex: npm run build:dev â†’ OK (includes install:global + blackbox)\\n","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-04T20:24:58.225813+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T20:25:28.907656+08:00","closed_at":"2026-02-04T20:25:28.907656+08:00","close_reason":"Removed health-based sorting from virtual-router polling/selection; verified"}
{"id":"routecodex-26","title":"bug(oauth): interactive reauth must not block requests","description":"## Problem\\nWhen upstream triggers interactive OAuth (e.g. antigravity 403 verify account), the provider layer blocks the in-flight request waiting up to 10 minutes for localhost callback. This prevents Virtual Router failover and breaks streaming sessions.\\n\\n## Acceptance Criteria\\n- In provider request path, interactive OAuth reauth never blocks the current request.\\n- Attempt silent refresh first; if still invalid or google verify required, start interactive OAuth in background (Camoufox auto env) with cooldown guard.\\n- Request returns promptly so Virtual Router can failover.\\n- Add unit tests for non-blocking behavior.\\n- Verify with \n\u003e routecodex@0.89.1686 build:dev\n\u003e bash -lc 'export BUILD_MODE=dev; npm run build \u0026\u0026 npm run test:unified-hub-shadow \u0026\u0026 npm run verify:e2e-toolcall \u0026\u0026 npm run verify:apply-patch \u0026\u0026 npm run verify:apply-patch-regressions \u0026\u0026 npm run verify:exec-command \u0026\u0026 npm run test:routing-instructions \u0026\u0026 npm run test:cli \u0026\u0026 npm run install:global \u0026\u0026 npm run mock:regressions \u0026\u0026 npm run test:blackbox-antigravity-parity \u0026\u0026 npm run verify:errorsamples \u0026\u0026 npm run verify:e2e-gemini-followup-sample'\n\n\n\u003e routecodex@0.89.1686 prebuild\n\u003e npm run verify:repo-sanity \u0026\u0026 echo skip-lint\n\n\n\u003e routecodex@0.89.1686 verify:repo-sanity\n\u003e node scripts/ci/repo-sanity.mjs + global install.\\n","notes":"Evidence\\n- Non-blocking interactive OAuth repair for provider requests: src/providers/auth/oauth-lifecycle.ts\\n- Provider runtime now calls non-blocking path: src/providers/core/runtime/http-transport-provider.ts\\n- Tests: tests/providers/auth/oauth-lifecycle.nonblocking-repair.spec.ts\\n\\nVerification\\n- npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle.nonblocking-repair.spec.ts â†’ PASS\\n- npm run build:dev â†’ OK (includes install:global + blackbox)\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T20:48:45.268214+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T20:51:01.077156+08:00","closed_at":"2026-02-04T20:51:01.077156+08:00","close_reason":"Interactive OAuth repair runs in background; requests fail fast for failover; verified"}
{"id":"routecodex-27","title":"bug(token-daemon): qwen refresh failure must be non-blocking + non-noisy","description":"## Problem\\nQwen refresh_token invalid triggers auto-refresh failure logs during server runtime. Even though it is background, it should never be perceived as blocking or stopping the server, and it should not spam 'Auto-refresh failed...' after we already mark token as permanently invalid.\\n\\n## Acceptance Criteria\\n- On permanent refresh failure (invalid_request refresh token/client_id etc), token-daemon auto-suspends and does not emit loud error logs each tick.\\n- Server traffic and provider requests remain unaffected (no blocking).\\n- Keep existing behavior: reauth is triggered only by real requests / explicit commands.\\n- Add/adjust tests as needed.\\n","notes":"Evidence\\n- TokenDaemon suppresses loud error logs on permanent refresh failure / user timeout; auto-suspend still applies: src/token-daemon/token-daemon.ts\\n\\nTests\\n- npm run jest:run -- --runTestsByPath tests/token-daemon/token-daemon.auto-refresh-noninteractive.spec.ts â†’ PASS\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T20:55:23.908202+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T20:56:13.14459+08:00","closed_at":"2026-02-04T20:56:13.14459+08:00","close_reason":"Suppress permanent refresh failure spam; auto-suspend token; non-blocking"}
{"id":"routecodex-28","title":"Qwen OAuth: refreshå¤±è´¥ä¸é˜»å¡/ä¸å¼¹çª— + tokenFile å¯¹é½","description":"Problem\n- Qwen token refresh returns invalid_request (Invalid refresh token or client_id) and causes repeated auth attempts/log spam during server start/build.\n- tokenFile resolution differs across subsystems (daemon/auth repair), making behavior inconsistent.\n\nAcceptance Criteria\n- Qwen refresh permanent failure never blocks server startup or request routing.\n- Background refresh does not repeatedly print \"Auto-refresh failed\" or trigger interactive OAuth.\n- Interactive OAuth repair is rate-limited (\u003e=30min cooldown) per provider+tokenFile.\n- Qwen tokenFile=\"default\" consistently resolves to ~/.routecodex/auth/qwen-oauth-1-default.json when present.\n- Documentation updated (docs/OAUTH.md referenced from README).\n\nEvidence\n- Commands: npm run build:dev; npm run install:global\n- Logs show no repeated qwen auth popup during build; no fatal errors.","notes":"- Evidence\n  - Commit: 5f97027b7\n  - Verified: `npm run build:dev` (includes `npm run install:global`) succeeded on 2026-02-04\n  - Files: src/providers/auth/oauth-lifecycle.ts, src/providers/auth/oauth-repair-cooldown.ts, src/token-daemon/token-daemon.ts, docs/OAUTH.md\n\n- Result\n  - Qwen tokenFile=\"default\" now consistently resolves to ~/.routecodex/auth/qwen-oauth-1-default.json when present.\n  - Interactive OAuth repair cooldown default set to 30m to prevent repeated reauth loops.\n  - Token daemon suppresses permanent refresh failure spam and best-effort marks token file as noRefresh to stop repeated retries.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T21:22:06.602586+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T21:30:06.10846+08:00","closed_at":"2026-02-04T21:29:36.121537+08:00","labels":["oauth","qwen"]}
{"id":"routecodex-29","title":"Quota: æ¸…ç† antigravity è™šå‡/è¿‡æœŸ aliasï¼ˆå¦‚ a1ï¼‰å¹¶ç¦æ­¢å‡­ç©ºç”Ÿæˆ","description":"Problem\n- ~/.routecodex/state/quota/antigravity.json é‡Œå‡ºç° antigravity://a1/... è¿™ç±» aliasï¼Œä½†æœ¬æœºæ²¡æœ‰å¯¹åº” token fileï¼›WebUI å±•ç¤ºå‡ºä¸å­˜åœ¨çš„è´¦å·ã€‚\n\nAcceptance Criteria\n- å¯åŠ¨/åˆ·æ–° quota æ—¶ä¼šè‡ªåŠ¨æ¸…ç† snapshot ä¸­ä¸å­˜åœ¨äºå½“å‰ token æ‰«æç»“æœçš„ aliasï¼ˆä¾‹å¦‚ a1ï¼‰ã€‚\n- Quota æ¨¡å—ä¸ä¼šæŠŠä¸å­˜åœ¨çš„ alias å†™å› stateï¼ˆä¸å‡­ç©ºç”Ÿæˆï¼‰ã€‚\n- ç°æœ‰ ~/.routecodex/state/quota/antigravity.json ä¼šè¢«ä¸€æ¬¡æ€§æ¸…ç†ï¼ˆç§»é™¤ antigravity://a1/ å‰ç¼€é¡¹ï¼‰ã€‚\n- éªŒè¯ï¼šnpm run build:devï¼ˆå« install:globalï¼‰é€šè¿‡ã€‚\n\nEvidence\n- State file path: ~/.routecodex/state/quota/antigravity.json\n- Commands: npm run build:dev\n","notes":"Evidence\\n- Code: src/manager/modules/quota/antigravity-quota-manager.ts (syncAntigravityTokensFromDisk prunes snapshot rows whose alias is not present in scanned token files)\\n- Test: npm run jest:run -- --runTestsByPath tests/manager/quota/quota-manager-refresh.spec.ts â†’ PASS\\n- Full verification: npm run build:dev â†’ PASS (includes install:global) on 2026-02-04\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T22:49:42.906892+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T23:49:03.382382+08:00","closed_at":"2026-02-04T23:49:03.382382+08:00","close_reason":"Prune quota snapshot aliases not backed by token files","labels":["antigravity","quota"]}
{"id":"routecodex-3","title":"Epic: llms-wasm åŒåŠ è½½ä¸å¼€å…³çŸ©é˜µï¼ˆW2ï¼‰","description":"ä» task.md è¿ç§»ï¼šW2 é˜¶æ®µ 1ï¼ˆHost ä¾§ WASM+TS åŒåŠ è½½ã€shadow/primary åˆ‡æ¢ã€ä¼˜å…ˆçº§çŸ©é˜µã€å½±å­åˆ†å‘ã€å¤±è´¥ä¸ŠæŠ¥ã€éš”ç¦»éªŒè¯ï¼‰ã€‚\\n\\néªŒæ”¶ï¼š\\n- Host å¯æŒ‰ ROUTECODEX_HUB_PIPELINE_IMPL åˆ‡æ¢ implï¼ˆts/wasm/shadow/splitï¼‰\\n- shadow éé˜»å¡ä¸”å¯è§‚æµ‹\\n- wasm åˆå§‹åŒ–å¤±è´¥é€šè¿‡ error center ä¸ŠæŠ¥","status":"open","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:34:23.578772+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:34:23.578772+08:00"}
{"id":"routecodex-3.1","title":"W2ï¼šå®ç° src/runtime/wasm-runtime ç»“æ„ä¸å…¥å£","description":"æ–°å¢ src/runtime/wasm-runtime/ å¹¶æ¥å…¥ç°æœ‰ runtime åˆå§‹åŒ–æµç¨‹ï¼ˆä¸å½±å“ ts ä¸»è·¯å¾„ï¼‰ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.235092+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.235092+08:00","dependencies":[{"issue_id":"routecodex-3.1","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.398003+08:00","created_by":"import"}]}
{"id":"routecodex-3.2","title":"W2ï¼šå®ç° WasmRuntime ç±»","description":"è´Ÿè´£ wasm åŠ è½½/åˆå§‹åŒ–/ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆload onceã€disposeã€é”™è¯¯ä¸ŠæŠ¥ï¼‰ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.361701+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.361701+08:00","dependencies":[{"issue_id":"routecodex-3.2","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.398419+08:00","created_by":"import"}]}
{"id":"routecodex-3.3","title":"W2ï¼šbridge: getHubPipelineCtorForImpl('wasm')","description":"æ‰©å±• src/modules/llmswitch/bridge æ”¯æŒ wasm HubPipeline ctor é€‰æ‹©ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.486951+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.486951+08:00","dependencies":[{"issue_id":"routecodex-3.3","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.398991+08:00","created_by":"import"}]}
{"id":"routecodex-3.4","title":"W2ï¼šensureHubPipelineEngineShadow åŠ è½½ wasm HubPipeline","description":"å®ç° host ä¾§ engine shadow loaderï¼ˆæŒ‰ llms-wasm/js/hub-pipeline.mjsï¼‰ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.610184+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.610184+08:00","dependencies":[{"issue_id":"routecodex-3.4","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.399695+08:00","created_by":"import"}]}
{"id":"routecodex-3.5","title":"W2ï¼šè§£æè¿è¡Œæ¨¡å¼å¼€å…³ ROUTECODEX_HUB_PIPELINE_IMPL","description":"æ”¯æŒ shadow/wasm_primary/ts_primary/splitï¼Œå¹¶è½åœ°ä¼˜å…ˆçº§è§£æå…¥å£ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.727086+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.727086+08:00","dependencies":[{"issue_id":"routecodex-3.5","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.400215+08:00","created_by":"import"}]}
{"id":"routecodex-3.6","title":"W2ï¼šå®ç°å¼€å…³ä¼˜å…ˆçº§çŸ©é˜µ","description":"å…¨å±€ \u003e ç§Ÿæˆ· \u003e è·¯ç”± \u003e è¯·æ±‚ çš„å†³ç­–çŸ©é˜µï¼Œç¡®ä¿å¯æµ‹è¯•/å¯è§‚æµ‹ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.848934+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.848934+08:00","dependencies":[{"issue_id":"routecodex-3.6","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.400692+08:00","created_by":"import"}]}
{"id":"routecodex-3.7","title":"W2ï¼šå®ç°å½±å­è¯·æ±‚åˆ†å‘é€»è¾‘","description":"ä¸»è·¯æ­£å¸¸è¿”å›ï¼›å½±å­å¼‚æ­¥æ‰§è¡Œ + è®°å½• diff/æŒ‡æ ‡ï¼›å¿…é¡»éé˜»å¡ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:01.963652+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:01.963652+08:00","dependencies":[{"issue_id":"routecodex-3.7","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.401158+08:00","created_by":"import"}]}
{"id":"routecodex-3.8","title":"W2ï¼šWASM åˆå§‹åŒ–å¤±è´¥ä¸ŠæŠ¥","description":"é€šè¿‡ providerErrorCenter + errorHandlingCenter ä¸ŠæŠ¥ï¼Œfail-fast ä¸é™é»˜ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:02.07796+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:02.07796+08:00","dependencies":[{"issue_id":"routecodex-3.8","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.401614+08:00","created_by":"import"}]}
{"id":"routecodex-3.9","title":"W2ï¼šéš”ç¦»éªŒè¯ï¼šåŒåŠ è½½äº’ä¸å½±å“","description":"å¢åŠ éš”ç¦»æµ‹è¯•ï¼Œç¡®ä¿ wasm/ts ä¸å…±äº«å¯å˜çŠ¶æ€å¯¼è‡´ä¸²æ‰°ã€‚","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:02.191061+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:02.191061+08:00","dependencies":[{"issue_id":"routecodex-3.9","depends_on_id":"routecodex-3","type":"parent-child","created_at":"2026-02-03T19:28:31.402069+08:00","created_by":"import"}]}
{"id":"routecodex-30","title":"Default config: apikey env refs + no-auth providers + RetryInfo 429 delay","description":"## Acceptance Criteria\n- ~/.routecodex/config.json can keep apikey fields as ${ENV_VAR} (or lowercase env tokens) without plaintext secrets.\n- Providers with apiKey=\"\" (e.g. lmstudio) do not make bootstrapVirtualRouterConfig fail.\n- 429 errors with Google RetryInfo.retryDelay are parsed into quotaResetDelay/cooldown, reducing repeated hits.\n","notes":"- Evidence:\n  - (sharedmodule/llmswitch-core) npm run build âœ… (2026-02-04)\n  - (routecodex) npm run build:dev âœ… (includes test:routing-instructions + test:cli + install:global)\n  - Global CLI prints version: routecodex 0.89.1690\n- Changes:\n  - llmswitch-core: allow empty/missing apiKey auth entries (LM Studio no-auth)\n  - routecodex: ${VAR} env refs resolve case-insensitively; parse Google RetryInfo.retryDelay for 429 cooldown\n","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T22:52:46.161822+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T23:01:51.275872+08:00","closed_at":"2026-02-04T23:01:51.275872+08:00","close_reason":"Implemented + verified (build:dev + global install)"}
{"id":"routecodex-31","title":"WebUI OAuth: authorize å¿…é¡»æ‹‰èµ· Camoufox autoï¼Œä¸” norefresh ä¸èƒ½å¯¼è‡´ no-op","description":"Problem\n- WebUI /daemon/oauth/authorize returns OK but does not open Camoufox / does nothing for qwen and antigravity.\n- Root cause: token files can be marked norefresh/noRefresh (e.g. Qwen refresh permanent failure) and ensureValidOAuthToken currently skips *all* refresh/reauth when norefresh is set, even for explicit user-triggered authorization.\n- Also, daemon-admin authorize does not set provider-specific Camoufox auto mode (qwen/antigravity/gemini).\n\nAcceptance Criteria\n- /daemon/oauth/authorize with openBrowser=true always launches Camoufox (not system browser) with provider-specific auto mode; auto fails -\u003e headed manual assist.\n- norefresh/noRefresh only disables background auto-refresh; it must NOT prevent explicit authorize (forceReauthorize/openBrowser).\n- Verified via unit tests + npm run build:dev (includes install:global).\n\nEvidence\n- Repro: WebUI Auth Provider Pool â†’ Authorize OAuth (qwen default / antigravity alias) should actually open Camoufox.\n- Commands: npm run build:dev\n","notes":"Evidence\\n- WebUI authorize now uses Camoufox-only flow + install hint: src/server/runtime/http-server/daemon-admin/credentials-handler.ts\\n- Camoufox availability check (no auto-install for WebUI): src/providers/core/config/camoufox-launcher.ts\\n- Explicit authorize bypasses throttle + norefresh no longer blocks explicit openBrowser/forceReauthorize: src/providers/auth/oauth-lifecycle.ts\\n- Camoufox strict mode (no fallback to system browser when ROUTECODEX_OAUTH_BROWSER=camoufox): src/providers/core/config/oauth-flows.ts\\n- Token refresh daemon uses Camoufox auto for qwen refreshâ†’reauth path: src/token-daemon/token-daemon.ts\\n- Default server refreshAhead=30min: src/manager/modules/token/index.ts\\n- Docs: docs/OAUTH.md\\n- Tests:\\n  - npm run jest:run -- --runTestsByPath tests/providers/auth/oauth-lifecycle.norefresh-explicit-authorize.spec.ts â†’ PASS\\n  - npm run test:routing-instructions â†’ PASS\\n- Full verification: npm run build:dev â†’ PASS (includes install:global) on 2026-02-04\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T23:02:59.861655+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T23:49:16.494094+08:00","closed_at":"2026-02-04T23:49:16.494094+08:00","close_reason":"Fix WebUI OAuth no-op; enforce Camoufox auto and explicit authorize semantics","labels":["oauth","webui"]}
{"id":"routecodex-32","title":"bug(oauth/webui): verify-required open must use Camoufox","description":"## Problem\n- daemon-admin Auth Provider Pool shows antigravity token status \"verify required\" with an \"open\" link that opens in the system browser, not Camoufox.\n- For manual CLI refresh (routecodex oauth ...), Camoufox automation can run headless and looks like a hang while waiting for localhost callback.\n\n## Acceptance Criteria\n- In daemon-admin credentials table, \"open\" triggers Camoufox (stable profile+fingerprint) instead of system browser.\n- If Camoufox is missing, return actionable error (camoufox_missing).\n- CLI interactive OAuth refresh defaults to headed Camoufox so users can complete login/2FA/verification.\n- Verified via npm run build:dev (includes install:global).","notes":"Evidence\\n- WebUI \"verify required\" open now launches Camoufox (stable profile) instead of system browser:\\n  - UI: docs/daemon-admin-ui.html\\n  - Backend: src/server/runtime/http-server/daemon-admin/credentials-handler.ts (POST /daemon/oauth/open)\\n- CLI interactive OAuth refresh now defaults to headed Camoufox: src/token-daemon/index.ts\\n- Docs: docs/OAUTH.md\\n\\nVerification\\n- npm run jest:run -- --runTestsByPath tests/server/http-server/daemon-admin.e2e.spec.ts tests/cli/smoke.spec.ts â†’ PASS\\n- npm run build:dev â†’ PASS (includes install:global) on 2026-02-04\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T00:30:22.716926+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T00:32:57.329269+08:00","closed_at":"2026-02-05T00:32:57.329269+08:00","close_reason":"Use Camoufox for verify-required open + make CLI refresh visible","labels":["camoufox","oauth","webui"]}
{"id":"routecodex-33","title":"bug(antigravity): 403 needs-auth rotate alias + 30m cooldown","description":"When an Antigravity account returns HTTP 403 indicating OAuth is missing/expired (NOT Google account verification gating), routing should immediately switch to another alias and prevent the failing alias from being scheduled for 30 minutes.\n\nMotivation: avoid repeated 403 hammering and unblock queue.","acceptance_criteria":"- On ProviderErrorEvent(status=403, needs-auth), all providerKeys under the same antigravity alias are set out-of-pool with cooldownUntil \u003e= now+30m.\n- In a single request retry loop, the failing antigravity providerKey is excluded so router can pick another alias (do not set antigravityAvoidAllOnRetry).\n- Existing 403 google verification flow unchanged.\n- Regression tests cover both quota daemon + request executor behavior.","notes":"Implemented Antigravity 403 (OAuth reauth-required) handling.\n\nEvidence:\n- Quota daemon now cools down entire alias for 30min on needs-auth 403 (not Google verify).\n  Files: src/manager/modules/quota/provider-quota-daemon.events.ts\n  Test: tests/manager/quota/provider-quota-daemon-module.spec.ts (\"cools down an antigravity alias for 30m on OAuth reauth-required 403\")\n- Request executor now treats Antigravity 403 auth errors as retryable and excludes failing providerKey so router can pick another alias.\n  Files: src/server/runtime/http-server/request-executor.ts\n  Test: tests/server/runtime/http-server/request-executor.spec.ts (\"rotates antigravity alias on 403 OAuth reauth-required error\")\n\nVerification:\n- npm run test:routing-instructions (passed)\n- npm run test:cli (passed)\n- npm run build:dev (passed; includes install:global + blackbox antigravity parity)","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T00:38:33.072403+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T00:49:30.303687+08:00","closed_at":"2026-02-05T00:49:30.303687+08:00","close_reason":"antigravity needs-auth 403 rotates + 30m cooldown","labels":["antigravity","oauth","quota"]}
{"id":"routecodex-34","title":"bug(quota): network/fetch errors should not backoff-loop","description":"## Problem\n- Network/transport failures (e.g. \"fetch failed\") can cause repeated short backoffs and do not remove the provider from the pool long enough, leading to request storms and session aborts.\n\n## Acceptance Criteria\n- Repeated network/fetch errors within the error-chain window escalate cooldown monotonically (no wrap/cycle).\n- If error code is missing but message indicates network failure, it is classified as network for quota tracking.\n- Cooldown removes providerKey from pool; after TTL expiry it can recover.\n- Verified by unit tests and `npm run build:dev` + `npm run install:global`.\n","notes":"Evidence:\\n- Commit: 393b7da18\\n- Unit tests: npm run jest:run -- --runTestsByPath tests/manager/quota/provider-quota-center.spec.ts tests/manager/quota/provider-quota-daemon-module.spec.ts (PASS)\\n- Full verify: npm run build:dev (PASS, includes install:global)\\n\\nChanges:\\n- provider-quota-center: clamp consecutive count (no wrap)\\n- quota daemon: pass error message into quota event; classify message-only fetch errors as ENET\\n- model backoff: clamp capacity schedule (no 9/15/27 loop)\\n- antigravity 403 reauth: rotate alias + 30m cooldown\\n","status":"closed","priority":0,"issue_type":"bug","assignee":"fanzhang","owner":"bot@routecodex.com","created_at":"2026-02-05T01:00:33.707366+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T01:11:09.800817+08:00","closed_at":"2026-02-05T01:10:45.483731+08:00","labels":["network","quota"]}
{"id":"routecodex-35","title":"bug(oauth): interactive OAuth does not open Camoufox window","description":"## Problem\n- Running `routecodex oauth \u003ctoken-file\u003e --force` or `routecodex oauth gemini-auto|antigravity-auto \u003ctoken-file\u003e` sometimes prints portal/callback instructions but no browser window appears, leaving users stuck.\n\n## Expected\n- Interactive/manual OAuth always opens a visible Camoufox window by default (headed), so users can complete login/2FA/verification.\n- Auto OAuth may run headless, but must fall back to headed manual assist when automation cannot proceed.\n\n## Acceptance Criteria\n- With `ROUTECODEX_CAMOUFOX_DEV_MODE=1` (CLI interactive refresh sets this automatically), Camoufox launcher opens a headed window reliably for manual completion (no silent no-op).\n- `npm run build:dev` + `npm run install:global` pass.\n","notes":"Evidence:\n- Commit: 89ed3019f\n- Tests: npm run jest:run -- --runTestsByPath tests/cli/start-command.spec.ts tests/cli/camoufox-command.spec.ts tests/token-daemon/interactive-refresh.spec.ts (PASS)\n- Full verify: npm run build:dev (PASS, includes install:global)\n\nChange summary:\n- scripts/camoufox/launch-auth.mjs: when devMode=true and no autoMode, use Playwright headed manual-assist so a visible window always appears. Fallback to direct binary launch if Playwright is unavailable.\n- src/providers/core/config/oauth-flows.ts: print \"[OAuth] Launching Camoufox\" before opening.\n","status":"closed","priority":0,"issue_type":"bug","assignee":"fanzhang","owner":"bot@routecodex.com","created_at":"2026-02-05T07:28:16.728899+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T07:32:00.879749+08:00","closed_at":"2026-02-05T07:31:51.353704+08:00","labels":["camoufox","oauth"]}
{"id":"routecodex-36","title":"feat(oauth): add --headful + clarify callback wait","description":"Add a --headful flag to oauth commands to force headed Camoufox, and improve the callback waiting logs so users understand why it is waiting and what to do when no browser window opens.","acceptance_criteria":"- `routecodex oauth \u003cselector\u003e --headful` forces Camoufox headed mode (ROUTECODEX_CAMOUFOX_DEV_MODE=1) for interactive flows.\n- `oauth *-auto` subcommands accept --headful (alias of existing --dev).\n- Callback wait log prints actionable guidance (headless vs headed, manual open hints).\n- Unit tests cover option registration.","notes":"Implemented --headful flag + improved callback wait messaging.\n\nWhat changed:\n- Added `--headful` to `routecodex oauth \u003cselector\u003e` and all `*-auto` oauth subcommands (alias of existing `--dev`).\n  File: src/commands/oauth.ts\n- Removed implicit â€œalways headedâ€ default from CLI interactiveRefresh so headful is explicit.\n  File: src/token-daemon/index.ts\n- Callback wait now prints actionable tips (headless Camoufox vs manual open).\n  File: src/providers/core/strategies/oauth-auth-code-flow.ts\n\nTests:\n- tests/commands/oauth-command.qwen-auto.spec.ts covers option registration.\n- npm run test:cli passed.\n- npm run build:dev passed (includes install:global + blackbox antigravity parity).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T09:46:15.199234+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T09:50:41.89471+08:00","closed_at":"2026-02-05T09:50:41.89471+08:00","close_reason":"--headful option + clearer OAuth waiting logs","labels":["camoufox","cli","oauth"]}
{"id":"routecodex-37","title":"feat(provider): add nvidia (Kimi K2.5) provider","description":"Add a built-in provider id `nvidia` for NVIDIA API Catalog (MoonshotAI kimi-k2.5). Users should be able to config init it and use it via OpenAI-compatible endpoints.","acceptance_criteria":"- `routecodex config list-providers` includes nvidia.\n- `routecodex config init --providers nvidia` generates a working provider entry (apikey via env var reference).\n- Provider uses correct baseUrl/model id for NVIDIA endpoint.\n- CLI/config tests cover template presence.","notes":"(2026-02-05) Created unintentionally during oauth work; unclaiming and returning to open backlog.","status":"open","priority":1,"issue_type":"feature","owner":"bot@routecodex.com","created_at":"2026-02-05T10:51:52.960067+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T11:09:09.436261+08:00","labels":["config","nvidia","provider"]}
{"id":"routecodex-38","title":"Add NVIDIA NIM provider template (Kimi K2.5)","description":"Acceptance Criteria:\n- `rcc init --providers nvidia` and `rcc config init --providers nvidia` generate config with baseURL `https://integrate.api.nvidia.com/v1` and apiKey placeholder `${NVIDIA_API_KEY}`.\n- `configsamples/provider/nvidia/config.v1.json` exists and is secret-free.\n- Default model is `moonshotai/kimi-k2.5`.","notes":"- Implemented:\n  - configsamples/provider/nvidia/config.v1.json\n  - src/cli/config/init-provider-catalog.ts (new init template: nvidia)\n  - configsamples/config.json (added disabled-by-default nvidia sample)\n- Model IDs verified via `curl https://integrate.api.nvidia.com/v1/models` (public list includes `moonshotai/kimi-k2.5`).\n- Tests: `npm test -- tests/cli/config-command.spec.ts` (passed).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T11:28:04.239514+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T11:28:36.906764+08:00","closed_at":"2026-02-05T11:28:36.906764+08:00","close_reason":"Implemented NVIDIA NIM provider template + sample config"}
{"id":"routecodex-39","title":"Seed provider v2 configs during init (include nvidia)","description":"Acceptance Criteria:\n- Running `rcc init --providers nvidia` (or `rcc config init --providers nvidia`) writes `~/.routecodex/provider/nvidia/config.v2.json` (or alongside custom `--config` path) if missing.\n- Seeding is best-effort (init still succeeds even if provider v2 file cannot be written).\n- Existing provider v2 configs are not overwritten unless `--force` is used.\n- `npm run test:cli` passes.","notes":"- Implemented provider v2 seeding during init: src/cli/config/init-config.ts\n- Added nvidia provider-update template: src/commands/provider-update.ts\n- Added CLI test coverage: tests/cli/config-command.spec.ts\n- Local: created `~/.routecodex/provider/nvidia/config.v2.json` (env placeholder `${NVIDIA_API_KEY}`).\n- Verified: `npm run test:cli` (passed).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T11:51:16.500466+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T11:58:26.414567+08:00","closed_at":"2026-02-05T11:58:26.414567+08:00","close_reason":"Init seeds ~/.routecodex/provider/\u003cid\u003e/config.v1.json + config.v2.json (best-effort)"}
{"id":"routecodex-4","title":"Epic: CI åŸºçº¿ + è¦†ç›–ç‡é—¨ç¦ï¼ˆroutecodex + llmswitch-coreï¼‰","description":"ä» task.md è¿ç§»ï¼šCI åŸºçº¿ï¼ˆPR å¿…è·‘ï¼‰ä¸è¦†ç›–ç‡é—¨ç¦æå‡ï¼ˆç›®æ ‡ 90%ï¼‰çš„å‰©ä½™å·¥ä½œé¡¹ã€‚\\n\\néªŒæ”¶ï¼š\\n- llmswitch-core-ci ä½œä¸º Required status checksï¼ˆGitHub è®¾ç½®ï¼‰\\n- ä¾èµ– llms æ›´æ–°å re-enable release CI servertool suites\\n- è¦†ç›–ç‡é—¨ç¦é€æ­¥æå‡åˆ° 90% å¹¶æœ‰å¯å®¡è®¡ allowlist","status":"open","priority":1,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:34:31.909971+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:34:31.909971+08:00"}
{"id":"routecodex-4.1","title":"CIï¼šGitHub è®¾ç½®ï¼šllmswitch-core-ci è®¾ä¸º Required status checks","description":"task.md 14. ä»éœ€æ‹æ¿é¡¹ï¼šåœ¨ GitHub branch protection ä¸­æŠŠ llmswitch-core-ci æ ‡ä¸º requiredï¼ˆPR å¿…è¿‡ï¼‰ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.274947+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.274947+08:00","dependencies":[{"issue_id":"routecodex-4.1","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.402523+08:00","created_by":"import"}]}
{"id":"routecodex-4.2","title":"CIï¼šCI æµ‹è¯•é›† re-enableï¼ˆå¾… @jsonstudio/llms å‘å¸ƒï¼‰","description":"release CI ç›®å‰åŸºäº npm @jsonstudio/llms@0.6.1172ï¼›å¾… llms å‘å¸ƒæ–°ç‰ˆæœ¬åï¼ŒæŠŠä¾èµ–æ–°è¡Œä¸ºçš„ servertool/sharedmodule æµ‹è¯•é‡æ–°çº³å…¥ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.400941+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.400941+08:00","dependencies":[{"issue_id":"routecodex-4.2","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.402969+08:00","created_by":"import"}]}
{"id":"routecodex-4.3","title":"CIï¼šä¿®å¤é˜»å¡å…¨é‡ coverage çš„å•æµ‹æˆ–æ‹† nightly","description":"å¤„ç† tests/servertool/virtual-router-quota-routing.spec.ts çš„ä¸ç¨³å®š/é˜»å¡ç‚¹ï¼Œæˆ–æ‹†åˆ†è¿› nightly jobã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.516597+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.516597+08:00","dependencies":[{"issue_id":"routecodex-4.3","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.403432+08:00","created_by":"import"}]}
{"id":"routecodex-4.4","title":"CIï¼šè¦†ç›–ç‡é—¨ç¦æå‡åˆ° 90%ï¼ˆæ¸è¿›ï¼‰","description":"æŠŠå½“å‰ä¸´æ—¶é˜ˆå€¼é€æ­¥æé«˜åˆ° 90%ï¼ˆlines/branches/functions/statementsï¼‰ï¼Œå¹¶ç»´æŠ¤å¯å®¡è®¡ allowlistã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.631723+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.631723+08:00","dependencies":[{"issue_id":"routecodex-4.4","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.403887+08:00","created_by":"import"}]}
{"id":"routecodex-4.5","title":"CIï¼šè½åœ°æµ‹è¯•åˆ†å±‚ä¸ coverage map gate","description":"å¯ç”¨ tests/unit|integration|regression|golden åˆ†å±‚ï¼Œå¹¶ä¸Šçº¿ scripts/verify-test-coverage-map.mjs ä½œä¸º gateã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.746481+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.746481+08:00","dependencies":[{"issue_id":"routecodex-4.5","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.404354+08:00","created_by":"import"}]}
{"id":"routecodex-4.6","title":"CIï¼šGolden æ‰©å®¹ç­–ç•¥è½åœ°","description":"fixtures ä½“ç§¯è†¨èƒ€æ—¶è¿ GitHub Release asset + sha256 lockï¼Œä¿è¯ CI å¯è·å–ä¸”å¯å¤ç°ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:36:14.859804+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:36:14.859804+08:00","dependencies":[{"issue_id":"routecodex-4.6","depends_on_id":"routecodex-4","type":"parent-child","created_at":"2026-02-03T19:28:31.40482+08:00","created_by":"import"}]}
{"id":"routecodex-40","title":"NVIDIA provider: 15min timeout + upstream SSE + better transport errors","description":"NVIDIA provider requests can hang/timeout because OpenAI chat transport never enables upstream SSE, and network errors are surfaced as generic 'fetch failed'. Also default routing templates should include standard route pools (thinking/tools/etc) to avoid PROVIDER_NOT_AVAILABLE.","notes":"Evidence:\n- Upstream SSE enabled for OpenAI chat transport: src/providers/core/runtime/chat-http-provider.ts\n- Fetch transport errors now include undici cause code: src/providers/core/utils/http-client.ts\n- NVIDIA template uses ${NVIDIA_API_KEY} and timeoutMs=900000: src/cli/config/init-provider-catalog.ts\n- Init config routing includes standard pools: src/cli/config/init-config.ts\n- Init seeds per-provider v1 configs under ~/.routecodex/provider/\u003cid\u003e/config.v1.json: src/cli/config/init-config.ts\n- NVIDIA sample config.v1.json added: configsamples/provider/nvidia/config.v1.json\n- Provider update template includes NVIDIA defaults: src/commands/provider-update.ts\n- Tests: npm run test:cli (2026-02-05)\nReopened 2026-02-05: this issue was auto-closed during an aborted/invalid session; the referenced NVIDIA template/init seeding changes are NOT present in current git working tree. Keeping open to avoid misreporting.\n","status":"open","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T14:48:12.914953+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T15:01:22.423747+08:00","close_reason":"NVIDIA timeout + chat upstream SSE + transport error details + init routing/seeding"}
{"id":"routecodex-41","title":"LM Studio: fix streaming decode + terminated SSE","description":"## Problem\nLM Studio/OpenAI-compatible upstreams can (a) terminate SSE after tool_call output_item.done or (b) return JSON even when stream=true while the provider wrapper still exposes __sse_stream. Both cases currently surface as SSE_TO_JSON_ERROR: terminated / SSE_DECODE_ERROR and break Codex flows.\n\n## Acceptance Criteria\n- Responses SSE: if undici throws terminated after a completed output item, llmswitch-core returns a valid response JSON (no 5xx).\n- resp_inbound_stage1_sse_decode: if __sse_stream body starts with JSON, parse JSON and continue (treat as non-SSE).\n- Add regressions to sharedmodule matrix for both cases.\n- routecodex build:dev passes (includes install:global).\n","notes":"Evidence (2026-02-05):\n- Sharedmodule fix (llmswitch-core):\n  - Handle undici \"terminated\" during Responses SSE aggregation by salvaging completed output items: sharedmodule/llmswitch-core/src/sse/sse-to-json/responses-sse-to-json-converter.ts\n  - If provider wrapper exposes __sse_stream but body is JSON, parse JSON and continue: sharedmodule/llmswitch-core/src/conversion/hub/pipeline/stages/resp_inbound/resp_inbound_stage1_sse_decode/index.ts\n  - Regressions wired into matrix:\n    - sharedmodule/llmswitch-core/scripts/tests/responses-sse-to-json-terminated-salvage.mjs\n    - sharedmodule/llmswitch-core/scripts/tests/chat-sse-to-json-openai-no-event.mjs\n    - sharedmodule/llmswitch-core/scripts/tests/run-matrix-ci.mjs\n- RouteCodex timeout wiring:\n  - runtime.transport timeoutMs/maxRetries mapped into provider HTTP config: src/providers/core/api/provider-types.ts, src/server/runtime/http-server/index.ts, src/providers/core/runtime/provider-factory.ts\n  - Test: tests/provider/provider-factory.test.ts\n\nVerification:\n- sharedmodule matrix: GEMINI_API_KEY= LLMSWITCH_MATRIX_BUILD_SCRIPT=build:ci node scripts/tests/run-matrix-ci.mjs (passed; report saved under sharedmodule/test-results/llmswitch-core/)\n- routecodex: npm run build:dev (passed; includes install:global e2e)\n","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-05T14:54:41.725389+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T14:55:56.384493+08:00","closed_at":"2026-02-05T14:55:56.384493+08:00","close_reason":"LM Studio SSE termination + JSON-bodied stream compatibility fixed; verified via sharedmodule matrix + routecodex build:dev","labels":["lmstudio","sse"]}
{"id":"routecodex-42","title":"bug(lmstudio): /v1/responses tool_call_id å½’ä¸€åŒ–ä¸º fc_ å¯¼è‡´ submit_tool_outputs å¤±è´¥","description":"Problem: LM Studio(OpenAI Responseså…¼å®¹) è¿”å› tool_call id=call_*ï¼ŒHub å‡ºç«™è½¬æˆ fc_*ï¼Œåç»­ /v1/responses.submit_tool_outputs å‘é€ fc_* å¯¼è‡´ä¸Šæ¸¸ç›´æ¥æ–­æµ(undici terminated / SSE_TO_JSON_ERROR)ï¼›å®¢æˆ·ç«¯çœ‹åˆ° server error / ä¼šè¯ä¸­æ–­ã€‚","acceptance_criteria":"- provider è¿”å› function_call item call_id=call_* æ—¶ï¼ŒClient(/v1/responses) å‡ºç«™ required_action.submit_tool_outputs.tool_calls[*].id/tool_call_id/call_id ä¿æŒ call_*ï¼ˆä¸å†è½¬æ¢ä¸º fc_*ï¼‰ã€‚\n- åç»­ tool_outputs æäº¤æ—¶ï¼ŒHostâ†’Provider çš„ tool_outputs[*].tool_call_id/call_id ä»ä¸º call_*ï¼ŒLM Studio ä¸å†å‡ºç° terminatedã€‚\n- æ·»åŠ å›å½’æµ‹è¯•è¦†ç›– call_* ä¿æŒä¸å˜ã€‚\n- è·‘ sharedmodule/llmswitch-core build + routecodex build:dev + install:global éªŒè¯é€šè¿‡ã€‚","notes":"Evidence (repro):\n- Provider response had tool_call id=call_*: ~/.routecodex/codex-samples/openai-responses/lmstudio.key1.qwen3-coder-next-mlx/req_1770271132933_c8b5f6bb/provider-response.json\n- Client remap rewrote call_id to fc_* (bad): ~/.routecodex/codex-samples/openai-responses/lmstudio.key1.qwen3-coder-next-mlx/req_1770271132933_c8b5f6bb/chat_process.resp.stage9.client_remap.json\n- Followup submit_tool_outputs sent fc_* upstream â†’ undici terminated: ~/.routecodex/codex-samples/openai-responses/lmstudio.key1.qwen3-coder-next-mlx/req_1770271145543_aa29ea95/provider-error.json\n\nFix:\n- llmswitch-core: default toolCallIdStyle=preserve for OpenAI Responses; keep original call_id when present; relax codex-matrix tool_call_id format; add matrix regression script responses-tool-call-id-preserve.\n\nVerification:\n- sharedmodule: GEMINI_API_KEY= LLMSWITCH_MATRIX_BUILD_SCRIPT=build:ci node scripts/tests/run-matrix-ci.mjs (report: sharedmodule/test-results/llmswitch-core/matrix-ci-1770277464458.json)\n- routecodex: npm test (175 tests + mock regressions) + npm run build:dev (includes install:global + blackbox antigravity parity)","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T15:37:56.020771+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T15:50:35.224974+08:00","closed_at":"2026-02-05T15:50:35.224974+08:00","close_reason":"Preserve OpenAI Responses call_* tool ids to prevent LM Studio terminated on submit_tool_outputs","labels":["backend","provider","streaming"]}
{"id":"routecodex-43","title":"bug(token-daemon): interactiveRefresh è¯»å– quota-manager.json è·¯å¾„ä¸ç¨³å®šå¯¼è‡´ä¸æç¤º verify-required","description":"Problem: interactiveRefresh åœ¨ token ä» valid æ—¶åº”æç¤º QuotaManager æ ‡è®°çš„ google_account_verification(verify required) å¹¶åœ¨ headful æ—¶è‡ªåŠ¨ç”¨ Camoufox æ‰“å¼€éªŒè¯ URLï¼›ä½†å½“å‰åœ¨éƒ¨åˆ†ç¯å¢ƒ/æµ‹è¯•ä¸­è¯»å– quota-manager.json å¤±è´¥(ç–‘ä¼¼ os.homedir ç¼“å­˜/ä¸å°Šé‡ /Users/fanzhang)ï¼Œå¯¼è‡´ warn/open ä¸è§¦å‘ã€‚","acceptance_criteria":"- interactiveRefresh(valid token) ä»ä¼šæ£€æµ‹å¹¶ warn \"verify required\"ï¼Œä¸”è¾“å‡º sanitize åçš„ accounts.google.com/signin/continue URLã€‚\n- headful(ROUTECODEX_CAMOUFOX_DEV_MODE=1) æ—¶ä¼šè°ƒç”¨ openAuthInCamoufoxã€‚\n- ä¿®å¤å tests/token-daemon/interactive-refresh.spec.ts é€šè¿‡ã€‚","notes":"Fix: quota-auth-issue resolveQuotaManagerPath now honors ROUTECODEX_HOME/HOME before os.homedir(), avoiding homedir caching issues.\n\nVerification:\n- npm run jest:run -- --runTestsByPath tests/token-daemon/interactive-refresh.spec.ts (PASS)\n- npm test (PASS)","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T15:38:09.571624+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T15:50:52.640143+08:00","closed_at":"2026-02-05T15:50:52.640143+08:00","close_reason":"interactiveRefresh now reliably detects quota verify-required via HOME/ROUTECODEX_HOME","labels":["antigravity","oauth","token-daemon"]}
{"id":"routecodex-44","title":"task(health): ç§»é™¤è½®è¯¢å¥åº·æ’åºé€»è¾‘","description":"Problem: å½“å‰è½®è¯¢å¥åº·çŠ¶æ€/æ’åºç›¸å…³çš„å¤„ç†ä¼šå½±å“ provider pool å‘½ä¸­å’Œ UI å±•ç¤ºï¼Œç”¨æˆ·è¦æ±‚ç§»é™¤è¯¥æ’åºå¤„ç†ï¼ˆä¿æŒåŸå§‹é¡ºåº/ä¸åšé¢å¤–æ’åºï¼‰ã€‚","acceptance_criteria":"- è½®è¯¢å¥åº·å¿«ç…§è¾“å‡ºä¸å†å¯¹ providers/cooldowns åšé¢å¤–æ’åºï¼ˆä¿æŒæ’å…¥é¡ºåºæˆ–åŸå§‹é¡ºåºï¼‰ã€‚\n- webui å¤šé€‰ reset è¡Œä¸ºä¸å—å½±å“ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-05T15:38:23.202789+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T15:38:23.202789+08:00","labels":["health","quota","router"]}
{"id":"routecodex-45","title":"Fix Responses tool-call id style leakage (LMStudioâ†’OpenAI)","description":"## Problem\nRouting from a Responses-compatible upstream that uses `call_*` tool ids (e.g. LM Studio) into a standard OpenAI `/v1/responses` provider (tab/crs) can leak `toolCallIdStyle=preserve` across followups (e.g. `:stop_followup`). OpenAI rejects non-`fc_*` ids with HTTP 400.\n\n## Acceptance Criteria\n- When target provider is standard OpenAI `/v1/responses` (tab/crs), outbound request `input[].id` / `call_id` for `function_call` items is normalized to `fc_*`, and OpenAI no longer returns `Expected an ID that begins with 'fc'`.\n- When target provider is LM Studio, `call_*` tool ids are preserved; `call_id`/`tool_call_id`/`id` fields are mirrored so tool loops remain stable.\n- Antigravity (Claude via Gemini) no longer fails on `tool_use.id` invalid pattern when tool ids contain non `[A-Za-z0-9_-]` characters.\n","notes":"## Evidence\n- sharedmodule/llmswitch-core: `env -u GEMINI_API_KEY npm run test:matrix` â†’ âœ… Matrix passed (2026-02-05).\n- routecodex: `npm run build:dev` â†’ âœ… completed incl. `install:global` + `test:blackbox-antigravity-parity` (2026-02-05).\n\n## Fix Summary\n- Route-selected Responses providers now default tool call id style to `fc` (OpenAI) and `preserve` only for LM Studio (`chat:lmstudio` or providerId=lmstudio).\n- LM Studio compat normalizes/mirrors `call_id`/`tool_call_id`/`id` fields without rewriting ids.\n- Antigravity (Claude via Gemini) sanitizes tool call ids to `[A-Za-z0-9_-]` when injecting `functionCall.id`/`functionResponse.id`.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T20:33:58.722207+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T20:35:35.834398+08:00","closed_at":"2026-02-05T20:35:35.834398+08:00","close_reason":"Fixed in sharedmodule/llmswitch-core + verified via matrix + routecodex build:dev"}
{"id":"routecodex-46","title":"Fix webSearch providerKey not in routing.web_search","description":"## Problem\nRouteCodex å¯åŠ¨æ—¶æŠ¥é”™ï¼š`webSearch engine \"iflow:web_search\" references providerKey \"iflow.glm-4.7\" which is not present in routing.web_search`ã€‚\n\nåŸå› æ˜¯ `virtualrouter.webSearch.engines[*].providerKey` å¿…é¡»å‡ºç°åœ¨ `virtualrouter.routing.web_search[*].targets` ä¸­ï¼Œä½†é…ç½®é‡Œç¼ºäº†è¯¥ targetã€‚\n\n## Fix\nåœ¨ `~/.routecodex/config.json` çš„ `virtualrouter.routing.web_search[0].targets` ä¸­åŠ å…¥ `iflow.glm-4.7`ã€‚\n\n## Acceptance Criteria\n- `routecodex config validate -c ~/.routecodex/config.json` è¿”å› `Configuration is valid`ã€‚\n","notes":"## Evidence\n- Config patched: `~/.routecodex/config.json` now includes `iflow.glm-4.7` under `virtualrouter.routing.web_search[0].targets`.\n- Validation: `routecodex config validate -c ~/.routecodex/config.json` â†’ âœ“ Configuration is valid (2026-02-05).","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T21:09:15.61878+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T21:09:36.626898+08:00","closed_at":"2026-02-05T21:09:36.626898+08:00","close_reason":"Config aligned: webSearch engine providerKey now in routing.web_search"}
{"id":"routecodex-47","title":"iFlow tool calls emitted as Qwen tokens are treated as text","description":"## Symptom\nWhen routing `/v1/responses` to iFlow (providerFamily=iflow, protocol=openai-chat), the model may emit Qwen-style tool tokens in plain text, e.g.:\n\n- `\u003c|tool_call_begin|\u003e functions.exec_command:66 \u003c|tool_call_argument_begin|\u003e {...} \u003c|tool_call_end|\u003e`\n\nThese are currently returned to the client as plain text, so tool execution does not happen.\n\n## Expected\nThose token blocks should be harvested into structured `choices[].message.tool_calls` so Hub Pipeline can run the tool loop.\n\n## Fix\n- Add compat response action for `chat:iflow` that harvests tool calls from assistant text.\n- Extend text markup normalizer to parse Qwen token tool blocks.\n\n## Acceptance Criteria\n- `chat:iflow` response converts Qwen token markup into `tool_calls` and sets `finish_reason=tool_calls`.\n- Matrix includes a deterministic regression test.\n","notes":"## Evidence\n- sharedmodule/llmswitch-core: `env -u GEMINI_API_KEY npm run test:matrix` â†’ âœ… Matrix passed (2026-02-05).\n- Added regression: `llmswitch-core/scripts/tests/compat-iflow-qwen-tool-tokens.mjs`.\n\n## Patch Points\n- `sharedmodule/llmswitch-core/src/conversion/shared/text-markup-normalizer.ts` (parse `\u003c|tool_call_begin|\u003e` tokens)\n- `sharedmodule/llmswitch-core/src/conversion/compat/profiles/chat-iflow.json` (enable `harvest_tool_calls_from_text`)\n- `sharedmodule/llmswitch-core/src/conversion/hub/pipeline/compat/compat-*.ts` (new action wiring)","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T21:37:35.188796+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T21:38:04.283761+08:00","closed_at":"2026-02-05T21:38:04.283761+08:00","close_reason":"Compat updated to harvest Qwen token tool calls for iFlow"}
{"id":"routecodex-48","title":"iFlow: JSON text body causes MALFORMED_RESPONSE","description":"Problem:\n- /v1/responses routed to iflow(openai-chat) can return JSON as plain text (wrong Content-Type), so hub receives a string payload and fails canonicalization:\n  ProviderProtocolError: [hub_response] Non-canonical response payload at chat_process.response.entry\n\nImpact:\n- Tool loop breaks (tools route), request fails with MALFORMED_RESPONSE.\n\nFix:\n- In llmswitch-core resp_inbound stage1, best-effort parse JSON when providerResponse is a string.\n- Also expand Qwen tool-token harvesting to tolerate whitespace/newlines and allow write_stdin {}.\n","acceptance_criteria":"Acceptance Criteria:\n- If providerResponse is a JSON string (chat.completion), hub parses it and continues conversion (no MALFORMED_RESPONSE).\n- iFlow Qwen token tool-call markup with whitespace/newlines is harvested into tool_calls.\n- Matrix tests pass.\n","notes":"Evidence:\n- Sharedmodule commits:\n  - d366b55 fix(iflow): harvest qwen tool tokens with whitespace\n  - fd4bd27 fix(hub): parse JSON text provider responses\n- llmswitch-core matrix: env -u GEMINI_API_KEY -u GOOGLE_API_KEY npm run test:matrix â†’ PASS\n  Report: ../sharedmodule/test-results/llmswitch-core/matrix-ci-1770304963680.json\n- routecodex dev build + global install: npm run build:dev â†’ PASS; routecodex --version = 0.89.1711\n","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-05T23:25:35.839673+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T23:25:56.241418+08:00","closed_at":"2026-02-05T23:25:56.241418+08:00","close_reason":"fixed in sharedmodule/llmswitch-core","labels":["compat","hub","iflow"]}
{"id":"routecodex-49","title":"iFlow: unwrap {status,msg,body} envelope unconditionally","description":"## Symptom\\n/v1/responses routed to iFlow sometimes returns an envelope {status,msg,body,request_id}. Hub sees the envelope as the provider response and throws MALFORMED_RESPONSE at chat_process.response.entry (payloadKeys include status/msg/body/request_id). This also prevents Qwen token tool-call harvesting.\\n\\n## Expected\\nCompat profile chat:iflow should unwrap to body before semantic mapping/tool harvesting, even when body is not yet recognized as a known provider response shape.\\n\\n## Acceptance Criteria\\n- For payload {status,msg,body,request_id}, compat action returns body (parsed if JSON string) so downstream conversion errors reference body shape, not the envelope.\\n- If body is an OpenAI-chat completion (object or JSON string), conversion proceeds and tool harvesting can run.\\n- Deterministic regression test added and matrix passes.","notes":"\\nEvidence (2026-02-06):\\n- sharedmodule/llmswitch-core: env -u GEMINI_API_KEY -u GOOGLE_API_KEY npm run test:matrix â†’ âœ… Matrix passed\\n- routecodex: npm run build:dev â†’ âœ… Passed (includes install:global + mock regressions)\\n\\nPatch points:\\n- sharedmodule/llmswitch-core/src/conversion/compat/actions/iflow-response-body-unwrap.ts\\n- sharedmodule/llmswitch-core/scripts/tests/compat-iflow-qwen-tool-tokens.mjs (adds 'body SSE text' case)","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T00:33:48.075465+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T00:39:59.269141+08:00","closed_at":"2026-02-06T00:39:59.269141+08:00","close_reason":"Unwrap iFlow envelope body + SSE text parse","labels":["compat","hub","iflow"]}
{"id":"routecodex-5","title":"Fix Qwen OAuth token not used (api_key enrichment)","description":"## Steps to Reproduce\n1. Run `routecodex oauth ~/.routecodex/auth/qwen-oauth-1-default.json` and complete OAuth.\n2. Token file contains `access_token`/`refresh_token` but no `api_key`.\n3. Start RouteCodex and route a request to Qwen (e.g. background route `qwen.qwen3-coder-plus`).\n4. Observe server still fails auth / appears not to use token.\n\n## Acceptance Criteria\n- When Qwen token file is missing `api_key`, RouteCodex backfills it via Qwen user-info endpoint and persists it (without requiring token refresh).\n- CLI init provider catalog uses `~/.routecodex/auth/qwen-oauth-1-default.json` by default.\n- `npm run build:dev` passes (includes `install:global`).","notes":"- Code: src/providers/auth/oauth-lifecycle.ts (Qwen api_key enrichment)\n- Config: src/cli/config/init-provider-catalog.ts (tokenFile now qwen-oauth-1-default.json)\n- Test: tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts (PASS)\n- Commit: 9e9ce8769\n- Verification: npm run build:dev (includes install:global) completed successfully on 2026-02-03.","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-03T23:48:52.631504+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T23:49:29.917668+08:00","closed_at":"2026-02-03T23:49:29.917668+08:00","close_reason":"Implemented Qwen api_key enrichment + default tokenFile alignment","labels":["auth","qwen"]}
{"id":"routecodex-50","title":"bug(lmstudio): submit_tool_outputs ä¸åº”å¼ºåˆ¶ stream å¯¼è‡´ SSE_TO_JSON_ERROR","description":"Problem\n- /v1/responses/:id/submit_tool_outputs è¢« routes å¼ºåˆ¶ forceStream=trueï¼Œå¯¼è‡´å³ä½¿ client æ²¡æœ‰ stream=true ä¹Ÿä¼šèµ° SSE è·¯å¾„ã€‚\n- å¯¹ LM Studio /v1/responses/\u003cid\u003e/submit_tool_outputs ä¸Šæ¸¸è€Œè¨€ï¼Œstreaming SSE å¯èƒ½ä¸å…¼å®¹ï¼Œè§¦å‘ SSE_TO_JSON_ERROR: Building not completed / PROVIDER_NOT_AVAILABLEã€‚\n\nAcceptance Criteria\n- submit_tool_outputs ä»…åœ¨ client æ˜¾å¼ stream=true æ—¶æ‰å¯ç”¨ SSEï¼›Accept:text/event-stream ä¸å†éšå¼å¼€å¯ã€‚\n- handler resume å pipeline entryEndpoint é‡å†™ä¸º /v1/responsesï¼Œå¹¶ä¿æŒé streaming é»˜è®¤ã€‚\n- npm run build:dev + npm run install:global å…¨é‡éªŒè¯é€šè¿‡ã€‚\n","notes":"Changes\n- src/server/runtime/http-server/routes.ts: removed forceStream:true for /v1/responses/:id/submit_tool_outputs.\n- src/server/handlers/responses-handler.ts: submit_tool_outputs no longer infers streaming from Accept header; keeps stream off unless client explicitly requested.\n\nVerification\n- npm run build:dev (includes npm run install:global) passed locally (RouteCodex version bumped to 0.89.1726 during build).\n\nNext\n- Run a real LM Studio tool-call loop to confirm submit_tool_outputs no longer triggers SSE_TO_JSON_ERROR / PROVIDER_NOT_AVAILABLE.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T01:47:23.727528+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T01:48:21.353006+08:00","closed_at":"2026-02-06T01:48:11.641823+08:00","close_reason":"Fix: remove forceStream and stop inferring stream for submit_tool_outputs","labels":["backend","lmstudio","streaming"]}
{"id":"routecodex-51","title":"Update README files to reflect current module state","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-06T08:22:14.54312+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T08:22:14.54312+08:00"}
{"id":"routecodex-52","title":"iFlow: visionâ†’Kimi K2.5 inline multimodal + dataurl asset resolve + history trim","description":"## Goal\nWhen request contains images (vision intent), if iFlow Kimi K2.5 is configured, route should prefer Kimi K2.5 inline multimodal (single-pass), resolve image URLs/files to iFlow CLI-compatible data URLs, and avoid persisting large base64 blobs in snapshots/history.\n\n## Requirements\n- Routing: image requests should prefer routes that can serve inline multimodal via iFlow Kimi K2.5 (similar to current Responses/Gemini inline-vision preference).\n- Payload: for openai-chat outbound to iFlow Kimi K2.5, normalize image blocks to OpenAI-chat image_url parts with url=data:\u003cmime\u003e;base64,... by downloading/reading assets.\n- History: large base64 must not pollute hub snapshots/policy observations or stored conversation context (trim/redact).\n- Video: decide whether to support video_url blocks; default off unless explicitly enabled.\n\n## Acceptance Criteria\n- Deterministic matrix tests cover: local file image â†’ data URL; http(s) image â†’ data URL (mocked); data URL passthrough; trim/redaction for snapshots.\n- Vision requests route to iFlow Kimi K2.5 when present in default/thinking targets.\n- No provider/host semantic repair; all behavior implemented in llmswitch-core.","notes":"Implemented in sharedmodule/llmswitch-core: (1) router prefers iflow.*.kimi-k2.5 for image requests (inline-vision); (2) outbound stage resolves image_url assets (file/http) -\u003e data:*;base64 for iFlow Kimi K2.5; (3) vision_auto servertool skips iflow Kimi; (4) snapshot writer redacts large base64 data URLs. Verification: sharedmodule/llmswitch-core matrix PASS via env -u GEMINI_API_KEY -u GOOGLE_API_KEY LLMSWITCH_MATRIX_BUILD_SCRIPT=build:ci node scripts/tests/run-matrix-ci.mjs (report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770340771042.json). routecodex mock regressions PASS: npm run mock:regressions (41 samples).","status":"closed","priority":0,"issue_type":"feature","owner":"bot@routecodex.com","created_at":"2026-02-06T08:32:54.797565+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T10:02:56.602496+08:00","closed_at":"2026-02-06T09:20:33.684314+08:00","labels":["compat","hub","iflow","kimi","vision"]}
{"id":"routecodex-53","title":"bug(openai-responses): outbound function_call item.id must start with fc_","description":"Problem\n- When bridging ChatCompletion tool_calls â†’ OpenAI Responses payload, output[] function_call items get id like `function_call_\u003creq\u003e_\u003cn\u003e`.\n- OpenAI-compatible clients/providers may require function_call item.id to start with `fc_` (OpenAI strict), otherwise follow-up requests can fail.\n\nAcceptance Criteria\n- In openai-responses outbound remap, output[] function_call items have `id` beginning with `fc_` and stable per tool call.\n- Existing responses tool_call_id preservation regression extended to assert output item.id format.\n- sharedmodule/llmswitch-core: npm run build (matrix) passes; routecodex: npm run build:dev passes.","notes":"Fix implemented in sharedmodule/llmswitch-core:\n- Commit: c6c9a7b (fix(responses): keep function_call output id as fc_*)\n- Regression strengthened: llmswitch-core/scripts/tests/responses-tool-call-id-preserve.mjs asserts output[0].id startsWith('fc_')\n\nVerification:\n- sharedmodule/llmswitch-core: npm run build (matrix) PASS\n  - Matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770339485044.json\n- routecodex: npm run build:dev PASS (includes install:global)\n  - mock regressions: require_fc_call_ids=0","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T08:41:35.672971+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T09:02:09.252209+08:00","closed_at":"2026-02-06T09:02:09.252209+08:00","close_reason":"fixed: responses function_call output id now uses fc_*","labels":["backend","compat","streaming"]}
{"id":"routecodex-54","title":"Allow LM Studio no-auth: empty apikey auth should not fail bootstrap","description":"Problem: llmswitch-core bootstrap throws CONFIG_ERROR 'Provider lmstudio is missing auth configuration' when provider.auth.type=apikey but apiKey is empty (intended local no-auth).\\n\\nAcceptance Criteria:\\n- bootstrapVirtualRouterConfig accepts explicit apiKey auth with empty apiKey and generates at least one auth entry.\\n- Matrix tests pass.","notes":"Fix implemented in sharedmodule/llmswitch-core:\n- Commit: 4b67257 (fix(virtual-router): allow explicit empty apikey auth)\n- Added regression: llmswitch-core/scripts/tests/virtual-router-direct-model.mjs asserts bootstrapVirtualRouterConfig() does not throw with auth.type=apikey + apiKey=''\n\nVerification:\n- sharedmodule/llmswitch-core: npm run build (matrix) PASS\n  - Matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770339485044.json\n- routecodex manual sanity: ROUTECODEX_PORT=5532 routecodex start --config /tmp/routecodex-lmstudio-5555.json (apiKey='') starts successfully; provider lmstudio.key1 initialization-complete.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T08:58:27.159402+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T09:02:18.714528+08:00","closed_at":"2026-02-06T09:02:18.714528+08:00","close_reason":"fixed: explicit empty apikey treated as intentional no-auth","labels":["compat","config","lmstudio"]}
{"id":"routecodex-55","title":"LMStudio: do not stringify Responses input; preserve structured tool outputs","description":"Problem:\n- compat profile chat:lmstudio currently applies lmstudio_responses_input_stringify, flattening Responses input[] (including function_call_output) into a single input string with 'tool_output:' markers.\n- This causes tool execution results to appear as plain assistant content in clients and breaks proper tool-loop semantics.\n\nAcceptance Criteria:\n- Default behavior: keep canonical Responses input[] array for LM Studio (no stringification).\n- Still allow fallback stringification via an explicit env flag for old LM Studio versions if needed.\n- Update compat regression test(s) accordingly.\n- llmswitch-core: npm run build (matrix) passes; routecodex: npm run build:dev passes.","notes":"Fix implemented in sharedmodule/llmswitch-core:\n- Commit: 5e9ea4f (fix(lmstudio): keep responses input array; tool outputs structured)\n- Default: lmstudio_responses_input_stringify is disabled unless env  or .\n- Updated regression: llmswitch-core/scripts/tests/compat-lmstudio-tool-call-ids.mjs now asserts payload.input remains an array for openai-responses.\n\nVerification:\n- sharedmodule/llmswitch-core: npm run build (matrix) PASS\n  - Matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770343250462.json\n- routecodex: npm run build:dev PASS (includes install:global + mock regressions)\n\nManual check:\n- LM Studio local endpoint (http://127.0.0.1:1234/v1/responses) accepts array-form input (curl repro saved under /tmp/lms-responses-input-array.json).","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T09:59:13.734976+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T10:02:28.229051+08:00","closed_at":"2026-02-06T10:02:28.229051+08:00","close_reason":"fixed: LMStudio no longer flattens structured tool outputs into input string","labels":["compat","lmstudio","responses","tools"]}
{"id":"routecodex-56","title":"LMStudio terminated SSE salvage should ignore orphan in_progress function_call","description":"## Problem\nLMStudio /v1/responses streams may terminate before response.completed while having extra response.output_item.added function_call items that never receive response.function_call_arguments.done + response.output_item.done.\nCurrent salvage path may still emit those orphan calls as completed tool calls with {} arguments, causing downstream tool precheck failures and repeated Server Error in LMStudio UI.\n\n## Acceptance Criteria\n- On terminated salvage, only completed function_call items are emitted to output.\n- In-progress orphan function_call items are dropped.\n- Regression test covers one completed call + N orphan in-progress calls with terminated stream.\n- Matrix passes after change.","notes":"Evidence from snapshots:\\n- req_1770362892803_123f1140 provider raw stream terminates after output_item.added for call_1916667340710139/call_1916667340710140 without done events; only call_1916667340710141 has function_call_arguments.done + output_item.done.\\n- pre-fix stage9 emitted 3 tool calls (two orphan =\u003e arguments '{}').\\n\\nFix implemented in sharedmodule:\\n- llmswitch-core/src/sse/sse-to-json/builders/response-builder.ts: function_call output only emitted when state.status==='completed'.\\n- llmswitch-core/scripts/tests/responses-sse-to-json-terminated-salvage.mjs: add orphan in-progress call regression.\\n- Commit: 16a27a2 (pushed to sharedmodules/main).\\n\\nVerification:\\n- npm run build:dev\\n- node scripts/tests/responses-sse-to-json-terminated-salvage.mjs\\n- node scripts/tests/compat-lmstudio-tool-call-ids.mjs\\n- node scripts/tests/responses-tool-call-id-style-route-wins.mjs\\n- node scripts/tests/run-matrix-ci.mjs (Matrix passed)\\n- replay real snapshot req_1770362892803 via dist converter =\u003e fc_count=1 (only completed call_1916667340710141).","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T15:50:54.073044+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T15:51:32.367191+08:00","closed_at":"2026-02-06T15:51:32.367191+08:00","close_reason":"Implemented and verified terminated-SSE orphan-call filter"}
{"id":"routecodex-57","title":"responses stop_followup åå¤å›ç¯ï¼ˆstop_message_flowï¼‰","description":"ç—‡çŠ¶ï¼š/v1/responses åœ¨ stop_message_flow åæŒç»­ reenterï¼ŒrequestId å¸¦ :stop_followup åå¤è§¦å‘ï¼Œå‡ºç°åŒä¸€è·¯å¾„å¤šæ¬¡ followupï¼Œç–‘ä¼¼ç¼ºå°‘å»é‡/ç»ˆæ­¢æ¡ä»¶ã€‚","acceptance_criteria":"AC1: åŒä¸€è¯·æ±‚é“¾è·¯æœ€å¤šè§¦å‘ä¸€æ¬¡ stop_followupï¼ˆæˆ–è¾¾åˆ°æ˜ç¡®ä¸Šé™å¹¶åœæ­¢ï¼‰ã€‚\\nAC2: æ—¥å¿—ä¸­ä¸å†å‡ºç°æ— ç»ˆæ­¢é‡å¤çš„ :stop_followup reenterã€‚\\nAC3: é stop_message åœºæ™¯ä¸å—å½±å“ã€‚\\nAC4: å¢åŠ å›å½’æµ‹è¯•å¹¶é€šè¿‡ã€‚","notes":"Evidence: sharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.ts followup guard; routecodex/tests/servertool/stop-message-auto.spec.ts added followup-hop non-retrigger regression. Verification: npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts; (cd ../sharedmodule/llmswitch-core \u0026\u0026 npm run build); npm run build:dev.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-06T18:07:30.704461+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T18:15:57.206203+08:00","closed_at":"2026-02-06T18:15:57.206203+08:00","close_reason":"Stop_message followup loop fixed with single-point followup guard + regression","labels":["loop","responses","servertool"]}
{"id":"routecodex-58","title":"restart SIGUSR2 æ—¶ dist/index.js ç¼ºå¤±å¯¼è‡´æ–°è¿›ç¨‹å¯åŠ¨å¤±è´¥","description":"Symptoms: routecodex restart during/around build clean phase can spawn child with missing dist/index.js, causing MODULE_NOT_FOUND and service interruption.\n\nAcceptance Criteria:\nAC1: Restart preflight checks restart entry script readiness before stopping current process.\nAC2: If entry is missing, restart is aborted safely (current process keeps running) with clear log/error.\nAC3: Existing restart command tests and dev build/global install still pass.","notes":"Implemented restart entry preflight guard in src/index.ts: resolveRestartEntryScript + ensureRestartEntryReady + env timeout ROUTECODEX_RESTART_ENTRY_WAIT_MS (default 12000ms). If entry missing, restart aborts safely without stopping process and emits SERVER_RESTART_ENTRY_MISSING.\nVerification: npm run jest:run -- --runTestsByPath tests/cli/restart-command.spec.ts (PASS); npm run build:dev (PASS, includes install:global and e2e checks).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T18:32:32.304498+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T18:32:59.641145+08:00","closed_at":"2026-02-06T18:32:59.641145+08:00","close_reason":"Added restart preflight guard for missing dist entry; validated via tests and build pipeline"}
{"id":"routecodex-59","title":"stopMessage followup åº”å…è®¸åŒæµäºŒæ¬¡è§¦å‘ï¼›ä¿®å¤ iflow 200 error envelope å¯¼è‡´ MALFORMED_RESPONSE","description":"Context: current stop_message_auto followup guard blocks all followup hops, which violates intended behavior (allow same stop_message_flow retrigger with counter termination; only prevent nested cross-flow loops). In addition, iflow may return HTTP 200 with {error_code,msg} envelope on stop_followup; this currently passes as success and later fails in hub response conversion as MALFORMED_RESPONSE.\n\nAcceptance Criteria:\nAC1: stop_message_auto followup allows retrigger only when serverToolLoopState.flowId===stop_message_flow; other followups remain blocked.\nAC2: iflow HTTP 200 business error envelope ({error_code,msg/message}) is detected in provider transport and surfaced as provider error (not MALFORMED_RESPONSE).\nAC3: add regression tests and pass targeted + build:dev verification.","notes":"Validation evidence (2026-02-06):\n- Targeted tests passed: npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts tests/providers/core/runtime/protocol-http-providers.unit.test.ts\n- sharedmodule build+matrix passed: (cd ../sharedmodule/llmswitch-core \u0026\u0026 npm run build)\n- host full verification passed: npm run build:dev\n- explicit global install passed: npm run install:global\n\nCode updates validated:\n- ../sharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.ts (same-flow stop followup retrigger allowed; cross-flow nested followup still blocked)\n- src/providers/core/runtime/http-request-executor.ts (iflow HTTP 200 business error envelope =\u003e provider error at transport layer, avoids MALFORMED_RESPONSE in hub response conversion)\n- tests/servertool/stop-message-auto.spec.ts\n- tests/providers/core/runtime/protocol-http-providers.unit.test.ts","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T18:46:26.306121+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T18:59:49.681856+08:00","closed_at":"2026-02-06T18:59:49.681856+08:00","close_reason":"AC met: stopMessage same-flow retrigger restored; iflow 200 envelope handled as provider error; validations green"}
{"id":"routecodex-6","title":"rcc: ä¸‰è¿è¡Œæ¨¡å¼ç°çŠ¶å¯¹é½ï¼ˆrouter/analysis/directï¼‰","description":"## Background\nç›®å‰å¸Œæœ› rcc æœ‰ 3 ä¸ªè¿è¡Œæ¨¡å¼ï¼š\n1) **è·¯ç”±å™¨æ¨¡å¼ï¼ˆrouterï¼‰**ï¼šå½“å‰é»˜è®¤æ¨¡å¼ã€‚\n2) **åˆ†ææ¨¡å¼ï¼ˆanalysis/bypassï¼‰**ï¼šå¯¹å¤– API è¾“å…¥/è¾“å‡ºå½¢çŠ¶ä¿æŒä¸€è‡´ï¼›å†…éƒ¨å°½é‡â€œé€ä¼ â€ï¼Œå¹¶æŠŠå…¥ç«™/å‡ºç«™ï¼ˆå« upstreamï¼‰è®°å½•ä¸‹æ¥ç”¨äºåˆ†æã€‚\n3) **æœåŠ¡å™¨æ¨¡å¼ï¼ˆdirectï¼‰**ï¼šå½“è¯·æ±‚ `model` å½¢å¦‚ `provider.model` æ—¶ï¼Œä¸èµ°è·¯ç”±åˆ†ç±»ï¼Œç›´æ¥å‘½ä¸­è¯¥ provider çš„å¯¹åº” modelã€‚\n\n## Current State (code evidence)\n### (1) router\n- é»˜è®¤ `processMode='chat'`ï¼ŒHub Pipeline ä¼šè¿›å…¥ chat_processï¼ˆå« tool governance + è·¯ç”±ï¼‰ã€‚\n\n### (2) analysis/bypass\n- core/host å·²å­˜åœ¨ `processMode='passthrough'` çš„åŸºç¡€èƒ½åŠ›ï¼š\n  - å…è®¸ provider é€šè¿‡é…ç½® `process: 'passthrough'` è¿›å…¥ passthroughï¼›ä»¥åŠ server åœ¨ `processMode==='passthrough'` æ—¶è·³è¿‡ response äºŒæ¬¡è½¬æ¢ã€‚\n  - æ–‡æ¡£å£°æ˜ passthrough ä¼šâ€œè¯·æ±‚ä¸å“åº”åŸæ ·é€ä¼ â€ï¼Œä¸”ä»ä¼šå†™å…¥ request/response snapshotsã€‚\n- ä½†ç›®å‰æ²¡æœ‰çœ‹åˆ°ä¸€ä¸ª**æ˜ç¡®çš„ rcc â€œanalysis modeâ€å…¨å±€å¼€å…³/CLI é…ç½®**æ¥ä¿è¯â€œé€ä¼  + è®°å½•å…¥/å‡ºç«™â€æŒ‰ç»Ÿä¸€å¥‘çº¦è½åœ°ï¼ˆä¾‹å¦‚å›ºå®šè½ç›˜æ ¼å¼ã€è¾“å‡ºä½ç½®ã€å¼€å¯æ¡ä»¶ï¼‰ã€‚\n\n### (3) direct (model=provider.model)\n- llmswitch-core VirtualRouterEngine å·²å®ç°å¯¹ `request.model` çš„ direct åˆ†æ”¯ï¼š\n  - è§£æ `providerId.modelId` åèµ° `selectDirectProviderModel(...)` å¹¶è®¾ç½® `routeName='direct'`ã€‚\n\n## Acceptance Criteria\n- [ ] æ˜ç¡® rcc ä¸‰æ¨¡å¼çš„â€œå…¥å£å¼€å…³â€ï¼ˆCLI flag / config / request metadataï¼‰ä¸ä¼˜å…ˆçº§ï¼Œå¹¶åœ¨ docs ä¸­å†™æ¸…ã€‚\n- [ ] analysis/bypassï¼šå®šä¹‰ç¨³å®šçš„è®°å½•å†…å®¹ä¸è½ç›˜ä½ç½®ï¼ˆè‡³å°‘ï¼šinbound åŸå§‹ payloadã€provider outbound payloadã€provider inbound responseã€outbound ç»™å®¢æˆ·ç«¯çš„ payloadï¼›åŒæ—¶è¦†ç›– stream ä¸é streamï¼‰ã€‚\n- [ ] analysis/bypassï¼šä¿è¯å¯¹å¤–è¯·æ±‚/å“åº”åè®®å½¢çŠ¶ä¸å˜ï¼›ä¸ä¼šå¼•å…¥ host/provider å±‚è¯­ä¹‰ä¿®å¤ï¼ˆä»éµå¾ªå•æ‰§è¡Œè·¯å¾„ï¼‰ã€‚\n- [ ] directï¼šæ·»åŠ å›å½’éªŒè¯ï¼ˆæµ‹è¯•æˆ–è„šæœ¬ï¼‰è¯æ˜ `model=provider.model` æ—¶ routeName=direct ä¸”åªåœ¨è¯¥ provider/model æ± å†…é€‰æ‹©ã€‚\n\n## References\n- `sharedmodule/llmswitch-core/src/router/virtual-router/engine.ts`ï¼ˆdirect model åˆ†æ”¯ï¼‰\n- `sharedmodule/llmswitch-core/src/router/virtual-router/bootstrap.ts`ï¼ˆprovider.process -\u003e processModeï¼‰\n- `sharedmodule/llmswitch-core/src/conversion/hub/pipeline/hub-pipeline.ts`ï¼ˆprocessMode gateï¼‰\n- `src/server/runtime/http-server/executor-response.ts`ï¼ˆpassthrough è·³è¿‡ response convertï¼‰\n- `docs/CONFIG_ARCHITECTURE.md`ï¼ˆpassthrough è¯­ä¹‰ä¸ snapshots æè¿°ï¼‰\n","notes":"Verified 2026-02-04 (local):\\n- direct model parse+branch: sharedmodule/llmswitch-core/src/router/virtual-router/engine.ts:163 and :432\\n- direct selection respects allow/disable/health via trySelectFromTier: sharedmodule/llmswitch-core/src/router/virtual-router/engine-selection/direct-provider-model.ts:6\\n- provider.process -\u003e target.processMode: sharedmodule/llmswitch-core/src/router/virtual-router/bootstrap.ts:684\\n- route-select overwrites metadata.processMode from target: sharedmodule/llmswitch-core/src/conversion/hub/pipeline/target-utils.ts:5\\n- passthrough skips request-side tool governance stage: sharedmodule/llmswitch-core/src/conversion/hub/pipeline/hub-pipeline.ts:479\\n- passthrough skips response conversion in host: src/server/runtime/http-server/executor-response.ts:51\\n- release é»˜è®¤ snapshots off; start --snap forces ROUTECODEX_SNAPSHOT=1: src/cli/commands/start.ts:91\\n- client-request snapshot: src/server/runtime/http-server/index.ts:1317 (or request-executor.ts:173)\nImplemented A (router + forced snapshots):\\n- Added CLI mode flag: src/cli/commands/start.ts (\"--mode router|analysis|server\").\\n- analysis mode sets env: ROUTECODEX_SNAPSHOT=1, ROUTECODEX_HUB_SNAPSHOTS=1, ROUTECODEX_CAPTURE_STREAM_SNAPSHOTS=1.\\n- Added client-response snapshot capture gated by ROUTECODEX_MODE=analysis: src/server/handlers/handler-utils.ts.\\nVerification (no version bump):\\n- ROUTECODEX_SKIP_AUTO_BUMP=1 npm run build:dev (passed, includes install:global + e2e/toolcall + blackbox antigravity parity).\nPost-fix verification: npm run test:cli (passed).","status":"in_progress","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T00:07:53.325437+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T01:00:57.034018+08:00","labels":["mode","rcc"]}
{"id":"routecodex-60","title":"responses input id è¶…é•¿å¯¼è‡´ 400 string_above_max_length","description":"Context: openai-responses upstream returns HTTP 400: Invalid input[n].id too long (\u003e64). Seen on tab/crs providers in longcontext + stop_followup chains. Need single-source fix to normalize/truncate generated input item ids before outbound request while preserving stable linking semantics.\n\nAcceptance Criteria:\nAC1: outbound /v1/responses payload never sends input[*].id longer than 64 chars.\nAC2: fix is implemented at one canonical conversion/compat stage (no virtual-router/provider hacks).\nAC3: existing tool-call/id behavior for lmstudio/iflow remains unaffected.\nAC4: add regression test (or matrix script) covering oversized id normalization and pass targeted verification.","notes":"2026-02-06 ä¿®å¤ä¸éªŒè¯è®°å½•:\n\nä¸€ã€æ ¹å› \n- è§¦å‘é“¾è·¯: longcontext/stop_followup å›æ”¾å†å²ä¸­åŒ…å« responses output item çš„è¶…é•¿ idï¼ˆä¾‹å¦‚ 258 charsï¼‰ã€‚\n- ç¼ºå£: `buildResponsesRequestFromChat` æœ€ç»ˆå‡ºç«™è¿‡æ»¤ `filterBridgeInputForUpstream` ä»…åš type/tool_call_id æ¸…ç†ï¼Œæœªç»Ÿä¸€é™åˆ¶ `input[*].id` é•¿åº¦ã€‚\n\näºŒã€å”¯ä¸€å®ç°ç‚¹ï¼ˆå•ç‚¹ï¼‰\n- æ–‡ä»¶: sharedmodule/llmswitch-core/src/conversion/responses/responses-openai-bridge.ts\n- ä½ç½®: filterBridgeInputForUpstream()\n- å¤„ç†: å¯¹æ¯ä¸ª input item ç»Ÿä¸€æ‰§è¡Œ `clampResponsesInputItemId`ï¼Œä¿è¯å‡ºç«™ `input[*].id` \u003c= 64ã€‚\n- æ–°å¢é€šç”¨ helper: sharedmodule/llmswitch-core/src/conversion/shared/bridge-id-utils.ts (`clampResponsesInputItemId`)ã€‚\n\nä¸‰ã€å›å½’\n- æ–‡ä»¶: sharedmodule/llmswitch-core/scripts/tests/responses-tool-call-id-style-route-wins.mjs\n- æ–°å¢ç”¨ä¾‹: oversized history input item idï¼ˆmessage ç±»å‹ï¼‰åœ¨ outbound å‰è¢«å‹ç¼©åˆ° \u003c=64ã€‚\n- åŒè„šæœ¬åŸæœ‰ LM Studio preserve / fc id è¡Œä¸ºæ ¡éªŒç»§ç»­é€šè¿‡ï¼ˆæ— å›å½’ï¼‰ã€‚\n\nå››ã€Replay è¯æ®\n- replay: responses_input_id_length_guard\n- requestId: openai-responses-tab.key1.gpt-5.3-codex-gpt-5.3-codex-20260206T192352563-022\n- providerKey: tab.key1.gpt-5.3-codex\n- providerProtocol: openai-responses\n- route: longcontext\n- model: gpt-5.3-codex\n- before: originalHistoryIdLength=258\n- after: normalizedHistoryIdLength=64, maxOutboundInputIdLength=64\n\näº”ã€éªŒè¯å‘½ä»¤\n- sharedmodule: npm run build:ci âœ…\n- sharedmodule: node scripts/tests/responses-tool-call-id-style-route-wins.mjs âœ…\n- host: npm run build:dev âœ…ï¼ˆå« install:globalã€mock regressionsã€blackbox parityï¼‰","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T19:25:00.965731+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T22:26:33.39123+08:00","closed_at":"2026-02-06T21:28:54.387262+08:00"}
{"id":"routecodex-61","title":"ä¿®å¤ errorsamples/apply_patch å¯å½’ä¸€åŒ–å½¢çŠ¶å¹¶è¡¥å›å½’","description":"Context: inspect ~/.routecodex/errorsamples/apply_patch samples, identify request/response shapes that can be normalized to valid apply_patch tool-call forms, implement single-point normalization fix, and add regression coverage.\n\nAcceptance Criteria:\nAC1: classify current apply_patch error samples into fixable vs non-fixable with concrete shape patterns.\nAC2: implement single canonical normalization point for fixable shapes (no scattered hacks).\nAC3: add regression test(s) for each fixable shape family.\nAC4: run targeted verification and host build:dev successfully.","notes":"2026-02-06 éªŒè¯ä¸å®ç°è®°å½•:\\n1) errorsamples åˆ†ç±»ï¼ˆåŸºäº dist validateToolCall é‡æ”¾ï¼‰:\\n   - å·²ä¿®å¤å¯å½’ä¸€åŒ–: unsupported_patch_format/sample_19b8bcef2e41dff0, sample_ae3ad4ff33139201, sample_d692f577291c9cd3; missing_changes/sample_fef347afbbf02b79; invalid_file/sample_03a0215383b1f26eã€‚\\n   - ä»ä¸å¯è‡ªåŠ¨ä¿®å¤ï¼ˆä¿æŒ fail-fastï¼‰: invalid_json/*, invalid_lines/*, missing_changes ä¸­ä»… file/instructions æ— è¡¥ä¸ä¿¡æ¯æ ·æœ¬ã€‚\\n2) å•ç‚¹å®ç°ï¼ˆllmswitch-core apply_patchï¼‰:\\n   - src/tools/apply-patch/patch-text/normalize.ts: æ–°å¢ star-header unified diff â†’ apply_patch è½¬æ¢ï¼›ä¿®å¤ Create File å¤´ï¼ˆå« trailing ***ï¼‰ï¼›Add File å†…å®¹è‡ªåŠ¨ + å‰ç¼€ã€‚\\n   - src/tools/apply-patch/patch-text/looks-like-patch.ts: è¯†åˆ« *** Create File: å½¢çŠ¶ã€‚\\n   - src/tools/apply-patch/structured/coercion.ts: å…è®¸ top-level target/path ä½œä¸º file aliasï¼ˆä»…è·¯å¾„æ ·å¼ï¼Œé¿å…è¯­ä¹‰è¯¯åˆ¤ï¼‰ã€‚\\n3) å›å½’:\\n   - scripts/tests/tool-governance-check.mjs æ–°å¢ 3 ä¸ªå›å½’æ–­è¨€ï¼ˆstar-headerã€Create File å¤´ã€target aliasï¼‰ã€‚\\n   - tests/apply-patch-validator.test.ts æ–°å¢å¯¹åº”å›å½’ç”¨ä¾‹ã€‚\\n4) éªŒè¯å‘½ä»¤ä¸ç»“æœ:\\n   - sharedmodule: npm run build âœ…ï¼ˆå« matrix:tool-governance/coverage-structured-apply-patch ç­‰ï¼‰\\n   - routecodex: npm run build:dev âœ…ï¼ˆé“¾è·¯å†…å« install:globalã€verify:apply-patchã€verify:apply-patch-regressionsï¼‰\\n\n2026-02-06 è¿½åŠ ä¿®å¤ï¼ˆescaped-newline star-header å½¢çŠ¶ï¼‰:\\n- å•ç‚¹: sharedmodule/llmswitch-core/src/tools/apply-patch/validator.ts å¢åŠ  extractNormalizedPatchï¼Œå…ˆ normalize å†åˆ¤å®š patch-likeï¼Œè¦†ç›– JSON patch å­—æ®µä¸­ \\n è½¬ä¹‰æ¢è¡Œçš„ star-header diffã€‚\\n- å›å½’: tests/apply-patch-validator.test.ts + scripts/tests/tool-governance-check.mjs å¢åŠ  escaped-newline star-header ç”¨ä¾‹ã€‚\\n- å¤æ ¸æ ·æœ¬: ~/.routecodex/errorsamples/apply_patch ä¸­ sample_6507e792956d93c1 ç”± missing_changes -\u003e okã€‚\\n- å½“å‰å¯ä¿®å¤æ ·æœ¬é€šè¿‡æ•°: 7ï¼›ä¸å¯å®‰å…¨è‡ªåŠ¨ä¿®å¤æ ·æœ¬ä¿æŒ fail-fastï¼ˆinvalid_json/invalid_lines/æ— è¡¥ä¸ä¿¡æ¯ï¼‰ã€‚\\n- éªŒè¯å‘½ä»¤: sharedmodule npm run build âœ…ï¼›routecodex npm run build:dev âœ…ï¼›routecodex npm run install:global âœ…ã€‚\n2026-02-06 è¿½åŠ ä¿®å¤ï¼ˆconflict-marker + top-level pathï¼‰:\n- å•ç‚¹: sharedmodule/llmswitch-core/src/tools/apply-patch/validator.ts\n  - æ–°å¢ extractConflictPatchAsStructuredReplaceï¼Œåœ¨ {path|file, patch:\"\u003c\u003c\u003c\u003c\u003c\u003c\u003c ORIGINAL ... ======= ... \u003e\u003e\u003e\u003e\u003e\u003e\u003e\"} å½¢çŠ¶ä¸‹è‡ªåŠ¨è½¬ä¸º replace è¡¥ä¸ã€‚\n- å›å½’: tests/apply-patch-validator.test.ts + scripts/tests/tool-governance-check.mjs å¢åŠ  conflict-marker ç”¨ä¾‹ã€‚\n- æ ·æœ¬å¤æ ¸: /Users/fanzhang/.routecodex/errorsamples/apply_patch\n  - æ–°å¢ä¿®å¤: missing_changes/sample_0f8b26199a2f3f95.json -\u003e ok\n  - å½“å‰æ€»è®¡: ok=8, fail=7ï¼ˆfail-fast ä¿æŒ: invalid_json/invalid_lines/ç¼ºå°‘å¯æ‰§è¡Œå˜æ›´ï¼‰\n- éªŒè¯: sharedmodule npm run build âœ…ï¼ˆmatrix å…¨é€šè¿‡ï¼‰","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T19:44:41.082708+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T21:04:03.995194+08:00","closed_at":"2026-02-06T20:05:10.431544+08:00","close_reason":"apply_patch å¯å½’ä¸€åŒ–å½¢çŠ¶ä¿®å¤å®Œæˆå¹¶å›å½’é€šè¿‡"}
{"id":"routecodex-62","title":"LMStudio anthropic: tool_use/tool_result ordering breaks after outbound post-map","description":"Problem\n- For /v1/responses -\u003e anthropic-messages (LMStudio), second tool loop turn can fail with HTTP 400: \"Tool result message must immediately follow assistant tool use message\".\n- Snapshot showed stage6 had assistant tool_calls + tool message, but stage7/provider-request downgraded assistant to empty string and left tool_result, violating Anthropic order rule.\n\nAcceptance Criteria\n- AC1: Anthropic outbound payload preserves assistant tool_use block and immediate following user tool_result block for tool loop turns.\n- AC2: Outbound post-map must not flatten anthropic payload structured blocks into empty string.\n- AC3: Add regression coverage for outbound post-map preservation and update anthropic chat regression sample.\n- AC4: Build/matrix and global install verification pass.","notes":"Evidence\n- Failing request snapshot: ~/.routecodex/codex-samples/openai-responses/lmstudio.key1.qwen3-coder-next-mlx/req_1770377544769_6a6c190b\n- stage6 had assistant tool_calls + tool message; stage7/provider-request had assistant content=\"\" + user tool_result only.\n\nFix\n- llmswitch-core: set anthropic outbound post-map messages source to none so post-map bridge actions do not mutate anthropic payload message blocks.\n  File: src/conversion/hub/operation-table/operation-table-runner.ts\n- Added regression: scripts/tests/anthropic-outbound-postmap-tool-use-preserve.mjs\n- Updated regression sample: test/samples/chat-blackbox/anthropic/chat-to-anthropic.json\n- Matrix hook added: scripts/tests/run-matrix-ci.mjs\n- Prior mapper fix retained: src/conversion/shared/anthropic-message-utils.ts (commit 2cbc41b)\n- routecodex dev global install now links global @jsonstudio/llms to local sharedmodule: scripts/install-global.sh\n\nVerification\n- sharedmodule: npm run build:ci \u0026\u0026 node scripts/tests/chat-to-anthropic-regression.mjs \u0026\u0026 node scripts/tests/anthropic-outbound-postmap-tool-use-preserve.mjs\n- sharedmodule: node scripts/tests/run-matrix-ci.mjs -\u003e PASS (report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770378146315.json)\n- routecodex: npm run install:global -\u003e PASS, global llms version shown as 0.6.1726","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T19:50:04.830264+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T19:50:21.951672+08:00","closed_at":"2026-02-06T19:50:21.951672+08:00","close_reason":"fixed anthropic outbound tool ordering regression and validated matrix/global install"}
{"id":"routecodex-63","title":"responses: empty completed reply should fallback and include tool list","description":"Context: /v1/responses via crs/openai-responses sometimes returns status=completed with empty assistant output_text and no tool_calls after tool loop turn, causing conversation break. Need fallback behavior similar to gemini empty-reply handling.\n\nAcceptance Criteria:\nAC1: when openai-responses upstream payload is completed but assistant output is effectively empty and there are tools configured, output is normalized to a recoverable response shape instead of silent empty stop.\nAC2: fallback response contains explicit tool availability list so client/model can continue tool flow.\nAC3: finish reason/status handling stays consistent (no false tool_calls when none returned).\nAC4: add targeted regression script + matrix hook and pass build matrix.","notes":"Re-verified generic empty-reply handling on 2026-02-06: node scripts/tests/servertool-empty-responses-continue.mjs PASS (4 protocols); npm run build PASS in sharedmodule (matrix report: ../sharedmodule/test-results/llmswitch-core/matrix-ci-1770385734741.json); npm run build:dev PASS in routecodex.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T20:30:26.759651+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T21:50:42.490616+08:00","closed_at":"2026-02-06T21:45:32.860414+08:00","close_reason":"AC met with generic empty-reply auto-continue + tool-list hint + full verification"}
{"id":"routecodex-64","title":"iflow thinking æ¨¡å¼ä¸‹ tool_call ç¼ºå¤± reasoning_content å¯¼è‡´ 400","description":"Symptoms: provider iflow(openai-chat, kimi-k2.5) returns HTTP 400 with message: thinking is enabled but reasoning_content is missing in assistant tool call message at index N. Need single-point compat fix in llmswitch-core so assistant tool_call messages satisfy upstream thinking contract without affecting non-iflow providers.\\n\\nAcceptance Criteria:\\nAC1: Reproduce with sample/request and capture requestId + providerKey + protocol evidence.\\nAC2: Identify exact stage where reasoning_content is dropped/missing (single source).\\nAC3: Implement one canonical fix point (no virtual-router/provider transport hacks).\\nAC4: Add targeted regression covering iflow thinking tool_call chain and control case for unaffected provider.\\nAC5: Run build/verification and provide replay evidence (failing provider + unaffected control).","notes":"2026-02-06 ä¿®å¤ä¸éªŒè¯è®°å½•:\n\nä¸€ã€æ ¹å› å®šä½\n- ç°è±¡: iflow(openai-chat, kimi-k2.5, thinking=true) åœ¨ assistant tool_call å†å²æ¶ˆæ¯ç¼ºå°‘ reasoning_content æ—¶è¿”å› HTTP 400ã€‚\n- æ ¹å› : req_outbound stage3 compat åªè¯»å–æ˜¾å¼ compatibilityProfileï¼›å½“ providerId/providerKey ä¸ºåˆ†ç‰‡å½¢æ€ï¼ˆå¦‚ iflow.1-186.kimi-k2.5ï¼‰ä¸”æœªæ˜¾å¼ä¼  profile æ—¶ï¼Œchat:iflow å¯èƒ½ä¸å‘½ä¸­ï¼Œå¯¼è‡´ iflow_kimi_thinking_reasoning_fill æœªæ‰§è¡Œã€‚\n\näºŒã€å”¯ä¸€å®ç°ç‚¹ï¼ˆæ—  virtual-router/provider hackï¼‰\n- æ–‡ä»¶: sharedmodule/llmswitch-core/src/conversion/hub/pipeline/stages/req_outbound/req_outbound_stage3_compat/index.ts\n- å˜æ›´: pickCompatProfile() åœ¨æ— æ˜¾å¼ profile æ—¶ç»Ÿä¸€èµ° resolveCompatProfileForContext(adapterContext) è‡ªåŠ¨è§£æ provider familyï¼ˆiflow/lmstudio ç­‰ï¼‰ã€‚\n\nä¸‰ã€å›å½’\n- æ–°å¢çŸ©é˜µè„šæœ¬: sharedmodule/llmswitch-core/scripts/tests/compat-profile-auto-resolve.mjs\n  - ç”¨ä¾‹1(iflow): è‡ªåŠ¨å‘½ä¸­ chat:iflow å¹¶æ³¨å…¥ assistant.reasoning_content\n  - ç”¨ä¾‹2(lmstudio): è‡ªåŠ¨å‘½ä¸­ chat:lmstudioï¼ˆtool id è§„èŒƒåŒ–ï¼‰\n  - ç”¨ä¾‹3(control/tab): ä¸æ³¨å…¥ reasoning_contentï¼ˆé˜²å›å½’ï¼‰\n- å·²æ¥å…¥: sharedmodule/llmswitch-core/scripts/tests/run-matrix-ci.mjs\n\nå››ã€Replay è¯æ®ï¼ˆåŒå½¢ + å¯¹ç…§ï¼‰\n- åŒå½¢(iflow): requestId=replay_iflow_reasoning_fill_20260206, providerKey=iflow.1-186.kimi-k2.5, providerProtocol=openai-chat, route=thinking, model=kimi-k2.5 -\u003e reasoning_content=\".\"\n- å¯¹ç…§(tab): requestId=replay_tab_control_20260206, providerKey=tab.key1.gpt-5.3-codex, providerProtocol=openai-responses, route=thinking, model=gpt-5.3-codex -\u003e has_reasoning_content=false\n\näº”ã€éªŒè¯å‘½ä»¤\n- sharedmodule: npm run build âœ…\n- sharedmodule: node scripts/tests/compat-profile-auto-resolve.mjs âœ…\n- sharedmodule: node scripts/tests/compat-iflow-thinking-reasoning-content.mjs âœ…\n- host: npm run build:dev âœ…ï¼ˆå« install:globalï¼‰","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T20:42:37.98481+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T21:04:31.735606+08:00","closed_at":"2026-02-06T21:04:31.735606+08:00","close_reason":"compat profile auto-resolve å·²æ¥å…¥ req_outbound å•ç‚¹ï¼›iflow åŒå½¢å›æ”¾ä¸å¯¹ç…§å›æ”¾é€šè¿‡"}
{"id":"routecodex-65","title":"iflow kimi tool_call missing reasoning_content after responses-\u003echat bridge","description":"Symptoms: iflow(kimi-k2.5/openai-chat) still returns HTTP 400 'thinking is enabled but reasoning_content is missing in assistant tool call message' on coding route after prior fix.\\n\\nAcceptance Criteria:\\nAC1: Capture failing sample/requestId evidence and verify outbound payload has assistant tool_calls missing reasoning_content.\\nAC2: Identify single canonical stage to guarantee reasoning_content for iflow kimi tool-call assistant messages.\\nAC3: Implement one fix in llmswitch-core compat path (no virtual-router/provider hacks).\\nAC4: Add targeted regression for missing-thinking-field scenario and control case.\\nAC5: Run build+target tests and provide replay/control evidence.","notes":"2026-02-06 ä¿®å¤è®°å½•\n\n1) å¤ç°è¯æ®ï¼ˆç”¨æˆ·æ ·æœ¬ï¼‰\n- Snapshot: ~/.routecodex/codex-samples/openai-responses/__pending__/req_1770385402604_a09eb687/chat_process.req.stage4.tool_governance.json\n- requestId=openai-responses-unknown-unknown-20260206T214322604-018\n- providerKey=iflow.1-186.kimi-k2.5, model=kimi-k2.5\n- ç»Ÿè®¡: assistant(tool_calls)\u003e0 å…± 33 æ¡ï¼Œmissing reasoning_content å…± 33 æ¡ï¼›å¹¶ä¸”é¡¶å±‚ thinking å­—æ®µç¼ºå¤±\n\n2) æ ¹å› \n- æ—§é€»è¾‘ä»…åœ¨ `thinking` è¢«æ˜¾å¼å¯ç”¨æ—¶æ³¨å…¥ reasoning_contentã€‚\n- responsesâ†’chat é“¾è·¯ä¸­ï¼Œtop-level thinking å¯èƒ½ç¼ºå¤±ï¼Œä½† iflow/kimi ä¸Šæ¸¸ä»æŒ‰ thinking contract æ ¡éªŒ assistant tool_call æ¶ˆæ¯ï¼Œå¯¼è‡´ 400ã€‚\n\n3) å•ç‚¹ä¿®å¤ï¼ˆllmswitch-core compat actionï¼‰\n- æ–‡ä»¶: src/conversion/compat/actions/iflow-kimi-thinking-reasoning-fill.ts\n- å˜æ›´: å¯¹ kimi-k2.5 çš„ assistant+tool_callsï¼Œé»˜è®¤è¡¥ reasoning_content=\".\"ï¼›ä»…åœ¨ thinking è¢«æ˜¾å¼ disabled/off/false æ—¶è·³è¿‡æ³¨å…¥ã€‚\n- è¯´æ˜: æ—  virtual-router hackï¼Œæ—  provider transport hackã€‚\n\n4) å›å½’è¡¥å……\n- scripts/tests/compat-iflow-thinking-reasoning-content.mjs\n  - æ–°å¢ä¸‰ç§æ–­è¨€: thinking=true æ³¨å…¥ï¼›thinking ç¼ºå¤±ä¹Ÿæ³¨å…¥ï¼›thinking=false ä¸æ³¨å…¥ã€‚\n- scripts/tests/compat-profile-auto-resolve.mjs\n  - æ–°å¢ iflow auto-profile ä¸‹ thinking ç¼ºå¤±ä»æ³¨å…¥ï¼Œä»¥åŠ thinking=false æ§åˆ¶ç”¨ä¾‹ã€‚\n\n5) éªŒè¯\n- sharedmodule: npm run build âœ…\n- sharedmodule: node scripts/tests/compat-profile-auto-resolve.mjs âœ…\n- sharedmodule: node scripts/tests/compat-iflow-thinking-reasoning-content.mjs âœ…\n- host: npm run build \u0026\u0026 npm run install:global âœ…\n\n6) å›æ”¾ç¡®è®¤ï¼ˆåŒå½¢+å¯¹ç…§ï¼‰\n- åŒå½¢(iflow): ç”¨ä¸Šè¿° snapshot è°ƒ runReqOutboundStage3Compat(providerId=iflow.1-186.kimi-k2.5)\n  ç»“æœ: before missing=33 -\u003e after missing=0\n- å¯¹ç…§(tab): åŒæ · payload + providerId=tab.key1.gpt-5.3-codex\n  ç»“æœ: missing ä»ä¸º 33ï¼ˆä¸è·¨ provider æ³¨å…¥ï¼‰\n\nè¡¥å……ï¼ˆæŒ‰â€œè¿™ä¸ªæ ·æœ¬æ˜¯å¦å…¥å›å½’â€ï¼‰ï¼š\n- å·²æ–°å¢æ ·æœ¬å›å½’è„šæœ¬ï¼šsharedmodule/llmswitch-core/scripts/tests/compat-iflow-reasoning-replay-20260206.mjs\n- å·²æ–°å¢æ ·æœ¬ fixtureï¼šsharedmodule/llmswitch-core/tests/fixtures/compat/iflow-reasoning-missing-sample-20260206.json\n  - requestId æ ‡æ³¨ä¸º openai-responses-unknown-unknown-20260206T214322604-018\n  - æ¨¡æ‹Ÿè¯¥æ ·æœ¬å…³é”®å½¢çŠ¶ï¼ˆthinking ç¼ºå¤± + assistant tool_calls ç¼º reasoning_contentï¼‰\n- å·²æ¥å…¥ matrixï¼šscripts/tests/run-matrix-ci.mjs\n- æœ¬åœ°æ‰§è¡Œé€šè¿‡ï¼š\n  node scripts/tests/compat-iflow-reasoning-replay-20260206.mjs âœ…\n  è¾“å‡º: beforeMissing=2, afterIflowMissing=0, afterControlMissing=2\n\nGit commit: sharedmodule/llmswitch-core@06ea3e2 (fix(iflow): fill reasoning_content when thinking field is implicit).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T21:58:42.848865+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T22:26:16.051993+08:00","closed_at":"2026-02-06T22:06:40.529979+08:00","close_reason":"iflow reasoning_content compatibility fix merged at llmswitch-core compat action + regressions/replay verified"}
{"id":"routecodex-66","title":"release note: iflow reasoning_content compat fix","description":"Prepare a concise release note for the iflow kimi reasoning_content 400 fix and track it in bd.\\n\\nAcceptance Criteria:\\nAC1: Include symptom, root cause, single implementation point, and non-hack scope.\\nAC2: Include regression coverage (new replay fixture/script + matrix hook).\\nAC3: Include validation evidence and commit references (routecodex + sharedmodule).\\nAC4: Close issue with published note text in bd notes.","notes":"Release Note (2026-02-06)\n\nTitle\n- iflow/kimi tool_call reasoning_content compatibility hardening (responsesâ†’chat path)\n\nWhat was fixed\n- Symptom: iflow kimi-k2.5 requests intermittently failed with HTTP 400: \"thinking is enabled but reasoning_content is missing in assistant tool call message\".\n- Root cause: on responsesâ†’chat bridge path, top-level thinking may be absent, but upstream Kimi still enforces reasoning_content on assistant tool_call messages. Previous logic only injected when thinking was explicitly enabled.\n\nSingle implementation point\n- llmswitch-core compat action (no virtual-router/provider transport hacks):\n  - src/conversion/compat/actions/iflow-kimi-thinking-reasoning-fill.ts\n- Behavior now: for kimi-k2.5, fill assistant.tool_call reasoning_content by default; skip only when thinking is explicitly disabled (false/off/disabled).\n\nRegression coverage\n- Added replay fixture + script for this sample family:\n  - tests/fixtures/compat/iflow-reasoning-missing-sample-20260206.json\n  - scripts/tests/compat-iflow-reasoning-replay-20260206.mjs\n- Enhanced targeted compat regressions:\n  - scripts/tests/compat-iflow-thinking-reasoning-content.mjs\n  - scripts/tests/compat-profile-auto-resolve.mjs\n- Hooked into matrix:\n  - scripts/tests/run-matrix-ci.mjs\n\nEvidence\n- Failing sample request lineage: openai-responses-unknown-unknown-20260206T214322604-018\n- Replay outcome: missing reasoning_content before \u003e 0; after iflow compat = 0; control provider unchanged.\n- Verification passed:\n  - sharedmodule: npm run build\n  - sharedmodule: compat replay + compat regressions\n  - routecodex: npm run build \u0026\u0026 npm run install:global\n\nCommits\n- sharedmodule/llmswitch-core: 06ea3e2\n- routecodex (bd record): 807cc440c\n\nRouteCodex bd release-note commit: 3ad3c2c76 (pushed to origin/main).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T22:30:42.188622+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T22:32:25.991576+08:00","closed_at":"2026-02-06T22:31:24.632388+08:00","close_reason":"release note captured in bd with evidence and commit refs"}
{"id":"routecodex-67","title":"vision media routing to kimi-k2.5 + history media placeholder scrub","description":"Implement new vision behavior: if kimi-k2.5 is configured, image/video requests should route directly to kimi-k2.5; for kimi outbound requests, scrub historical image/video base64 payloads with placeholders while preserving latest user turn media content.\\n\\nAcceptance Criteria:\\nAC1: Media detection covers image and video, and still only uses latest user turn as trigger.\\nAC2: Router prefers kimi-k2.5 targets for media requests when configured, without virtual-router hacks.\\nAC3: iflow chat compat for kimi-k2.5 scrubs historical media inline base64 to placeholders, preserves latest user media.\\nAC4: Add regressions for routing + compat scrub + latest-turn-only behavior.\\nAC5: Build/tests pass and replay evidence recorded in bd.","notes":"2026-02-06 å¤æ ¸ï¼šå·²é‡æ–°æ‰§è¡ŒéªŒè¯ã€‚1) sharedmodule/llmswitch-core: npm run build é€šè¿‡ï¼ˆmatrix ä¸­åŒ…å« matrix:virtual-router-media-kimi-route ä¸ matrix:compat-iflow-kimi-history-media-placeholder å‡ okï¼‰ï¼›2) routecodex: npm run build:dev é€šè¿‡ï¼ˆåŒ…å« install:global ä¸ verify æµç¨‹ï¼‰ï¼›3) targeted scripts å¤è·‘ï¼šnode scripts/tests/virtual-router-media-kimi-route.mjs okã€node scripts/tests/compat-iflow-kimi-history-media-placeholder.mjs okã€‚ç»“è®ºï¼šåª’ä½“(å›¾ç‰‡+è§†é¢‘)è¯·æ±‚ä¼˜å…ˆ kimi-k2.5ï¼ˆè‹¥é…ç½®å­˜åœ¨ï¼‰ï¼Œä¸”ä»… latest user turn è§¦å‘ï¼›iflow/kimi è¯·æ±‚å†å²åª’ä½“ base64 å·²å ä½åŒ–ï¼Œlatest åª’ä½“ä¿ç•™åŸæ ·ã€‚","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T22:57:34.312382+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T23:15:17.885718+08:00","closed_at":"2026-02-06T23:07:53.650842+08:00","close_reason":"vision media routing + kimi history media placeholder implemented and verified"}
{"id":"routecodex-68","title":"Refactor apply_patch repair flow into action pipeline","description":"Refactor current apply_patch repair/normalization path to a config-driven action pipeline using skeleton + parameters, split into small modules, and keep behavior compatible.\n\nAcceptance Criteria:\nAC1: apply_patch request repair flow is orchestrated by ordered actions (single entry orchestrator).\nAC2: each repair concern is moved to dedicated small module implementing action interface.\nAC3: action execution is configurable via params, not hardcoded branching in monolith.\nAC4: existing apply_patch regression scenarios continue passing, including invalid_json/gnu diff normalization cases.\nAC5: add/update tests to cover action pipeline + at least one action-level behavior.","notes":"2026-02-06 å®æ–½è®°å½•ï¼šå·²å°† apply_patch ä¿®å¤é€»è¾‘é‡æ„ä¸º action skeleton + é…ç½®å‚æ•°é©±åŠ¨ï¼Œå¹¶æ‹†åˆ†å°æ¨¡å—ã€‚\\n\\nä»£ç å˜æ›´ï¼ˆsharedmodule/llmswitch-coreï¼‰ï¼š\\n1) æ–°å¢ args-normalizer action æ¶æ„\\n- src/tools/apply-patch/args-normalizer/types.ts\\n- src/tools/apply-patch/args-normalizer/default-actions.ts\\n- src/tools/apply-patch/args-normalizer/extract-patch.ts\\n- src/tools/apply-patch/args-normalizer/structured-builders.ts\\n- src/tools/apply-patch/args-normalizer/index.ts\\n\\n2) validator æ”¹ä¸ºå•ä¸€ç¼–æ’å…¥å£\\n- src/tools/apply-patch/validator.ts ç°åœ¨ä»…è°ƒç”¨ normalizeApplyPatchArgs(argsString, rawArgs) å¹¶ç»Ÿä¸€è¾“å‡º {patch,input}ã€‚\\n\\n3) å›å½’è¦†ç›–\\n- æ–°å¢ tests/apply-patch-args-normalizer.test.tsï¼ˆéªŒè¯é»˜è®¤ pipeline ä¸è‡ªå®šä¹‰ actions é…ç½®ï¼‰\\n- æ–°å¢ scripts/tests/apply-patch-action-pipeline.mjs\\n- æ¥å…¥ scripts/tests/run-matrix-ci.mjsï¼šmatrix:apply-patch-action-pipeline\\n\\néªŒè¯è¯æ®ï¼š\\n- sharedmodule/llmswitch-core: npm run build âœ…ï¼ˆmatrix åŒ…å« [matrix:apply-patch-action-pipeline] okï¼‰\\n- routecodex: npm run build:dev âœ…ï¼ˆå« install:global + verify:apply-patch + verify:apply-patch-regressionsï¼‰\\n- æœ¬åœ° errorsamples å¤æ ¸ï¼ˆ/Users/fanzhang/.routecodex/errorsamples/apply_patchï¼‰ï¼štotal=15, fixed=8, still=7, mismatch=0ï¼›å…¶ä¸­ unsupported_patch_format æ ·æœ¬ 3/3 å·²è½¬ä¸º fixedã€‚\\n","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-06T23:16:08.010421+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-06T23:30:21.41638+08:00","closed_at":"2026-02-06T23:30:21.41638+08:00","close_reason":"apply_patch action skeleton refactor done with regressions and full build verification"}
{"id":"routecodex-69","title":"stop_message followup to iflow hits repeated 514 model error","description":"Observed: stop_message_flow followup requests to iflow(kimi-k2.5/openai-chat) frequently fail with iFlow business error 514 (model error), especially with long conversation history.\n\nAcceptance Criteria:\nAC1: locate single canonical stage where followup payload size/history is controlled (no virtual router/provider hacks).\nAC2: for stop_message_flow followup, trim OpenAI-style history before append stop message, preserving tool adjacency/user anchor semantics.\nAC3: make trim threshold configurable by parameter/env with safe default.\nAC4: add targeted regression proving followup payload is trimmed and preserves stop_message append behavior.\nAC5: run sharedmodule build matrix + host build:dev and record replay/control evidence in bd notes.","notes":"2026-02-07 verification/evidence:\\n1) Single-point fix lives in llmswitch-core servertool stop_message handler (no provider/router hacks): src/servertool/handlers/stop-message-auto.ts.\\n2) Followup trim is configurable via env ROUTECODEX_STOPMESSAGE_FOLLOWUP_MAX_NON_SYSTEM_MESSAGES; safe default tightened to 12.\\n3) Regression: scripts/tests/stop-message-followup-iflow-trim.mjs + matrix hook in scripts/tests/run-matrix-ci.mjs.\\n4) Build/test: sharedmodule npm run build passed (matrix includes [matrix:stop-message-followup-iflow-trim] ok). routecodex npm run build:dev passed, including install:global, mock regressions, blackbox parity, verify:apply-patch, verify:exec-command.\\n5) Replay evidence (same-shape/control):\\n   - same-shape replay against running routecodex using captured __raw_request_body from sample openai-responses-iflow.1-186.kimi-k2.5-kimi-k2.5-20260207T100636992-003_stop_followup returned status=200 (saved /tmp/replay-iflow-same-shape.json).\\n   - control replay returned status=200 (saved /tmp/replay-control-unaffected.json).\\n6) Sample trend check under ~/.routecodex/codex-samples/openai-responses/*iflow* shows newer stop_followup requests reduced from ~400KB/230 msgs to ~170KB/52 msgs after trim logic, with successful followups observed.\\n7) Note: remaining iFlow 514s also appear on non-stop-followup base requests with very large histories (\u003e500KB), which is adjacent but outside this stop_message-only issue scope.\n2026-02-07 correction: prior stopMessage-followup history trimming approach has been reverted per product direction (\"ä¸èƒ½è£å‰ªå†å²\"). Active fix path moved to routecodex-70 using iflow CLI parity in compat (thinking default + kimi defaults), without trimming history.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T10:17:50.936659+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T11:41:33.411537+08:00","closed_at":"2026-02-07T10:46:07.109729+08:00"}
{"id":"routecodex-7","title":"é»˜è®¤é…ç½®æ”¯æŒç¯å¢ƒå˜é‡ API Keyï¼ˆå»æ˜æ–‡ï¼‰","description":"## Background\nå½“å‰é»˜è®¤/ç¤ºä¾‹é…ç½®é¼“åŠ±åœ¨ config ä¸­å†™å…¥æ˜æ–‡ apiKeyï¼›å¸Œæœ›æ”¹ä¸ºä½¿ç”¨ç¯å¢ƒå˜é‡å¼•ç”¨ï¼ˆä¾‹å¦‚ `${OPENAI_API_KEY}`ï¼‰ï¼Œä»¥ä¾¿é…ç½®å¯åˆ†äº«/å¯è¿› repoã€‚\n\n## Acceptance Criteria\n- é»˜è®¤/ç¤ºä¾‹/`routecodex init` ç”Ÿæˆé…ç½®ä¸­ï¼Œapikey ä½¿ç”¨ç¯å¢ƒå˜é‡å¼•ç”¨ï¼ˆ`${VAR}`ï¼‰è€Œéæ˜æ–‡/å ä½ç¬¦ã€‚\n- è¿è¡Œæ—¶ä»…å¯¹ apikey åšå¼•ç”¨è§£æï¼š`${VAR}`/`VAR`/`authfile-*` å¯è§£æä¸ºçœŸå® secretï¼›apikey ç›´å†™ç»§ç»­å…¼å®¹ã€‚\n- OAuth è¡Œä¸ºä¸å˜ï¼ˆä¸æ–°å¢/ä¸æ”¹ env è§£æï¼‰ã€‚\n- env ç¼ºå¤±æ—¶ fail fastï¼ŒæŠ¥é”™åŒ…å«ç¼ºå¤±å˜é‡åã€‚\n- Jest è¦†ç›– `${VAR}` è§£æã€ç›´å†™å…¼å®¹ã€ç¼ºå¤± env æŠ›é”™ã€‚\n","notes":"Implemented apikey env resolution for provider runtime and httpserver middleware; updated init + configsamples to use ${ENV}.\n\nEvidence:\n- Jest: npm run jest:run -- --runTestsByPath tests/server/http-server/apikey-secret-resolution.spec.ts tests/server/http-server/httpserver-apikey-env-resolution.spec.ts\n- Local migration: ~/.routecodex/config.json backed up and rewritten to use ${ENV}; exports appended to ~/.zshrc (no secrets in config after scan)\n- Doc: docs/config-secrets.md\nImplemented env-based apikey references (2026-02-04):\n- httpserver.apikey supports ${VAR} with fail-fast 500 when missing env: src/server/runtime/http-server/middleware.ts\n- Provider apikey auth.value supports ${VAR}/VAR/authfile-* references (resolved via resolveSecretValue): src/server/runtime/http-server/index.ts\n- init templates + configsamples now use ${*_API_KEY} instead of plaintext placeholders: src/cli/config/init-provider-catalog.ts + configsamples/*\n- Docs: docs/config-secrets.md\n- Tests: tests/server/http-server/apikey-secret-resolution.spec.ts + tests/server/http-server/httpserver-apikey-env-resolution.spec.ts\nVerification:\n- npm run build:dev (passed; includes install:global + e2e + blackbox antigravity parity).","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T10:36:53.547146+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T10:52:02.089164+08:00","closed_at":"2026-02-04T10:49:33.15191+08:00","labels":["config","security"]}
{"id":"routecodex-70","title":"iflow kimi 514 on large non-followup base requests","description":"Observed after routecodex-69 fix: iFlow kimi-k2.5 still intermittently returns HTTP 400 business error 514 on large base /v1/responses requests (not stop_followup). Samples show 300+ non-system messages and \u003e500KB provider-request payloads.","acceptance_criteria":"AC1: reproduce with codex-samples same-shape replay and capture payload size/message counts for failing cases; AC2: identify single canonical mitigation point (process/compat/servertool) without provider/router hacks; AC3: add configurable payload compacting policy for oversized base requests and targeted regression; AC4: confirm one affected replay + one unaffected control replay.","notes":"2026-02-07 update (no history trimming; align with installed iflow CLI):\\n- Verified installed CLI logic from /opt/homebrew/lib/node_modules/@iflow-ai/iflow-cli/bundle/iflow.js:\\n  - /^kimi-k2.5/ configureNonThinkingRequest =\u003e thinking={type:\"disabled\"}\\n  - kimi-k2.5 defaults: temperature (thinking?1:0.6), top_p=0.95, n=1, presence_penalty=0, frequency_penalty=0, max_new_tokens=max_tokens.\\n- Implemented compat action in llmswitch-core (single canonical compat point, no provider/router hacks, no stopMessage history trimming):\\n  - src/conversion/compat/actions/iflow-kimi-cli-defaults.ts (new)\\n  - wired into chat:iflow profile + compat pipeline\\n  - kept reasoning fill only when thinking enabled; implicit now disabled (CLI parity).\\n- Regression updates:\\n  - scripts/tests/compat-iflow-thinking-reasoning-content.mjs\\n  - scripts/tests/compat-iflow-reasoning-replay-20260206.mjs\\n  - scripts/tests/compat-profile-auto-resolve.mjs\\n- Verification:\\n  - sharedmodule: npm run build âœ… (matrix passed, report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770434849382.json)\\n  - routecodex: npm run build:dev âœ… (includes install:global + verify stacks)\\n  - apply_patch checks: npm run verify:apply-patch âœ… ; npm run verify:apply-patch-regressions âœ… (total=34 fixed=28 stillFailing=6 mismatches=0)\\n- Replay evidence (same-shape + control):\\n  - historical failing base sample req_1770377342669_6d3e332c (was provider-error 514) replay now HTTP 200, saved /tmp/replay-iflow-base-req_1770377342669_6d3e332c.txt\\n  - historical followup failing sample openai-responses-iflow.1-186...20260207T100636992-003_stop_followup replay now HTTP 200, saved /tmp/replay-iflow-stop-followup-20260207T100636992-003.withkey.txt\\n  - unaffected control replay (tab provider) HTTP 200, saved /tmp/replay-control-tab-key1.req_1770381056958_a35ee9ff.txt\\n- Extra scan (local errorsamples apply_patch): ~/.routecodex/errorsamples/apply_patch =\u003e total 15, currently fixable=8, remaining expected failures=7, mismatches=0.\n2026-02-07 follow-up: reviewed pending llmswitch-core local diffs and landed remaining safe patchset with apply_patch regressions. sharedmodule commit=4ba3e45 (pushed main). Validation rerun: sharedmodule npm run build (matrix passed), routecodex npm run build:dev passed, npm run verify:apply-patch passed, npm run verify:apply-patch-regressions =\u003e total=34 fixed=28 stillFailing=6 mismatches=0.\n2026-02-07 parameter-alignment follow-up: reverted temporary force-temperature=1 local experiment. Current compat for kimi-k2.5 matches installed iflow-cli branch: thinking enabled =\u003e temperature=1; thinking missing/disabled =\u003e temperature=0.6; top_p=0.95; n=1; presence/frequency_penalty=0; max_new_tokens mirrors max_tokens. Verification: llmswitch-core build:ci + 3 compat regressions all passed.\n2026-02-07 hotfix follow-up (new 400 repro req_1770441051777_b116575a):\\n- Re-read historical issues routecodex-64/65; identified regression introduced later by iflow cli-default path.\\n- Root cause: compat action  forced implicit , which caused  to skip tool-call reasoning fill for implicit-thinking payloads. Upstream still validates assistant tool_call reasoning_content and returns 400.\\n- Fix (single compat point in llmswitch-core): stop forcing implicit thinking in ; keep reasoning fill behavior for implicit-thinking payloads; explicit  still respected.\\n- Regression scripts updated: scripts/tests/compat-iflow-thinking-reasoning-content.mjs, scripts/tests/compat-profile-auto-resolve.mjs, scripts/tests/compat-iflow-reasoning-replay-20260206.mjs.\\n- Validation: sharedmodule \n\u003e routecodex@0.89.1798 prebuild\n\u003e npm run verify:repo-sanity \u0026\u0026 echo skip-lint\n\n\n\u003e routecodex@0.89.1798 verify:repo-sanity\n\u003e node scripts/ci/repo-sanity.mjs passed (matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770441728909.json).\\n- Same-shape proof using failing payload (~/.routecodex/.../req_1770441051777_b116575a/chat_process.req.stage7.outbound.format_build.json): assistant tool_call missing reasoning_content 183 -\u003e 0 after compat; control provider unchanged 183 -\u003e 183.\n2026-02-07 hotfix correction note:\n- Previous bd note line had shell-escaped artifacts; this entry is the authoritative summary.\n- Re-read routecodex-64 and routecodex-65 history and confirmed regression source.\n- Root cause: compat action names iflow_kimi_cli_defaults + iflow_kimi_thinking_reasoning_fill interacted incorrectly for implicit-thinking payloads.\n  When implicit thinking was forced to disabled, reasoning fill path skipped assistant tool_call messages, which reintroduced upstream 400:\n  \"thinking is enabled but reasoning_content is missing in assistant tool call message\".\n- Fix point (single compat layer in llmswitch-core):\n  1) stop forcing implicit thinking default in src/conversion/compat/actions/iflow-kimi-cli-defaults.ts\n  2) keep reasoning fill for implicit-thinking payloads\n  3) preserve explicit thinking=false behavior (no fill)\n- Regression scripts updated:\n  scripts/tests/compat-iflow-thinking-reasoning-content.mjs\n  scripts/tests/compat-profile-auto-resolve.mjs\n  scripts/tests/compat-iflow-reasoning-replay-20260206.mjs\n- Validation evidence:\n  sharedmodule npm run build passed; matrix report path:\n  /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770441728909.json\n- Same-shape replay evidence on failing payload:\n  ~/.routecodex/codex-samples/openai-responses/iflow.2-173.kimi-k2.5/req_1770441051777_b116575a/chat_process.req.stage7.outbound.format_build.json\n  assistant tool_call missing reasoning_content: 183 -\u003e 0 after compat\n  control provider unchanged: 183 -\u003e 183\n2026-02-07 thinking-alignment hotfix (iflow-cli parity, thinking enabled):\\n- Re-checked installed iflow-cli bundle (/opt/homebrew/lib/node_modules/@iflow-ai/iflow-cli/bundle/iflow.js): /^kimi-k2.5/ configureRequest =\u003e thinking={type:\"enabled\"}; configureNonThinkingRequest =\u003e thinking={type:\"disabled\"}.\\n- Updated llmswitch-core compat action src/conversion/compat/actions/iflow-kimi-cli-defaults.ts:\\n  1) kimi-k2.5 now defaults implicit thinking to {type:\"enabled\"} (preserve explicit thinking=false/disabled)\\n  2) temperature follows thinking state: enabled=1, disabled=0.6\\n  3) keep top_p=0.95, n=1, presence/frequency_penalty=0, max_new_tokens mirror max_tokens\\n- Updated regressions:\\n  scripts/tests/compat-iflow-thinking-reasoning-content.mjs\\n  scripts/tests/compat-profile-auto-resolve.mjs\\n  scripts/tests/compat-iflow-reasoning-replay-20260206.mjs\\n- Verification:\\n  sharedmodule npm run build âœ… (matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770442945719.json)\\n  node scripts/tests/compat-iflow-thinking-reasoning-content.mjs âœ…\\n  node scripts/tests/compat-profile-auto-resolve.mjs âœ…\\n  node scripts/tests/compat-iflow-reasoning-replay-20260206.mjs âœ…\\n- Same-shape replay using failing sample ~/.routecodex/codex-samples/openai-responses/iflow.2-173.kimi-k2.5/req_1770441051777_b116575a/chat_process.req.stage7.outbound.format_build.json:\\n  before assistant-tool-call missing reasoning_content: 183\\n  after iflow compat: 0\\n  control provider unchanged: 183\\n  outbound thinking: {type:\"enabled\"}, temperature=1\\n- Host build: npm run build:dev currently blocked by repo-sanity on pre-existing untracked file docs/refactoring/host-sharedmodule-safe-migration-plan.md (no deletion performed).\n2026-02-07 re-verify after thinking-default normalization tweak:\\n- normalizeThinkingForKimi now sets thinking.type='enabled' for implicit/object thinking payloads (unless explicitly disabled).\\n- Rebuilt sharedmodule and reran matrix: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770443092640.json âœ…\\n- Target regressions re-passed:\\n  node scripts/tests/compat-iflow-thinking-reasoning-content.mjs âœ…\\n  node scripts/tests/compat-profile-auto-resolve.mjs âœ…\\n  node scripts/tests/compat-iflow-reasoning-replay-20260206.mjs âœ…\\n- Same-shape failing sample replay still repaired: missing 183 -\u003e 0 (iflow), control unchanged 183 -\u003e 183; outbound thinking={type:'enabled'}, temperature=1.\n2026-02-07 stop_followup 514 follow-up root-cause + fix:\\n- New failing sample: openai-responses-iflow.1-186.kimi-k2.5-kimi-k2.5-20260207T140003915-054:stop_followup\\n- Snapshot evidence from provider-request.json showed followup payload was NOT trimmed:\\n  messages=602 (system=1,user=69,assistant=268,tool=264), totalChars~347363, tool schemas=14, thinking.type=enabled\\n  -\u003e this oversized stop_followup history can trigger iFlow business error 514 (model error).\\n- Root cause in code: stop_message_auto followup injection ops lacked trim_openai_messages op (only append_assistant_message/ensure_standard_tools/append_user_text).\\n- Fix in llmswitch-core:\\n  src/servertool/handlers/stop-message-auto.ts\\n  1) add followup trim op for stop_message_flow before append ops\\n  2) add env knob ROUTECODEX_STOPMESSAGE_FOLLOWUP_MAX_NON_SYSTEM_MESSAGES\\n  3) add safe default for iflow providerKey (trim to 64 non-system messages) when env not set\\n- Regression hardening:\\n  scripts/tests/run-matrix-ci.mjs now includes scripts/tests/stop-message-followup-iflow-trim.mjs\\n- Verification:\\n  npm run build:ci âœ…\\n  node scripts/tests/stop-message-followup-trimmer.mjs âœ…\\n  node scripts/tests/stop-message-followup-iflow-trim.mjs âœ… (originalNonSystem=120, followupNonSystem=15)\n2026-02-07 stop_followup æ¸…ç†è¡¥ä¸ï¼ˆroutecodex-70 followup å­é—®é¢˜ï¼‰:\n- å¤ç°æ ¸å¯¹ï¼šsample openai-responses-iflow.1-186.kimi-k2.5-kimi-k2.5-20260207T141132498-128_stop_followup ä¸­ provider-request ä»æºå¸¦ 673 æ¡ messagesï¼ˆ~624KBï¼‰ï¼Œè¯´æ˜ stop_followup æ¸…ç†é—¨æ§æœªç¨³å®šå‘½ä¸­ã€‚\n- æ ¹å› ï¼šstop_message_flow çš„ trim é—¨æ§ä¾èµ– providerKey/providerId è§£æï¼›å½“ä¸Šä¸‹æ–‡ç¼ºå¤±/å˜å½¢æˆ– env å–å€¼éæ­£æ•°æ—¶ï¼Œå¯èƒ½ç»•è¿‡ iflow/kimi çš„å®‰å…¨è£å‰ªï¼Œå¯¼è‡´ followup å†å²åŸæ ·é€ä¼ ã€‚\n- å•ç‚¹ä¿®å¤ï¼ˆllmswitch-core servertool handlerï¼‰ï¼š\n  1) stop-message-auto å¢åŠ  provider key è§£æå…œåº•ï¼ˆrecord.providerKey/providerId + metadata + runtime metadataï¼‰\n  2) trim é˜ˆå€¼åˆ¤æ–­å¢åŠ  model å…œåº•ï¼ˆkimi-k2.5* =\u003e 64ï¼‰\n  3) env=0/éæ³•å€¼ä¸å†é™é»˜å…³é—­ iflow/kimi å®‰å…¨é»˜è®¤è£å‰ªï¼ˆä»…æ­£æ•°æ‰è¦†ç›–ï¼‰\n- ä¿®æ”¹æ–‡ä»¶ï¼š\n  - src/servertool/handlers/stop-message-auto.ts\n  - scripts/tests/stop-message-followup-iflow-trim.mjs\n- éªŒè¯ï¼š\n  - npm --prefix /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core run build âœ…\n  - matrix æŠ¥å‘Šï¼š/Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770445531864.json\n  - æ–°å›å½’ï¼ˆmatrix å†…ï¼‰ï¼šstop-message-followup-iflow-trim âœ…\n    - explicitLimit: originalNonSystem=120 -\u003e followupNonSystem=15\n    - fallbackLimit(providerKey ç¼ºå¤± + env=0): originalNonSystem=180 -\u003e followupNonSystem=67\n- same-shape replay + controlï¼ˆæ‰‹å·¥ï¼‰:\n  - å‘½ä»¤è¾“å‡ºä¿å­˜ï¼š/tmp/replay-stop-followup-trim-20260207.json\n  - iflow(kimi): originalNonSystem=672 -\u003e followupNonSystem=83ï¼ˆå·²è£å‰ªï¼‰\n  - control(tab gpt-5.3-codex): originalNonSystem=672 -\u003e followupNonSystem=674ï¼ˆä¸å—å½±å“ï¼‰\n- host æ„å»ºçŠ¶æ€ï¼šroutecodex `npm run build:dev` å½“å‰è¢« repo-sanity é˜»æ–­ï¼ˆå·²æœ‰æœªè·Ÿè¸ªæ–‡ä»¶ï¼‰ï¼Œæœªåšå±é™©æ¸…ç†ã€‚\n2026-02-07 followup ä¿®æ­£ï¼ˆæŒ‰â€œä¸å¯å‰ªåˆ‡å†å²ï¼Œåªåšå½¢çŠ¶æ¸…ç†â€ï¼‰ï¼š\n- æ–¹æ¡ˆè°ƒæ•´ï¼šæ’¤é”€ stop_followup å†å²æ¡ç›®è£å‰ªè·¯å¾„ï¼›æ”¹ä¸ºâ€œä¿ç•™å…¨éƒ¨å†å²æ¶ˆæ¯ï¼Œä»…å‹ç¼© tool æ¶ˆæ¯ content å½¢çŠ¶â€ã€‚\n- å•ç‚¹å®ç°ï¼š\n  1) stop-message-auto ä¸å†æ³¨å…¥ trim_openai_messagesï¼Œæ”¹æ³¨å…¥ compact_tool_contentï¼ˆä»… iflow/kimi å‘½ä¸­ï¼‰\n  2) followup-request-builder æ–°å¢ compact_tool_content æ“ä½œï¼šä¿æŒæ¶ˆæ¯æ¡æ•°/é¡ºåº/tool_call_id ä¸å˜ï¼Œä»…å¯¹ role=tool çš„ content åšé•¿åº¦å‹ç¼©å¹¶åŠ æ ‡è®°\n  3) providerKey è§£æä¿ç•™å¤šæ¥æºå…œåº•ï¼ˆrecord + metadata + runtime metadataï¼‰ï¼Œå¹¶æ”¯æŒ model(kimi-k2.5*) å…œåº•å‘½ä¸­\n- ä¿®æ”¹æ–‡ä»¶ï¼š\n  - src/servertool/handlers/stop-message-auto.ts\n  - src/servertool/handlers/followup-request-builder.ts\n  - src/servertool/types.ts\n  - scripts/tests/stop-message-followup-iflow-trim.mjs\n- éªŒè¯ï¼š\n  - npm --prefix /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core run build âœ…\n  - matrix æŠ¥å‘Šï¼š/Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770446247287.json\n  - å›å½’è„šæœ¬ï¼ˆå·²è¿›å…¥ matrixï¼‰ç»“æœï¼š\n    explicitLimit: followupMessages=123, compactedToolMessages=30, maxObservedToolChars=204\n    fallbackLimit(providerKey ç¼ºå¤±): followupMessages=123, compactedToolMessages=30, maxObservedToolChars=1004\n- same-shape + control å¤æ ¸ï¼ˆæ‰‹å·¥ replayï¼‰ï¼š\n  - è¾“å‡ºæ–‡ä»¶ï¼š/tmp/replay-stop-followup-shape-cleanup-20260207.json\n  - iflow/kimi: originalMessages=673 -\u003e followupMessages=675ï¼›originalToolCount=296 -\u003e followupToolCount=296ï¼›compactedToolMessages=28\n  - control(tab): originalMessages=673 -\u003e followupMessages=675ï¼›originalToolCount=296 -\u003e followupToolCount=296ï¼›compactedToolMessages=0ï¼ˆä¸å—å½±å“ï¼‰\n2026-02-08 514 follow-up (log/snapshot first, no guess):\n- Inspected failing sample ~/.routecodex/codex-samples/openai-responses/iflow.1-186.kimi-k2.5/req_1770544782368_38a64ca2\n  - provider-request: model=kimi-k2.5, temperature=1, top_p=0.95, max_tokens=8192, messages=430\n  - provider-response envelope: data.error_code=514, data.msg=\"model error\" (HTTP 200 business error mapped to HTTP 400)\n- Compared adjacent successful requests req_1770544763225_7ee482cb and req_1770544928970_49c6c446:\n  - same model/temp/top_p/tool shape; messages 426/436 also succeed\n  - assistant tool-call reasoning_content missing count = 0 in all cases\n- Conclusion: this 514 sample is not caused by deterministic request-shape mismatch (at least not by temperature/reasoning_content/tool id).\n- Mitigation added in host retry policy: treat iFlow business 514 model error as retryable so Virtual Router can fail over to next provider candidate.\n  - code: src/server/runtime/http-server/executor-provider.ts\n  - tests: tests/server/runtime/http-server/executor-provider.spec.ts + tests/server/runtime/executor-provider.retryable.spec.ts\n- Validation:\n  - npm run jest:run -- --runTestsByPath tests/server/runtime/http-server/executor-provider.spec.ts tests/server/runtime/executor-provider.retryable.spec.ts --runInBand âœ…\n  - npm run jest:run -- --runTestsByPath tests/server/runtime/request-executor.single-attempt.spec.ts tests/server/http-server/execute-pipeline-failover.spec.ts --runInBand âœ…\n  - npm run build:dev âœ… (includes install:global, mock regressions, blackbox parity)\n","status":"in_progress","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T10:45:54.313087+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T18:16:15.603201+08:00"}
{"id":"routecodex-71","title":"rcc release: quiet-by-default logs/snapshots with env overrides","description":"## Background\nNeed to guarantee `rcc` release mode is quiet by default: no automatic snapshot recording, reduced non-error logs, and opt-in controls via env vars.\n\n## Acceptance Criteria\n- [ ] Audit and document release vs dev behavior for snapshots/logging across host + provider paths.\n- [ ] In release mode, all snapshot writers default to no-op unless explicit env override enables them.\n- [ ] In release mode, routine info/debug logs are suppressed by default while errors still surface.\n- [ ] Existing env toggles continue to allow enabling snapshots/logging when needed.\n- [ ] Add/adjust regression coverage for release gating behavior where feasible.","notes":"Implemented release-mode quiet defaults + env overrides:\n- Snapshot gating hardening: src/providers/core/utils/snapshot-writer.ts (writeProviderRetrySnapshot/writeRepairFeedbackSnapshot/writeClientSnapshot now all respect runtimeFlags.snapshotsEnabled).\n- Pipeline/provider console noise gating: src/modules/pipeline/utils/debug-logger.ts (release defaults quiet; opt-in via ROUTECODEX_PIPELINE_LOG_VERBOSE or RCC_PIPELINE_LOG_VERBOSE).\n- Usage line gating: src/server/runtime/http-server/request-executor.ts (release defaults off; opt-in via ROUTECODEX_USAGE_LOG/RCC_USAGE_LOG).\n- Stats persistence + summary gating: src/server/runtime/http-server/stats-manager.ts (release defaults no auto stats recording/printing; opt-in via ROUTECODEX_STATS_ENABLED/RCC_STATS_ENABLED and ROUTECODEX_STATS_VERBOSE/RCC_STATS_VERBOSE).\n- Hub shadow compare default aligned: src/server/runtime/http-server/hub-shadow-compare.ts (dev on, release off; env override still works).\n\nVerification evidence:\n- npm run jest:run -- --runTestsByPath tests/providers/core/utils/snapshot-writer.release-gating.spec.ts tests/modules/pipeline/utils/debug-logger.release.spec.ts tests/server/runtime/http-server/stats-manager.release.spec.ts (PASS: 3 suites / 5 tests).\n- npm run install:global (PASS, includes build + global install + health/e2e check).\n- npm run build:dev executed; build chain progressed but failed later at verify-client-headers with unrelated dist module path issue: Cannot find module dist/providers/core/runtime/http-transport-provider.js imported by scripts/verify-client-headers.mjs.\n2026-02-07: è°ƒæ•´ Unified Hub shadow compare é»˜è®¤å¼€å…³ï¼šé»˜è®¤ä»…åœ¨ rccx åŒ…å¼€å¯ï¼Œå…¶å®ƒåŒ…ï¼ˆroutecodex/rccï¼‰é»˜è®¤å…³é—­ï¼Œä»ä¿ç•™ env è¦†ç›–ã€‚å®ç°: src/server/runtime/http-server/hub-shadow-compare.tsï¼ˆæ ¹æ® ROUTECODEX_PACKAGE_NAME / npm_package_name / runtime package.json è§£æåŒ…åï¼‰ã€‚æ–°å¢å›å½’: tests/server/runtime/http-server/hub-shadow-compare-config.spec.tsã€‚éªŒè¯: npm run jest:run -- --runTestsByPath tests/server/runtime/http-server/hub-shadow-compare-config.spec.ts tests/unified-hub/shadow-runtime-compare.errorsamples.spec.tsï¼›ROUTECODEX_SKIP_AUTO_BUMP=1 BUILD_MODE=dev npm run buildã€‚\n2026-02-07 (follow-up): stage-level runtime logs now default to concise mode even in dev.  keeps response/servertool info and all errors, suppresses provider/hub/request info spam unless verbose env is enabled (ROUTECODEX_STAGE_LOG_VERBOSE/RCC_STAGE_LOG_VERBOSE or PIPELINE_LOG_VERBOSE). Added regression: tests/server/utils/stage-logger.spec.ts (provider suppressed by default, response id-only, errors always shown, verbose override restores provider detail).\n2026-02-07 correction: stage logger change is implemented in src/server/utils/stage-logger.ts via logPipelineStage filtering.\n2026-02-07 (provider-noise): suppress provider request start/success and provider module info logs by default in dev; keep provider errors visible; add opt-in env ROUTECODEX_PROVIDER_LOG_VERBOSE/RCC_PROVIDER_LOG_VERBOSE. Added regression tests in tests/modules/pipeline/utils/debug-logger.dev-filter.spec.ts.","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T11:50:02.376241+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T12:47:03.549343+08:00","closed_at":"2026-02-07T12:03:59.239292+08:00"}
{"id":"routecodex-72","title":"fix verify-client-headers dist import path","description":"## Background\n`npm run build:dev` currently fails during `verify-client-headers` due to missing dist import: `dist/providers/core/runtime/http-transport-provider.js`.\n\n## Acceptance Criteria\n- [ ] Reproduce failure and identify root cause (script path vs emitted dist layout).\n- [ ] Fix `scripts/verify-client-headers.mjs` to resolve the provider module reliably in both dev/release build outputs.\n- [ ] Keep behavior unchanged for header verification assertions.\n- [ ] Verify with targeted command and confirm `npm run build:dev` proceeds past `verify-client-headers` stage (or provide concrete evidence if blocked later by unrelated checks).","notes":"Root cause / hardening:\n- `scripts/verify-client-headers.mjs` previously imported a single fixed dist path (`dist/providers/core/runtime/http-transport-provider.js`).\n- Added robust candidate loading for dist module paths with existence checks and clearer aggregated error output, so verification tolerates `.js/.mjs/index.js` layout variations for both runtime modules.\n\nCode change:\n- scripts/verify-client-headers.mjs\n  - `loadModule()` now accepts candidate paths and tries each via `fs.access` + dynamic import.\n  - `HttpTransportProvider` and `provider-runtime-metadata` imports now use candidate lists.\n\nVerification evidence:\n- npm run verify:e2e-toolcall âœ… (includes `node scripts/verify-client-headers.mjs`; both header assertions passed).\n- npm run build:dev attempted; blocked early by repo-sanity due pre-existing untracked file not related to this fix: `tests/server/runtime/http-server/hub-shadow-compare-config.spec.ts`.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T12:10:49.99935+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T12:15:03.091596+08:00","closed_at":"2026-02-07T12:15:03.091596+08:00","close_reason":"Hardened verify-client-headers module loading with dist path fallbacks and validated verification flow"}
{"id":"routecodex-73","title":"Host+sharedmodule æ¶æ„é‡æ•´ï¼šå®‰å…¨æ¸è¿›åˆ‡æ¢æ–¹æ¡ˆ","description":"åŸºäºç°çŠ¶æ¶æ„ï¼Œè®¾è®¡å¹¶è½åœ°å®‰å…¨é€æ­¥åˆ‡æ¢æ–¹æ¡ˆï¼Œç¡®ä¿é›¶ä¸­æ–­ã€å¯å›æ»šã€å¯è§‚æµ‹ã€‚","acceptance_criteria":"1) æä¾› host/sharedmodule åŒè½¨è¿ç§»é˜¶æ®µå›¾ï¼ˆå«å¼€å…³ã€å…¥å£ã€fallbackï¼‰ï¼›2) æ¯é˜¶æ®µå®šä¹‰å¯è§‚æµ‹æŒ‡æ ‡ã€ç°åº¦ç­–ç•¥ã€å›æ»šåŠ¨ä½œï¼›3) æ˜ç¡® app/block/control-bus/ws çš„è½åœ°é¡ºåºä¸å…¼å®¹è¾¹ç•Œï¼›4) åŒ…å« dev/release å·®å¼‚ä¸éªŒè¯æ¸…å•ï¼›5) æ–¹æ¡ˆæ–‡æ¡£è½ç›˜åˆ° docs/refactoring å¹¶å¯å®¡é˜…æ‰§è¡Œ","notes":"Started safe migration planning for host+sharedmodule. Drafting phased rollout with feature switches, canary, rollback, observability gates.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T12:36:05.761253+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T12:37:25.778505+08:00","closed_at":"2026-02-07T12:37:25.778505+08:00","close_reason":"Completed architecture safe-switch plan doc with phased migration/rollback matrix","labels":["architecture","migration","safety"]}
{"id":"routecodex-74","title":"å‡†å¤‡ npm å‘å¸ƒåŒ…ï¼šå…ˆ llms å rcc","description":"æŒ‰å‘å¸ƒé¡ºåºå‡†å¤‡ llms ä¸ rcc çš„ npm åŒ…ï¼Œå…ˆæœ¬åœ°æ‰“åŒ…éªŒè¯ï¼Œå†ç»™å‡ºå‘å¸ƒæ­¥éª¤ã€‚","acceptance_criteria":"1) äº§å‡º @jsonstudio/llms å¯å‘å¸ƒ tarballï¼›2) äº§å‡º @jsonstudio/rcc å¯å‘å¸ƒ tarballï¼›3) è®°å½•ç‰ˆæœ¬ã€sha512ã€æ–‡ä»¶åä¸å‘å¸ƒå‘½ä»¤ï¼›4) ä¸æäº¤ dist/ä¸´æ—¶æ–‡ä»¶/æ•æ„Ÿä¿¡æ¯","notes":"Built llms in sharedmodule and packed tarball: /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core/jsonstudio-llms-0.6.1725.tgz (sha1=38e68a3fd6109c89a6a7b78ffaad49bb80a6390d). Packed rcc with local llms tgz override: jsonstudio-rcc-0.89.1800.tgz (sha1=ae43b8a8616a73b022928641242dbb68a41d3bb6).","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T12:43:19.842468+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T12:46:40.949363+08:00","closed_at":"2026-02-07T12:46:40.949363+08:00","close_reason":"Prepared llms+rcc npm tarballs with checksums and release-ready commands","labels":["npm","packaging","release"]}
{"id":"routecodex-75","title":"Migration: npm release gate after iflow 400 fix verification","description":"ç®¡ç†ä¸‹ä¸€æ­¥å‘å¸ƒè¿ç§»ï¼šç­‰å¾… iflow 400 é—®é¢˜ä¿®å¤éªŒè¯é€šè¿‡åï¼Œå†æŒ‰ llms -\u003e rcc é¡ºåºå‘å¸ƒ npmã€‚","acceptance_criteria":"1) å®šä¹‰ llms-\u003ercc çš„å‘å¸ƒè¿ç§» gateï¼›2) gate åŒ…å« iflow 400 same-shape/control replay é€šè¿‡è¯æ®ï¼›3) ç”¨æˆ·æ‰‹å·¥éªŒè¯é€šè¿‡åå†æ‰§è¡Œ publishï¼›4) å‘å¸ƒæ¸…å•åŒ…å«å›æ»šæ­¥éª¤","notes":"2026-02-07 llms release package prepared:\\n- Build: cd sharedmodule/llmswitch-core \u0026\u0026 npm run build:ci âœ…\\n- Pack: npm pack --json --pack-destination /tmp âœ…\\n- Artifact: /tmp/jsonstudio-llms-0.6.1733.tgz\\n- Metadata: name=@jsonstudio/llms version=0.6.1733 size=635672 unpackedSize=2906446 shasum=88f84c48ed612f840982c56dbafe285d141a6dd2\\n- SHA256: ae1c556ec4d2fc188eb24354c9279df10e0555af72892c765c40c6d8b9e727ae\\n- Release guard: no new matched release tags created yet on both repos (routecodex + sharedmodule), so this step only prepares tarball and does not publish.\n2026-02-07 rc tag + rcc package preparation completed:\\n- sharedmodule commit: 067a98e (pushed main)\\n- routecodex commits: 85caad434 (llms dependency bump), ac40a38e3 (rcc tarball prep/version bump) (pushed main)\\n- matching tags created \u0026 pushed on BOTH repos:\\n  rc-v0.6.1733-v0.89.1798\\n  rc-v0.6.1733-v0.89.1799\\n- rcc dependency updated in routecodex/package.json: @jsonstudio/llms -\u003e 0.6.1733\\n- rcc release tarball built with local llms tgz:\\n  npm run pack:rcc -- --llms-tgz /tmp/jsonstudio-llms-0.6.1733.tgz --llms-version 0.6.1733\\n  artifact: /Users/fanzhang/Documents/github/routecodex/jsonstudio-rcc-0.89.1799.tgz\\n  sha256: 5c33d2faef65d3b5480189eac9c5ff96e67962786692641c30ab35d0e8ffc337\\n  npm pack metadata: @jsonstudio/rcc@0.89.1799 shasum=381a023c1c5e76060f5a50ded56c30d0fedee7dd\\n- llms tarball remains:\\n  /tmp/jsonstudio-llms-0.6.1733.tgz\\n  sha256: ae1c556ec4d2fc188eb24354c9279df10e0555af72892c765c40c6d8b9e727ae\\n- note: pack step printed npm auth warning (token expired/revoked) but packing succeeded; publish step still pending manual trigger.","status":"in_progress","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T13:24:05.577112+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T14:02:31.4799+08:00","labels":["gate","migration","release"],"dependencies":[{"issue_id":"routecodex-75","depends_on_id":"routecodex-70","type":"blocks","created_at":"2026-02-07T13:59:44.010491+08:00","created_by":"import"}]}
{"id":"routecodex-76","title":"Default stage log hide SSE + bootstrap missing oauth token file","description":"Ensure dev default logs show request/servertool and suppress response SSE/dispatch noise; ensure missing configured OAuth token file is auto-created at configured path.\n\nAcceptance Criteria\n- Default stage logger does not emit response.sse.* or response.dispatch.* lines.\n- request.* stage logs remain visible by default.\n- When configured tokenFile path is missing, auth layer bootstraps an empty JSON token file at that path.\n- Add regression tests for stage logger visibility and oauth token file bootstrap.","notes":"Implemented:\n- src/server/utils/stage-logger.ts: default scope filter keeps request/servertool and suppresses response.sse.*\n- src/providers/auth/tokenfile-auth.ts: when config.tokenFile target is missing, auto-create placeholder token file at config-resolved path\n- src/providers/auth/oauth-auth.ts: BaseOAuthClient initialize/loadToken now ensure configured token file exists\nTests:\n- tests/server/utils/stage-logger.spec.ts\n- tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts\n- tests/providers/auth/oauth-auth.bootstrap-tokenfile.spec.ts\nValidation:\n- npm run jest:run -- --runTestsByPath tests/server/utils/stage-logger.spec.ts tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts tests/providers/auth/oauth-auth.bootstrap-tokenfile.spec.ts\n- ROUTECODEX_SKIP_AUTO_BUMP=1 npm run install:global (passed)","status":"in_progress","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T14:23:51.094893+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T14:24:10.717328+08:00"}
{"id":"routecodex-77","title":"StopMessage å¤šé˜¶æ®µçŠ¶æ€æœºé˜²å¾ªç¯è®¾è®¡","description":"ç›®æ ‡ï¼šå°† stopMessage ä»å•ä¸€é€šç”¨ followup æ–‡æ¡ˆæ”¹ä¸ºåˆ†é˜¶æ®µçŠ¶æ€æœºï¼ˆstage-basedï¼‰å¾ªç¯ï¼Œé™ä½â€œåå¤å¾ªç¯/å¥—è¯â€é£é™©ï¼ŒåŒæ—¶ä¿æŒå¯ç»ˆæ­¢ä¸å¯è§‚æµ‹ã€‚\n\nAcceptance Criteria\n- AC1: åŸºäºç°æœ‰ codex-samples ä¸å®ç°ï¼Œæ˜ç¡®å½“å‰å¾ªç¯è§¦å‘æ¨¡å¼ä¸è¯¯è§£æ¥æºï¼ˆè¯æ®åŒ–ï¼‰ã€‚\n- AC2: ç»™å‡ºå¤šé˜¶æ®µ stopMessage çŠ¶æ€æœºè®¾è®¡ï¼ˆè‡³å°‘å«é˜¶æ®µå®šä¹‰ã€è½¬ç§»æ¡ä»¶ã€é€€å‡ºæ¡ä»¶ã€è®¡æ•°è§„åˆ™ï¼‰ã€‚\n- AC3: è®¾è®¡éœ€å…¼å®¹ç°æœ‰ stopMessageUsed/maxRepeats ä¸ sticky stateï¼Œä¸å¼•å…¥è·¨å±‚é‡å¤é€»è¾‘ã€‚\n- AC4: ç»™å‡ºæœ€å°å®ç°è·¯å¾„ä¸å›å½’æµ‹è¯•æ–¹æ¡ˆï¼ˆä¸å…ˆæ”¹ provider/router è¯­ä¹‰ï¼‰ã€‚","notes":"å½“å‰ç°çŠ¶æ€»ç»“ï¼ˆæ ·æœ¬+ä»£ç ï¼‰ï¼š\n1) ~/.routecodex/stopMessage/message1.md ä¸ message2.md å†…å®¹å®Œå…¨ç›¸åŒï¼Œå½“å‰å¹¶æ— â€œåˆ†é˜¶æ®µæç¤ºâ€å·®å¼‚ã€‚\n2) stop_message_auto å½“å‰ followup åª append åŒä¸€ stopMessageTextï¼ˆsharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.tsï¼‰ï¼ŒæœªæŒ‰çŠ¶æ€åˆ‡æ¢æç¤ºè¯ã€‚\n3) æ ·æœ¬è¯æ®ï¼šopenai-responses-iflow.2-173...20260207T143853619-230_stop_followup ä¸­ req_process_tool_filters_request_finalize.json æ˜¾ç¤º messages=746ï¼Œä¸”å°¾éƒ¨ä»åå¤â€œassistant(tool_calls)-\u003etoolâ€å¾ªç¯ï¼›client-request.json ä¸­ stopMessageState æ˜¾ç¤º stopMessageMaxRepeats=3 ä½† stopMessageUsed=0ï¼Œå­˜åœ¨é‡å¤ re-arm/è¯¯è§£é£é™©ã€‚\n4) ç»“è®ºï¼šéœ€è¦â€œé˜¶æ®µåŒ–æç¤º+å¾ªç¯æ¢æµ‹+äºŒæ¬¡è§‚æµ‹ååœæœºâ€æœºåˆ¶ï¼Œä¸èƒ½å†é å•æ¡é€šç”¨æ–‡æ¡ˆã€‚\n\\nå®ç°ä¸éªŒè¯ï¼ˆ2026-02-07ï¼‰ï¼š\\n- llmswitch-core æ–°å¢ stopMessage åˆ†é˜¶æ®µç­–ç•¥æ¨¡å—ï¼šsrc/servertool/handlers/stop-message-stage-policy.ts\\n  - é˜¶æ®µA: status_probeï¼ˆå…ˆæŸ¥ bd çŠ¶æ€ï¼‰\\n  - é˜¶æ®µB: loop_self_checkï¼ˆæ£€æµ‹å¾ªç¯å¹¶å°è¯•è·³å‡ºï¼‰\\n  - è¿ç»­åŒè§‚æµ‹ \u003e=2 æ¬¡è‡ªåŠ¨åœæ­¢ followupï¼›bd çŠ¶æ€åˆ¤å®š idle æ—¶ç›´æ¥åœæ­¢\\n  - é€šè¿‡ ROUTECODEX_STOPMESSAGE_STAGE_MODE æ§åˆ¶ï¼ˆon/off/autoï¼›é»˜è®¤ offï¼Œé¿å…å½±å“ç°æœ‰è¡Œä¸ºï¼‰\\n- stopMessage çŠ¶æ€æ‰©å±•å¹¶æŒä¹…åŒ–ï¼š\\n  - src/router/virtual-router/routing-instructions.ts\\n  - src/router/virtual-router/stop-message-state-sync.ts\\n  - src/router/virtual-router/types.ts\\n  - src/router/virtual-router/engine.ts\\n  - src/servertool/handlers/stop-message-auto.ts\\n- å›å½’æµ‹è¯•ï¼š\\n  - tests/servertool/stop-message-auto.spec.ts æ–°å¢ staged åœºæ™¯ï¼ˆé˜¶æ®µæ¨¡æ¿å‘½ä¸­ + é‡å¤è§‚æµ‹åœæ­¢ï¼‰\\n  - tests/servertool/routing-instructions.spec.ts æ–°å¢ staged å…ƒæ•°æ®åºåˆ—åŒ–å›å½’\\n- æœ¬åœ° stage message æ–‡ä»¶å·²åˆ›å»ºï¼š\\n  - ~/.routecodex/stopMessage/stage-status-check.md\\n  - ~/.routecodex/stopMessage/stage-loop-self-check.md\\n  - ~/.routecodex/stopMessage/stage-stop.md\\n- éªŒè¯å‘½ä»¤ï¼š\\n  - npm run jest:run -- --runTestsByPath tests/servertool/routing-instructions.spec.ts tests/servertool/stop-message-auto.spec.ts\\n  - ROUTECODEX_STOPMESSAGE_STAGE_MODE=off npm -C /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core run build\\n  - ROUTECODEX_STOPMESSAGE_STAGE_MODE=off npm run build:min\\n  - ROUTECODEX_STOPMESSAGE_STAGE_MODE=off npm run install:global\\n","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T14:46:36.053068+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T15:24:26.646554+08:00","closed_at":"2026-02-07T15:15:00.060299+08:00"}
{"id":"routecodex-78","title":"Release prep: dual-repo tag kimi2.5 rc1 + npm tarballs","description":"Prepare sharedmodule and routecodex release-candidate artifacts for kimi2.5 rc1 without publishing yet.","acceptance_criteria":"- sharedmodule and routecodex both pass required build checks.\\n- Generate release tarball for @jsonstudio/rcc via pack-mode.\\n- Create matching dual-repo rc tag for llms + rcc versions (kimi2.5 rc1).\\n- Push branch + tag; no temp/build/sensitive files committed.","notes":"Release prep evidence (2026-02-07):\\n- sharedmodule build passed: npm --prefix /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core run build\\n- routecodex build/dev+install passed: npm --prefix /Users/fanzhang/Documents/github/routecodex run build:dev\\n- tarballs generated:\\n  - /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core/jsonstudio-llms-0.6.1739.tgz\\n  - /Users/fanzhang/Documents/github/routecodex/jsonstudio-rcc-0.89.1802.tgz\\n- rcc tarball verified dependency: @jsonstudio/llms=0.6.1739\\n- dual-repo commits pushed:\\n  - routecodex main: 78d178541\\n  - sharedmodule main: e1d30db\\n- dual-repo tag pushed: rc-v0.6.1739-v0.89.1802-kimi2.5-rc1","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T14:46:41.479151+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T14:54:43.80646+08:00","closed_at":"2026-02-07T14:54:30.425845+08:00","labels":["kimi2.5","release"]}
{"id":"routecodex-79","title":"Release: bump rcc llms dependency after llms publish","description":"Now that @jsonstudio/llms is published, update routecodex/rcc dependency to published version and regenerate rcc tarball for publish.","acceptance_criteria":"- package.json and package-lock.json use published @jsonstudio/llms version.\\n- rcc tarball regenerated and verified to include the same llms dependency.\\n- changes committed and pushed.","notes":"Evidence (2026-02-07):\\n- Confirmed llms published: npm view @jsonstudio/llms@0.6.1739 version =\u003e 0.6.1739\\n- Updated routecodex dependency to @jsonstudio/llms=0.6.1739 (package.json + package-lock.json)\\n- Repacked rcc tarball: /Users/fanzhang/Documents/github/routecodex/jsonstudio-rcc-0.89.1802.tgz\\n- Verified tarball internal package.json dependency @jsonstudio/llms=0.6.1739","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T14:57:31.750538+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T14:59:00.30818+08:00","closed_at":"2026-02-07T14:59:00.30818+08:00","close_reason":"rcc dependency aligned to published llms and tarball re-generated","labels":["llms","rcc","release"]}
{"id":"routecodex-8","title":"Qwen OAuth ç™»å½•å token ä¸ç”Ÿæ•ˆï¼ˆtokenFile è§£æ/è¯»å–ï¼‰","description":"## Problem\nQwen OAuth è®¤è¯æˆåŠŸåï¼Œåç»­è¯·æ±‚ä»æç¤ºæœªè®¤è¯/éœ€è¦é‡æ–°ç™»å½•ï¼›æ€€ç–‘ token å·²å†™å…¥ä½†è¿è¡Œæ—¶è¯»å–ä¸åˆ°æˆ– tokenFile alias è§£æä¸ä¸€è‡´ã€‚\n\n## Suspected Root Cause\n- daemon-admin / oauth-lifecycle æ”¯æŒ tokenFile=aliasï¼ˆä¾‹å¦‚ defaultï¼‰ï¼Œä¼šå†™å…¥ ~/.routecodex/auth/qwen-oauth-\u003cseq\u003e-\u003calias\u003e.json\n- TokenFileAuthProvider å°† tokenFile=alias å½“ä½œè·¯å¾„å¤„ç†ï¼Œä¸”æ—  tokenFile æ—¶é»˜è®¤åªæ‰¾ ~/.routecodex/tokens/qwen-default.jsonï¼Œå¯¼è‡´æ‰¾ä¸åˆ°åˆšå†™å…¥çš„ auth ç›®å½• token\n\n## Acceptance Criteria\n- TokenFileAuthProvider æ”¯æŒ tokenFile=aliasï¼ˆä¸ oauth-lifecycle ä¸€è‡´ï¼‰ï¼Œå¯è¯»å– ~/.routecodex/auth/qwen-oauth-\u003cseq\u003e-\u003calias\u003e.jsonï¼ˆä¼˜å…ˆæœ€æ–° seqï¼‰\n- TokenFileAuthProvider æ—  tokenFile æ—¶ï¼Œä¼˜å…ˆè¯»å– ~/.routecodex/auth/qwen-oauth.json åŠ auth ç›®å½•ä¸‹ qwen-oauth-*.jsonï¼ˆå…¼å®¹ daemon oauth æˆæƒï¼‰\n- å¢åŠ  Jest å›å½’æµ‹è¯•è¦†ç›–ä¸Šè¿°è¡Œä¸º","notes":"Root cause confirmed: daemon-admin/oauth-lifecycle persists Qwen OAuth tokens under ~/.routecodex/auth/qwen-oauth-\u003cseq\u003e-\u003calias\u003e.json (or alias-based), but TokenFileAuthProvider treated tokenFile=alias as a path and (when tokenFile missing) only searched ~/.routecodex/tokens/qwen-default.json / ~/.cli-proxy-api, so it never found the saved token.\n\nFix:\n- TokenFileAuthProvider now supports tokenFile=alias (no / and no .json) -\u003e resolves to latest seq file in auth dir for that alias.\n- For qwen, if tokenFile points to legacy ~/.routecodex/auth/qwen-oauth.json but file missing, fall back to latest qwen-oauth-*.json.\n- For qwen with no tokenFile, prefer ~/.routecodex/auth/qwen-oauth.json then latest qwen-oauth-*.json.\n\nEvidence:\n- Jest: npm run jest:run -- --runTestsByPath tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts\n- dist sanity: node -e \"import { TokenFileAuthProvider } from \"./dist/providers/auth/tokenfile-auth.js\"; ...\" now shows isValid=true for tokenFile=default and builds Authorization header.","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T10:59:56.937277+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T11:25:46.326772+08:00","closed_at":"2026-02-04T11:25:46.326772+08:00","close_reason":"TokenFileAuthProvider æ”¯æŒ qwen tokenFile alias å¹¶æ‰«æ ~/.routecodex/authï¼Œä¿®å¤ç™»å½•åä¸ç”Ÿæ•ˆ","labels":["auth","bug","qwen"]}
{"id":"routecodex-80","title":"Bug: stop_followup nested/loop after timeout on longcontext","description":"In /v1/responses longcontext route, when a previous request times out, stop_message_flow followup logs show repeated completion for same requestId(:stop_followup). Must prevent nested/looped followup orchestration and duplicate completion emissions.","acceptance_criteria":"- Same requestId may execute stop_message_flow at most once per followup attempt.\\n- No repeated progress 5/5 completion spam for a single requestId.\\n- Timeout on prior request does not trigger nested followup loop in next request path.\\n- Add regression test for timeout + followup reentry guard.","notes":"Fix implemented (2026-02-07):\\n- Root cause: stop_message_flow could re-trigger inside followup hops, causing nested stop_followup chains and repeated completion logs.\\n- Behavior aligned: once stopMessage followup request is emitted, that cycle ends; followup response is treated as a new response and must not retrigger stop_message_flow in same nested hop.\\n- Code: sharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.ts (serverToolFollowup=true =\u003e skip).\\n- Validation: npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts (pass).\\n- Windows install fix: replace chmod-based postbuild/postinstall with node scripts/ensure-cli-executable.mjs (skip chmod on win32).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T15:01:23.33139+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T15:29:11.945138+08:00","closed_at":"2026-02-07T15:24:39.968156+08:00","labels":["followup","longcontext","servertool"]}
{"id":"routecodex-81","title":"Release: tag and prepare llms npm package","description":"Prepare @jsonstudio/llms release artifact and create matching dual-repo tag before publish.","acceptance_criteria":"- sharedmodule build passes and llms tarball is generated.\\n- matching tag created on both routecodex and sharedmodule repos.\\n- all related commits/tags pushed, with publish command ready.","notes":"Verification:\n- sharedmodule build passed via `npm run build` (matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770449828659.json).\n- targeted regression passed: `node scripts/tests/stop-message-followup-iflow-trim.mjs`.\n- tarball generated: /Users/fanzhang/Documents/github/sharedmodule/llmswitch-core/jsonstudio-llms-0.6.1749.tgz.\nRelease refs:\n- llms commits: 8584bdd, 143e869 (pushed to main).\n- routecodex commit: eae9dafff (pushed to main).\n- matching tag pushed on both repos: rc-v0.6.1749-v0.89.1803-kimi2.5-rc1.","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T15:32:19.904937+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T15:43:35.815146+08:00","closed_at":"2026-02-07T15:40:06.83737+08:00","labels":["llms","release"]}
{"id":"routecodex-82","title":"Release: update rcc llms dependency and pack tarball","description":"Align rcc release dependency to latest published @jsonstudio/llms and produce publish-ready @jsonstudio/rcc tarball.","acceptance_criteria":"- package dependency points to the new llms version.\n- release build+pack succeeds and tarball is generated.\n- publish command is ready with artifact path.","notes":"Evidence:\n- Updated dependency: `@jsonstudio/llms` 0.6.1739 -\u003e 0.6.1749 in package.json/package-lock.json.\n- Built and packed release tarball with override: `RCC_LLMS_VERSION=0.6.1749 npm run pack:rcc`.\n- Generated artifact: /Users/fanzhang/Documents/github/routecodex/jsonstudio-rcc-0.89.1805.tgz.\n- Verified tarball metadata: name=@jsonstudio/rcc, version=0.89.1805, dependency @jsonstudio/llms=0.6.1749.\n- Commit pushed: b0b0874a4 (main).","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T15:41:21.106032+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T15:44:18.107024+08:00","closed_at":"2026-02-07T15:43:54.482138+08:00"}
{"id":"routecodex-83","title":"stopMessage stage-mode via instruction + routing-instructions skeleton split","description":"Scope:\n- stopMessage stage-mode must be controlled by \u003c**stopMessage...**\u003e instruction, not only env default.\n- stage policy should read persisted/session state mode consistently.\n- split large sharedmodule routing-instructions.ts into skeleton + modular helpers (parser/codec/actions).\n\nAcceptance Criteria:\nAC1: support mode tokens in instruction syntax (e.g. stopMessage:mode=on/off/auto, stopMessage:\"...\",N,mode=on).\nAC2: stop_message_auto snapshot/state include stopMessageStageMode end-to-end.\nAC3: routing-instructions.ts is reduced by extracting stopMessage-specific parser/codec/actions into dedicated modules without behavior regression.\nAC4: add regressions covering mode parse/apply/serialize and stage policy mode-on/off behavior.\nAC5: run sharedmodule build + routecodex build:dev + install:global and record evidence.","notes":"Implemented in sharedmodule commit 9c636c7 (pushed main):\n- stopMessage stage-mode now parsed from instruction syntax: mode-only (`stopMessage:mode=on|off|auto`) and set-tail (`stopMessage:\"...\",N,mode=...`).\n- stop_message_auto snapshot/state now carries stopMessageStageMode end-to-end (fallback snapshot/create/clear).\n- stage policy resolves mode from persisted state first; env remains fallback with default auto.\n- routing-instructions.ts refactored into skeleton + modules:\n  - src/router/virtual-router/routing-stop-message-parser.ts\n  - src/router/virtual-router/routing-stop-message-actions.ts\n  - src/router/virtual-router/routing-stop-message-state-codec.ts\n- added regression script + matrix hook: scripts/tests/stop-message-stage-mode-routing.mjs\n\nVerification evidence:\n1) sharedmodule `npm run build` passed (matrix included new case `matrix:stop-message-stage-mode-routing`).\n   report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770450948016.json\n2) routecodex `npm run build:dev` passed (includes install:global and verification stack).\n3) routecodex `npm run install:global` passed; global CLI health/e2e check passed.","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T15:47:25.797243+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T15:59:45.760749+08:00","closed_at":"2026-02-07T15:59:11.673195+08:00"}
{"id":"routecodex-84","title":"stopMessage switch activation validation and clear semantics","description":"Scope:\n- stopMessage should support simple on/off switch activation.\n- activation via switch must validate stage message files completeness before enabling.\n- clear command clears all stopMessage state; switch off can be used to disable/clear active stopMessage flow.\n\nAcceptance Criteria:\nAC1: stopMessage mode=on (or stopMessage:on) validates required stage templates and fails fast when missing.\nAC2: mode off disables stopMessage followup behavior and can clear active stopMessage payload state.\nAC3: stopMessage:clear clears all persisted stopMessage fields.\nAC4: add regression for mode parse/apply and activation validation.\nAC5: sharedmodule build(matrix) + routecodex build:dev + install:global pass.","notes":"Implemented (sharedmodule commit 4ba78fc, pushed main):\n- Added strict template validation for stopMessage switch activation in virtual-router engine:\n  mode=on now validates required stage message files (status/active/loop) before activation.\n  Missing/invalid files fail fast with CONFIG_ERROR.\n- Added reusable template loader/validator module:\n  src/router/virtual-router/stop-message-stage-template-files.ts\n- Updated stage policy semantics:\n  mode=off now returns stop decision (`stopReason: mode_off`) to disable followup flow.\n- Updated stopMessage mode actions:\n  stopMessage:off clears active stopMessage payload state while keeping mode marker off;\n  stopMessage:clear clears all stopMessage state.\n- Added regressions:\n  scripts/tests/stop-message-stage-mode-routing.mjs (off/clear semantics)\n  scripts/tests/stop-message-stage-activation-validation.mjs (mode=on completeness gate)\n  matrix hook in scripts/tests/run-matrix-ci.mjs\n- Host test alignment:\n  tests/servertool/stop-message-auto.spec.ts default stage mode set to auto (off now intentionally disables flow).\n\nVerification:\n1) sharedmodule npm run build âœ… (matrix includes new stage-activation validation).\n   report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770451851911.json\n2) routecodex targeted: npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts âœ…\n3) routecodex full: npm run build:dev âœ… (includes install:global + verification stack)\n4) routecodex global install: via build:dev and standalone install:global both passed.","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T16:11:10.699186+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T16:15:48.256736+08:00","closed_at":"2026-02-07T16:15:48.256736+08:00","close_reason":"switch activation gating + clear semantics + regressions validated"}
{"id":"routecodex-85","title":"stopMessage marker stripping and re-arm after off","description":"Fix two regressions: (1) routing markers like \u003c**stopMessage...**\u003e remain in forwarded history when instruction is not parsed from latest user message; (2) after mode=off, a new stopMessage set without explicit mode does not re-arm followup execution.","acceptance_criteria":"- Markers are stripped from forwarded request messages whenever any routing marker exists in history, regardless of whether instruction is effective\\n- After stopMessage mode=off, sending a new \u003c**stopMessage:...**\u003e without explicit mode reactivates to on\\n- Add regression coverage for both behaviors\\n- sharedmodule build passes; routecodex build:dev and install:global pass","notes":"Implemented in sharedmodule commit e8dc63e (pushed main):\\n- Fix marker stripping trigger in VirtualRouterEngine: clean routing markers when any marker exists in user history (not only when parsed instruction list is non-empty).\\n- Fix re-arm semantics after mode=off: stopMessage set without explicit mode now defaults to on when current mode is off (engine resolver + routing-stop-message-actions).\\n- Added regression script: scripts/tests/stop-message-marker-clean-and-reactivate.mjs\\n- Updated existing regression expectations in scripts/tests/stop-message-stage-mode-routing.mjs and matrix hook in scripts/tests/run-matrix-ci.mjs.\\n\\nVerification evidence:\\n1) sharedmodule: npm run build âœ… (matrix includes new case ).\\n   report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770454024823.json\\n2) routecodex: npm run build:dev âœ… (includes install:global + full verification stack).\nè¡¥å……ï¼šsharedmodule matrix æ–°å¢å¹¶é€šè¿‡ case: matrix:stop-message-marker-clean-and-reactivateã€‚","status":"closed","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T16:43:32.354467+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T16:50:39.31795+08:00","closed_at":"2026-02-07T16:50:39.31795+08:00","close_reason":"fixed in sharedmodule e8dc63e; build+matrix+host verification passed"}
{"id":"routecodex-86","title":"stopMessage default repeats=10 and on-shorthand with trailing text","description":"Align stopMessage syntax with operator expectation:\n- `\u003c**stopMessage:on**\u003eç»§ç»­` should be actionable (set text from trailing content)\n- default repeats should be 10 when omitted in explicit set syntax\n","acceptance_criteria":"- `\u003c**stopMessage:on**\u003eç»§ç»­` parsed on latest user message as actionable stopMessage set (text=ç»§ç»­, mode=on)\n- Optional repeats supported in shorthand (`\u003c**stopMessage:on,3**\u003eç»§ç»­`)\n- Explicit set default repeat changes from 1 to 10 (`\u003c**stopMessage:\"ç»§ç»­\"**\u003e`)\n- Add/adjust regression coverage\n- sharedmodule build(matrix) + routecodex build:dev pass","notes":"Implemented in sharedmodule (local changes pending commit):\n- stopMessage parser default maxRepeats changed to 10 when omitted in explicit set syntax (`\u003c**stopMessage:\"...\"**\u003e` and file:// ref).\n- Added mode shorthand conversion in routing parser: `\u003c**stopMessage:on**\u003eç»§ç»­` and `\u003c**stopMessage:on,3**\u003eç»§ç»­` now become actionable stopMessageSet on latest user message, while preserving history replay guard.\n- Added new sharedmodule regression script: scripts/tests/stop-message-shorthand-parse.mjs and matrix hook.\n- Updated routecodex routing-instructions spec expectations and shorthand cases.\n- Updated docs: docs/stop-message-auto.md, docs/routing-instructions.md.\n\nVerification:\n1) sharedmodule npm run build âœ… (matrix passed, includes matrix:stop-message-shorthand-parse).\n   report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770455771406.json\n2) routecodex npm run build:dev âœ… (includes full verification stack and install:global).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T17:08:24.524466+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T17:19:23.594848+08:00","closed_at":"2026-02-07T17:19:23.594848+08:00","close_reason":"implemented shorthand parse + default repeats=10 with regressions and full build verification"}
{"id":"routecodex-87","title":"ServerTool: no-op keep-working auto-followup","description":"Add a no-op servertool for assistant status-report/summarization pauses. Tool should do nothing, mark executed, and automatically trigger followup so task execution continues without interruption.","acceptance_criteria":"- Tool appears in server tool list with clear \"do nothing + continue\" semantics.\n- Invoking tool triggers followup request with no payload side-effects.\n- Followup keeps tool list available.\n- Regression test covers the no-op tool flow on /v1/responses.","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T17:19:53.530936+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T17:19:59.356763+08:00"}
{"id":"routecodex-88","title":"stopMessage syntax correction: tag-only control, outside text untouched","description":"Correct semantics after previous shorthand implementation drift:  should treat tag content as control syntax only; trailing text remains normal user message and must not be captured as stopMessage text.","acceptance_criteria":"- Parser does not convert stopMessage:on trailing text into stopMessageSet\\n- Existing latest-message-only guard remains\\n- Default max repeats without explicit N remains 10 for explicit stopMessage set syntax\\n- Regressions/docs updated and builds pass","notes":"Semantics correction scope:\n- `\u003c**stopMessage:on**\u003eç»§ç»­` keeps `ç»§ç»­` as normal user message.\n- Only instruction inside `\u003c**...**\u003e` is parsed as routing command.\n- No shorthand conversion from mode to stopMessageSet.\nImplemented:\n- Corrected stopMessage parsing semantics: only content inside `\u003c**...**\u003e` is treated as routing syntax.\n- Removed shorthand conversion that previously turned `\u003c**stopMessage:on**\u003eç»§ç»­` into stopMessageSet.\n- Kept default max repeats 10 for explicit stopMessage set syntax without N.\n- Updated docs and host-side routing instruction tests.\n\nVerification:\n1) sharedmodule npm run build âœ… (matrix passed; report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770456436800.json)\n2) routecodex npm run build:dev âœ… (includes install:global + verification stack)","status":"closed","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T17:29:26.3601+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T17:31:22.102565+08:00","closed_at":"2026-02-07T17:31:22.102565+08:00","close_reason":"tag-only syntax semantics restored; default repeats=10 retained; verified"}
{"id":"routecodex-89","title":"stopMessage: real bd status mode","description":"## Context\nå½“å‰ stopMessage é˜¶æ®µç­–ç•¥ä»…åŸºäºæ¶ˆæ¯æ–‡æœ¬å¯å‘å¼è¯†åˆ« bd çŠ¶æ€ï¼Œéœ€è¦å¢åŠ çœŸå® bd å‘½ä»¤æŸ¥è¯¢æ¨¡å¼ã€‚\n\n## Acceptance Criteria\n- stopMessage é˜¶æ®µç­–ç•¥æ”¯æŒçœŸå® bd æŸ¥è¯¢ï¼ˆä¼˜å…ˆä½¿ç”¨ `bd --no-db ready --json` è·å–çŠ¶æ€ï¼‰ã€‚\n- åœ¨ bd å¯ç”¨ä¸”è¾“å‡ºå¯è§£ææ—¶ï¼Œé˜¶æ®µå†³ç­–ä»¥çœŸå®ç»“æœä¸ºå‡†ï¼ˆactive/idleï¼‰ã€‚\n- åœ¨ bd ä¸å¯ç”¨æˆ–å‘½ä»¤å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨å›é€€ç°æœ‰å¯å‘å¼ï¼Œä¸å½±å“ç°æœ‰æµç¨‹ã€‚\n- æ–°å¢å›å½’æµ‹è¯•è¦†ç›–ï¼šçœŸå® bd JSON è¾“å‡º active/idle è§£æã€å¤±è´¥å›é€€ã€‚\n- `tests/servertool/stop-message-auto.spec.ts` é€šè¿‡ã€‚","notes":"Implemented real BD mode for stopMessage stage policy in llmswitch-core:\n- Added runtime BD query path (`bd --no-db list/ready --json`) with mode control: ROUTECODEX_STOPMESSAGE_BD_MODE=auto|runtime|heuristic.\n- Added fallback to heuristic when runtime command fails in auto mode.\n- Added cache/timeout/workdir controls: ROUTECODEX_STOPMESSAGE_BD_CACHE_TTL_MS, ROUTECODEX_STOPMESSAGE_BD_TIMEOUT_MS, ROUTECODEX_STOPMESSAGE_BD_WORKDIR.\n- Added test helpers: resolveBdWorkStateFromRuntime + resetStopMessageBdRuntimeCacheForTests.\n\nRegression evidence:\n1) routecodex targeted Jest:\n   npm run jest:run -- --runTestsByPath tests/servertool/stop-message-auto.spec.ts --runInBand\n   -\u003e PASS 15 tests (includes new runtime/fallback cases).\n2) sharedmodule matrix script regression:\n   node scripts/tests/stop-message-stage-mode-routing.mjs -\u003e PASS.\n3) sharedmodule full build+matrix:\n   npm run build -\u003e PASS, matrix report: /Users/fanzhang/Documents/github/sharedmodule/test-results/llmswitch-core/matrix-ci-1770458471488.json\n4) host validation:\n   npm run build:dev -\u003e PASS (includes install:global and verification stack).","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T17:52:29.09182+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T18:03:39.242241+08:00","closed_at":"2026-02-07T18:03:39.242241+08:00","close_reason":"Implemented real bd status mode with fallback + regression coverage"}
{"id":"routecodex-9","title":"å¯¹é½é»˜è®¤ config.json çš„ Qwen tokenFileï¼ˆalias æœºåˆ¶ï¼‰","description":"## Problem\né»˜è®¤ç¤ºä¾‹é…ç½®ï¼ˆconfigsamples/config.json ç­‰ï¼‰é‡Œçš„ Qwen OAuth tokenFile ä»ä½¿ç”¨æ—§è·¯å¾„ ~/.routecodex/auth/qwen-oauth.jsonï¼Œå’Œå½“å‰ daemon-admin / oauth-lifecycle çš„ alias + qwen-oauth-\u003cseq\u003e-\u003calias\u003e.json æœºåˆ¶ä¸é…å¥—ï¼Œå®¹æ˜“å¯¼è‡´â€œç™»å½•åçœ‹èµ·æ¥ä¸ç”Ÿæ•ˆâ€ã€‚\n\n## Acceptance Criteria\n- é»˜è®¤ç¤ºä¾‹é…ç½®çš„ qwen.auth.tokenFile æ”¹ä¸º aliasï¼ˆæ¨è defaultï¼‰ï¼Œä¸ daemon-admin/oAuth-lifecycle è¡Œä¸ºä¸€è‡´\n- init æ¨¡æ¿ï¼ˆinit-provider-catalogï¼‰ä¸­çš„ qwen tokenFile ä¹Ÿä¸ä¹‹å¯¹é½\n- JSON è§£ææ ¡éªŒé€šè¿‡","notes":"Changed default/sample Qwen OAuth tokenFile to use alias (\"default\") to match oauth-lifecycle + daemon-admin behavior.\n\nChanges:\n- configsamples/config.json: qwen.auth.tokenFile = \"default\"\n- configsamples/provider/qwen/config.v1.json: qwen.auth.tokenFile = \"default\"\n- src/cli/config/init-provider-catalog.ts: qwen tokenFile = \"default\"\n- docs/PROVIDER_TYPES.md: qwen snippet updated\n\nEvidence:\n- JSON parse: node -e \"...JSON.parse(...)\"\n- Jest: npm run jest:run -- --runTestsByPath tests/providers/auth/tokenfile-auth.qwen-alias.spec.ts tests/providers/auth/oauth-lifecycle.qwen-enrich.spec.ts","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T11:40:07.703912+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T11:41:48.400078+08:00","closed_at":"2026-02-04T11:41:48.400078+08:00","close_reason":"é»˜è®¤/ç¤ºä¾‹ config çš„ Qwen tokenFile æ”¹ä¸º alias=defaultï¼ˆé…å¥—ä¿å­˜/è¯»å–é€»è¾‘ï¼‰","labels":["auth","config","qwen"]}
{"id":"routecodex-90","title":"Dev stage logs: print all pipeline stages","description":"## Context\néœ€è¦åœ¨ dev æ¨¡å¼ä¸‹åœ¨ console æ‰“å°å„ä¸ªé˜¶æ®µçŠ¶æ€ï¼Œä¾¿äºè§‚å¯Ÿè¯·æ±‚å¤„ç†æµç¨‹ã€‚\n\n## Acceptance Criteria\n- åœ¨ dev æ¨¡å¼é»˜è®¤å¼€å¯é˜¶æ®µæ—¥å¿—ï¼ˆæ— é¡»æ‰‹åŠ¨è®¾ç½® ROUTECODEX_STAGE_LOGï¼‰ã€‚\n- é»˜è®¤æ‰“å° request/hub/provider/servertool/response ç­‰é˜¶æ®µçŠ¶æ€ï¼ˆå¸¦ requestIdï¼‰ï¼Œä»æŠ‘åˆ¶ response.sse.* å™ªå£°ã€‚\n- error ä»å§‹ç»ˆæ‰“å°ç»†èŠ‚ï¼›verbose ä»å¯æ‰“å°è¯¦ç»† payloadã€‚\n- æ›´æ–°å¹¶é€šè¿‡ stage logger ç›¸å…³å›å½’æµ‹è¯•ã€‚","notes":"Implemented dev stage logging enhancement:\n- src/server/utils/stage-logger.ts:\n  - Dev mode default enable now checks: ROUTECODEX_STAGE_LOG/RCC_STAGE_LOG override, NODE_ENV=development, BUILD_MODE/ROUTECODEX_BUILD_MODE=dev, or buildInfo.mode=dev.\n  - Non-verbose default now prints all stage scopes except response.sse.*; keeps details hidden unless verbose/error.\n- tests/server/utils/stage-logger.spec.ts updated to reflect new behavior and added dev build mode activation case.\n\nVerification:\n1) npm run jest:run -- --runTestsByPath tests/server/utils/stage-logger.spec.ts tests/servertool/servertool-progress-logging.spec.ts --runInBand  -\u003e PASS\n2) npm run build -\u003e PASS (then restored dev mode via BUILD_MODE=dev npm run llmswitch:ensure + gen-build-info).\nAdditional validation:\n- npm run install:global -\u003e PASS (dev mode global install + health check).","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T18:16:57.615254+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T18:20:37.094965+08:00","closed_at":"2026-02-07T18:19:29.646811+08:00","close_reason":"Dev mode now prints per-stage pipeline status (non-SSE)"}
{"id":"routecodex-91","title":"ServerTool: add persistent file-based stage log","description":"Acceptance Criteria\n- Add a dedicated ServerTool JSONL file log for orchestration stage events (match/followup/final).\n- File logging is configurable by env (enable flag + custom path) and safe when disabled.\n- Console stage logging behavior remains unchanged (dev concise logs, SSE suppressed in stage logger).\n- Add regression test(s) verifying file log write and disable path.\n- Build and targeted tests pass with evidence in issue notes.","notes":"Implemented dedicated ServerTool JSONL file log for phase tracking:\n- Added logger module `sharedmodule/llmswitch-core/src/servertool/log/progress-file.ts`\n  - default path: `~/.routecodex/logs/servertool-events.jsonl`\n  - env enable: `ROUTECODEX_SERVERTOOL_FILE_LOG` / `RCC_SERVERTOOL_FILE_LOG` / `LLMSWITCH_SERVERTOOL_FILE_LOG`\n  - env path: `ROUTECODEX_SERVERTOOL_FILE_LOG_PATH` / `RCC_SERVERTOOL_FILE_LOG_PATH` / `LLMSWITCH_SERVERTOOL_FILE_LOG_PATH`\n  - default enabled in dev mode, disable with `..._FILE_LOG=0`.\n- Hooked `runServerToolOrchestration` progress emit (`sharedmodule/llmswitch-core/src/servertool/engine.ts`) to write JSONL events.\n- Added skip-event write for passthrough/no_execution so \"not triggered\" cases are visible in file logs too.\n- Added regression tests in `tests/servertool/servertool-progress-logging.spec.ts`:\n  - writes file when enabled\n  - does not write file when disabled\n\nVerification evidence:\n- `npm run jest:run -- --runTestsByPath tests/servertool/servertool-progress-logging.spec.ts tests/servertool/routing-instructions.spec.ts --runInBand` PASS\n- `cd sharedmodule/llmswitch-core \u0026\u0026 npm run build` PASS (matrix passed)\n- `npm run install:global` PASS (dev global CLI health/e2e check passed)","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T18:31:13.235729+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T18:52:30.655722+08:00","closed_at":"2026-02-07T18:52:30.655722+08:00","close_reason":"Servertool phase JSONL file log implemented with env control and regression coverage"}
{"id":"routecodex-92","title":"stopMessage shorthand activation not triggering for '\u003c**stopMessage:on**\u003etext'","description":"Acceptance Criteria\n- Parsing `\u003c**stopMessage:on**\u003eç»§ç»­` creates an armed stopMessage config (text=ç»§ç»­, mode=on, maxRepeats default 10).\n- Parsing `\u003c**stopMessage:on,3**\u003eç»§ç»­` sets maxRepeats=3.\n- Parsing `\u003c**stopMessage:on,3**\u003e` (without trailing text) remains mode-only and does not force text.\n- Existing routing instruction cleaning still strips `\u003c**...**\u003e` markers from outbound user text.\n- Regression tests and sharedmodule matrix pass.","notes":"Root cause confirmed from codex samples + parser path:\n- `\u003c**stopMessage:on**\u003eç»§ç»­` was parsed as `stopMessageMode` only (no text), so stop_message_auto skipped when session had no armed `stopMessageText`.\n- `stopMessage:on,3` repeat value was not persisted in mode-only path.\n\nFix implemented:\n1) `routing-stop-message-parser.ts` supports shorthand activation: mode+trailing text =\u003e `stopMessageSet` with text from trailing segment; default max=10 when omitted.\n2) `routing-instructions.ts` extracts trailing user text per marker and passes into stopMessage parser.\n3) `routing-stop-message-actions.ts` now applies `stopMessageMaxRepeats` in mode instructions.\n4) `engine.ts` persists mode-only repeat updates to session-scoped stopMessage state.\n5) Updated matrix script `scripts/tests/stop-message-shorthand-parse.mjs` to new expected behavior.\n6) Added routecodex regression tests in `tests/servertool/routing-instructions.spec.ts`.\n\nValidation evidence:\n- `npm run jest:run -- --runTestsByPath tests/servertool/routing-instructions.spec.ts --runInBand` PASS\n- `npm run jest:run -- --runTestsByPath tests/servertool/stopmessage-session-scope.spec.ts tests/servertool/stop-message-auto.spec.ts --runInBand` PASS\n- `cd sharedmodule/llmswitch-core \u0026\u0026 npm run build` PASS (matrix included `matrix:stop-message-shorthand-parse`)\n- Runtime parse spot-check:\n  `\u003c**stopMessage:on**\u003eç»§ç»­ =\u003e stopMessageSet(text=ç»§ç»­,max=10,mode=on)`\n  `\u003c**stopMessage:on,3**\u003eç»§ç»­ =\u003e stopMessageSet(text=ç»§ç»­,max=3,mode=on)`\n  `\u003c**stopMessage:on,3**\u003e =\u003e stopMessageMode(mode=on,max=3)`","status":"closed","priority":1,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T18:43:17.986133+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T18:44:42.100222+08:00","closed_at":"2026-02-07T18:44:42.100222+08:00","close_reason":"stopMessage shorthand now arms state and repeat mode updates persist"}
{"id":"routecodex-93","title":"stopMessage BD runtime false-idle when server cwd outside beads project","description":"Acceptance Criteria\n- Minimal verification records that `bd --no-db ready` differs between repo root and home dir.\n- stopMessage stage policy must not classify BD as idle when no beads project root is resolvable from runtime cwd.\n- In that case it should degrade to unknown (continue stage policy), not stop by bd_idle.\n- Add regression test covering missing-workdir project root behavior.\n- Targeted tests and sharedmodule build pass.","notes":"Evidence (2026-02-07):\n- Minimal bd runtime verification:\n  - repo cwd `/Users/fanzhang/Documents/github/routecodex`: `bd --no-db ready` =\u003e ready issues present.\n  - home cwd `/Users/fanzhang`: `bd --no-db ready` =\u003e no open issues.\n- Reproduced affected requests from codex-samples:\n  - req_1770462058793_fbb17bac\n  - req_1770462065860_7c72a7f7\n  - `servertool.match.json` shows `matched=false, mode=passthrough`.\n- Implemented fix:\n  1) stopMessage shorthand parser now keeps only first effective line after `\u003c**stopMessage:on**\u003e` to avoid tail pollution like `[Time/Date]...`.\n  2) stop_message_auto captured seed fallback chain added: `capturedChatRequest` -\u003e `__rt.capturedChatRequest` -\u003e `adapterContext.originalRequest`.\n  3) Host response-conversion adapter context now injects `capturedChatRequest` from `originalRequest` when missing (both `request-executor.ts` and `index.ts`).\n- Regression tests:\n  - added parser regression for multiline shorthand tail stripping.\n  - added stop_message_auto regression using `adapterContext.originalRequest` fallback.\n- Validation passed:\n  - `npm test -- tests/servertool/routing-instructions.spec.ts tests/servertool/stop-message-auto.spec.ts`\n  - `cd sharedmodule/llmswitch-core \u0026\u0026 npm run build`\n  - `npm run build:dev` (includes install:global and full verification chain).","status":"closed","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T19:09:54.12213+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T19:32:15.224686+08:00","closed_at":"2026-02-07T19:32:15.224686+08:00"}
{"id":"routecodex-94","title":"stopMessage tag-only parsing and continue_execution precedence","description":"Acceptance Criteria\n- stopMessage parsing only uses content inside \u003c** **\u003e tags; trailing text after \u003c**stopMessage:on,10**\u003e is not parsed as stopMessage text.\n- Existing stopMessage state should suppress continue_execution injection/directive, so stop_message_auto can trigger.\n- Replay evidence includes requestId + server logs showing continue_execution skip and stop_message_auto matched.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-07T20:44:02.396818+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T20:44:41.004398+08:00","closed_at":"2026-02-07T20:44:41.004398+08:00","close_reason":"Implemented tag-only stopMessage mode parsing + continue_execution gating by persisted stopMessage state. Verified by replay req_1770468080531_a6b4f3dd with logs: skip_schema_due_stopmessage, skip_user_directive_due_stopmessage, and stop_message_auto matched/final for requestId openai-responses-antigravity.antonsoltan.claude-sonnet-4-5-thinking-claude-sonnet-4-5-thinking-20260207T204120532-001."}
{"id":"routecodex-95","title":"stopMessage mode-only uses staged BD selection","description":"## Context\n\u003c**stopMessage:on,10**\u003e åº”è¿›å…¥æœ‰çŠ¶æ€ staged å›å¤ï¼Œæ ¹æ® BD çŠ¶æ€é€‰æ‹©æ¨¡æ¿æ–‡æœ¬ï¼›ä¸åº”å¼ºåˆ¶å›å¡« message1 æˆ–æŠŠ tag å¤–æ–‡æœ¬å½“ stopMessageTextã€‚\n\n## Acceptance Criteria\n- mode-only stopMessage åœ¨æ—  stopMessageText æ—¶ä»å¯è§¦å‘ staged policyï¼ˆä¾èµ– stage æ¨¡æ¿+BD çŠ¶æ€ï¼‰ã€‚\n- æ–‡æœ¬é€‰æ‹©ç”± stage policy å†³å®šï¼ˆstatus_probe/active_continue/loop_self_checkï¼‰ï¼Œè€Œéé»˜è®¤ message1 å›å¡«ã€‚\n- tag å¤–æ–‡æœ¬ä¿æŒæ™®é€šç”¨æˆ·å†…å®¹ï¼Œä¸è¿›å…¥ stopMessageTextã€‚\n- å¢åŠ /æ›´æ–°å›å½’æµ‹è¯•è¦†ç›–å¹¶é€šè¿‡ã€‚","notes":"- Root cause from latest codex sample (req_1770498806382_a967d276): mode-only `\u003c**stopMessage:on,10**\u003e` was parsed and armed in VR log, but `getStopMessageState()` returned null because it required non-empty stopMessageText.\n- Because runtime snapshot was null, stop flow could fall through to `skip_no_state` on finish_reason=stop paths.\n- Fix: allow mode-only armed state in runtime snapshot (`max\u003e0` + `stageMode in on/auto` even when text empty), and prefer session/sticky candidate by armed-state predicate.\n- Added regression: mode-only snapshot is non-null and carries `{ stopMessageStageMode:on, stopMessageMaxRepeats:10 }`.\n- Verified by replaying sample through VirtualRouterEngine with sample metadata: snapshot now emitted for same shape.","status":"in_progress","priority":0,"issue_type":"bug","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T21:21:12.904385+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.866863+08:00"}
{"id":"routecodex-96","title":"stopMessage active but no servertool trigger when sessionId only in metadata","description":"Acceptance Criteria\n- For request shapes where `adapterContext.sessionId` is empty but `adapterContext.metadata.sessionId` exists, stop_message_auto still resolves session scope and can trigger followup.\n- Existing stopMessage behavior with direct `adapterContext.sessionId` remains unchanged.\n- Regression test added and passing.\n- Evidence includes failing sample requestId `openai-responses-iflow.2-173.kimi-k2.5-kimi-k2.5-20260207T210827095-018` with `servertool.match.json` passthrough before fix.","notes":"- Reproduced from sample: `~/.routecodex/codex-samples/openai-responses/iflow.2-173.kimi-k2.5/req_1770469707095_a62605fe/servertool.match.json` =\u003e `{matched:false, mode:\"passthrough\"}` while virtual-router hit still shows active stopMessage.\n- Root cause: stop_message_auto resolved sticky scope only from top-level adapterContext sessionId/conversationId; missed nested metadata/originalRequest/runtime fields.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-07T21:22:06.270578+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T21:22:37.189443+08:00","closed_at":"2026-02-07T21:22:37.189443+08:00","close_reason":"Patched stop_message_auto scope resolution to read session/conversation from metadata/originalRequest/runtime fallback and gated persistence when no sticky key; added regression test and verified."}
{"id":"routecodex-97","title":"stopMessage stop-signal capture hardening and entry/trigger logging","description":"Acceptance Criteria\n- When servertool receives stop-like completion (finish_reason=stop|length or responses completed), it always prints stop entry log regardless of whether stop_message_auto activates.\n- stop_message_auto trigger status is always printed (activated/non_stop_flow/skipped_*).\n- stop finish detection scans all choices, not only first choice.\n- Regression tests cover metadata session scope + multi-choice stop + stop entry/skip logging.","notes":"- Added unconditional stop entry/trigger lifecycle logs in servertool orchestration for observed stop signals.\n- Hardened stop detection to scan all choices and avoid first-choice miss.\n- Added regression tests for metadata.sessionId scope, multi-choice stop, and stop entry skipped logging.","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-07T21:30:50.173837+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T21:31:05.060212+08:00","closed_at":"2026-02-07T21:31:05.060212+08:00","close_reason":"Implemented and verified stopMessage stop capture hardening + lifecycle logs."}
{"id":"routecodex-98","title":"stopMessage stop-gateway hook pipeline refactor","description":"## Success Criteria\n- stop ä¿¡å·åˆ¤å®šåªæœ‰ä¸€ä¸ªç½‘å…³ï¼ˆsingle source of truthï¼‰ï¼ŒstopMessage/clock/empty-reply ç­‰å‡å¤ç”¨åŒä¸€åˆ¤å®šç»“æœã€‚\n- stopMessage è§¦å‘å…¥å£æ”¹ä¸º hook + æ‰§è¡Œåˆ—è¡¨ï¼ˆdeclarative execution planï¼‰ï¼Œé¿å… handler å†…éƒ¨æ•£è½çš„é‡å¤æ¡ä»¶åˆ†æ”¯ã€‚\n- å“åº”ä¾§ servertool è°ƒåº¦é¡ºåºå¯é…ç½®ä¸”å¯è§‚æµ‹ï¼ˆmatch/miss/reasonï¼‰ã€‚\n- ä¿æŒç°æœ‰ stopMessage/continue_execution è¡Œä¸ºå…¼å®¹ï¼Œå¹¶æä¾›å›å½’æµ‹è¯•ã€‚","notes":"Proposed unified design (2026-02-07):\n- Introduce StopGatewayContext computed once in servertool orchestration (single stop parser output).\n- Introduce declarative auto-hook list: id, phase, priority, predicate(ctx), execute(ctx).\n- Move stopMessage/clock/empty-reply predicates to hook predicates that consume StopGatewayContext (no duplicate finish_reason parsing in handlers).\n- Preserve current behavior via legacy adapter + shadow comparison mode before cutover.\n- Align continue_execution suppression with mode-only stopMessage armed state (stageMode on/auto + maxRepeats \u003e 0).\n- Add matrix regressions for chat/responses/messages, followup nesting boundaries, and mode-only staged policy.\nStatus sync: routecodex-98.7 has been moved back to in_progress for continued regression/verification and issue tracking.","status":"open","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:35.318193+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.868092+08:00"}
{"id":"routecodex-98.1","title":"Audit current stop interception paths","description":"## Acceptance Criteria\n- è¾“å‡º stop ä¿¡å·ä» provider response åˆ° servertool handler çš„å®Œæ•´è°ƒç”¨é“¾ã€‚\n- æ ‡æ³¨å¿…ç»è·¯å¾„ã€æ—è·¯è·¯å¾„ã€é‡å¤åˆ¤å®šç‚¹ã€‚\n- ç»™å‡ºéœ€è¦æ”¶æ•›çš„åˆ¤å®šå‡½æ•°æ¸…å•ã€‚","notes":"Code audit findings (2026-02-07):\n1) Stop interception gateway currently lives in llmswitch-core response stage: convertProviderResponse -\u003e runServerToolOrchestration (sharedmodule/llmswitch-core/src/conversion/hub/response/provider-response.ts).\n2) Not a single logic path today: stopåˆ¤å®šåœ¨ orchestration.inspectStopSignalã€stop-message-auto.isStopFinishReasonã€clock-auto.isStopFinishReason ä¸‰å¤„é‡å¤å®ç°ã€‚\n3) Auto handler dispatch uses registration order (registry array), first-match-wins; no declarative priority/predicate list yet.\n4) continue_execution æŠ‘åˆ¶ stopMessage çš„åˆ¤å®šä¾èµ– hasActiveStopMessageStateForContinueExecutionï¼Œç›®å‰è¦æ±‚ stopMessageText å­˜åœ¨ï¼Œmode-only stopMessage æœªè¢«è§†ä¸º activeï¼ˆéœ€ä¸ stage-modeè¯­ä¹‰å¯¹é½ï¼‰ã€‚\n5) Host side has duplicate response-conversion wrappers (index.ts / request-executor.ts / executor-response.ts), increasing drift risk for stop gateway guarantees.\nAudit complete with concrete path mapping and duplicate-point inventory. Evidence captured from code paths in: sharedmodule/llmswitch-core/src/conversion/hub/response/provider-response.ts, sharedmodule/llmswitch-core/src/servertool/engine.ts, sharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.ts, sharedmodule/llmswitch-core/src/servertool/handlers/clock-auto.ts, sharedmodule/llmswitch-core/src/conversion/hub/process/chat-process.ts, src/server/runtime/http-server/index.ts.","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:55.037238+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T21:34:59.219588+08:00","closed_at":"2026-02-07T21:34:59.219588+08:00","dependencies":[{"issue_id":"routecodex-98.1","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-07T21:49:47.659254+08:00","created_by":"import"}]}
{"id":"routecodex-98.2","title":"Introduce StopGatewayContext in servertool engine","description":"## Acceptance Criteria\n- åœ¨ servertool orchestration ä¸­ç”Ÿæˆ StopGatewayContextï¼ˆstopObserved/eligible/source/reason/hasToolCallsï¼‰ã€‚\n- auto handler é€šè¿‡ context è¯»å– stop åˆ¤å®šï¼Œä¸å†å„è‡ªè§£æ finish_reason/statusã€‚\n- ä¿ç•™å…¼å®¹å±‚å¹¶è¡¥æµ‹è¯•ã€‚","notes":"Implemented (partial, code landed in sharedmodule/llmswitch-core):\n- Added unified stop gateway module: src/servertool/stop-gateway-context.ts (single parser + context attach/read APIs).\n- servertool orchestration now computes stop signal once and writes StopGatewayContext into runtime metadata before handler dispatch.\n- stop_message_auto and clock_auto now consume isStopEligibleForServerTool(base, adapterContext) instead of local finish_reason/status parsing for trigger gating.\n- Next step: complete migration for remaining auto flows that still read finish_reason/status directly where applicable (e.g. empty-reply nuanced trigger), then close.\nCompleted StopGatewayContext migration for orchestration trigger path and core auto handlers. Evidence: src/servertool/stop-gateway-context.ts, src/servertool/engine.ts, src/servertool/handlers/stop-message-auto.ts, src/servertool/handlers/clock-auto.ts, src/servertool/handlers/gemini-empty-reply-continue.ts.","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:55.149533+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.868596+08:00","closed_at":"2026-02-07T22:03:30.74145+08:00","dependencies":[{"issue_id":"routecodex-98.2","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-07T21:49:47.659958+08:00","created_by":"import"}]}
{"id":"routecodex-98.3","title":"Refactor auto handlers to hook list","description":"## Acceptance Criteria\n- auto handlers å£°æ˜ hook metadataï¼ˆid, phase, priority, predicate, executeï¼‰ã€‚\n- servertool æ‰§è¡Œå™¨æŒ‰æ‰§è¡Œåˆ—è¡¨è¿è¡Œå¹¶è®°å½• match/miss/reasonã€‚\n- stopMessage ä½œä¸ºä¸€ä¸ª hook èŠ‚ç‚¹æ¥å…¥ï¼Œè¡Œä¸ºä¿æŒä¸€è‡´ã€‚","notes":"Hook-list skeleton landed with deterministic metadata + execution trace callback. Evidence: src/servertool/registry.ts (listAutoServerToolHooks), src/servertool/server-side-tools.ts (auto hook execution + trace), src/servertool/types.ts (onAutoHookTrace), src/servertool/engine.ts (hook trace recording).","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:55.260498+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.869069+08:00","closed_at":"2026-02-07T22:03:30.840967+08:00","dependencies":[{"issue_id":"routecodex-98.3","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-07T21:49:47.660545+08:00","created_by":"import"}]}
{"id":"routecodex-98.4","title":"Align continue_execution precedence with mode-only stopMessage","description":"## Acceptance Criteria\n- mode-only stopMessage çŠ¶æ€ä¹Ÿèƒ½æŠ‘åˆ¶ continue_execution æ³¨å…¥/æŒ‡ä»¤ã€‚\n- ä¼˜å…ˆçº§è§„åˆ™æ–‡æ¡£åŒ–å¹¶æœ‰å›å½’æµ‹è¯•ã€‚\n- ä¸ stopMessage staged policy ä¸€è‡´ã€‚","notes":"continue_execution precedence now treats mode-only stopMessage state as active. Evidence: src/conversion/hub/process/chat-process.ts:isStopMessageStateActive and tests/sharedmodule/chat-semantics-stage1.spec.ts.","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:55.373077+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.869549+08:00","closed_at":"2026-02-07T22:03:30.938386+08:00","dependencies":[{"issue_id":"routecodex-98.4","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-07T21:49:47.661098+08:00","created_by":"import"}]}
{"id":"routecodex-98.5","title":"Regression matrix for stop hook pipeline","description":"## Acceptance Criteria\n- è¦†ç›– chat/responses/messages çš„ stop è·¯å¾„ã€‚\n- è¦†ç›– followup nested/non-nestedã€mode-onlyã€clock holdã€empty replyã€‚\n- äº§å‡º matrix è„šæœ¬å¹¶çº³å…¥ build éªŒè¯ã€‚","notes":"Partial regression coverage added and validated: tests/servertool/servertool-auto-hook-trace.spec.ts, tests/servertool/stop-message-auto.spec.ts, tests/servertool/servertool-progress-logging.spec.ts, tests/sharedmodule/chat-semantics-stage1.spec.ts. Build/verify evidence: sharedmodule npm run build (matrix in postbuild), routecodex npm run jest:run -- --runTestsByPath ... , npm run build:min, npm run install:global.\nAdded regression coverage for hook pipeline extension: tests/servertool/pre-command-hooks.spec.ts covers pre-command phase trace + jq transform ordering + invalid jq fallback.","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-07T21:33:55.488018+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T08:32:17.869998+08:00","dependencies":[{"issue_id":"routecodex-98.5","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-07T21:49:47.661649+08:00","created_by":"import"}]}
{"id":"routecodex-98.6","title":"Pre-command hook registry for tool_call interception","description":"## Acceptance Criteria\n- Add a pre-command hook stage in servertool tool_call path (before handler execution), keeping existing skeleton unchanged.\n- Hooks are registration-driven and deterministic (priority/order), with trace output for match/miss/error.\n- Add jq-based argument transform support for exec_command pre-hooks, configurable from JSON file under ~/.routecodex (or env override).\n- Keep passthrough semantics: pre-hook may transform tool-call args but must not consume/execute client tools.\n- Add targeted tests for hook ordering + jq transform + invalid hook behavior fallback.\n- Document a shell+jq registration example aligned with Claude Code PreToolUse style semantics (best-effort parity).","notes":"Analysis: align with Claude Code PreToolUse-style hook semantics (command interception before tool execution, deterministic ordering, non-blocking by default). References checked: docs.anthropic.com/en/docs/claude-code/hooks and docs.anthropic.com/en/docs/claude-code/settings. Planned shape: registration-driven pre-command hooks in llmswitch-core tool_call path, jq transform support, trace events (match/miss/error), passthrough semantics preserved.\nImplemented pre-command hook registration in tool_call interception path. Core changes: sharedmodule/llmswitch-core/src/servertool/pre-command-hooks.ts (config loader + priority ordering + jq/shell actions + trace), sharedmodule/llmswitch-core/src/servertool/server-side-tools.ts (invoke pre hooks before tool handler dispatch, patch tool-call args in-place, emit hook traces), docs/SERVERTOOL_PRE_COMMAND_HOOKS.md (config + shell+jq registration examples).\nValidation evidence: 1) cd sharedmodule/llmswitch-core \u0026\u0026 npm run build (matrix postbuild passed). 2) cd routecodex \u0026\u0026 npm run jest:run -- --runTestsByPath tests/servertool/pre-command-hooks.spec.ts tests/servertool/servertool-auto-hook-trace.spec.ts tests/servertool/stop-message-auto.spec.ts tests/servertool/servertool-progress-logging.spec.ts tests/sharedmodule/chat-semantics-stage1.spec.ts --runInBand (36 passed). 3) cd routecodex \u0026\u0026 npm run build:min (pass). 4) cd routecodex \u0026\u0026 npm run install:global (pass).","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T22:10:45.052332+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T22:20:04.52094+08:00","closed_at":"2026-02-07T22:20:04.52094+08:00","dependencies":[{"issue_id":"routecodex-98.6","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-08T08:32:17.871888+08:00","created_by":"import"}]}
{"id":"routecodex-98.7","title":"Precommand instruction activation via \u003c**precommand**\u003e","description":"## Acceptance Criteria\n- Parse routing instruction syntax for precommand activation, including \u003c**precommand:\u003cfile://precommand/...\u003e**\u003e and clear semantics.\n- Persist precommand state in routing instruction state and propagate to __rt metadata through hub pipeline (same skeleton as stopMessage).\n- Enforce script path safety: only files under ~/.routecodex/precommand are allowed (support ROUTECODEX_USER_DIR override in tests).\n- Tool-call pre-command hook stage consumes active precommand state and executes target script before handler dispatch.\n- Add targeted regression tests for parse/state serialization/runtime propagation/execution and clear behavior.\n- Keep existing JSON pre-command hook config as fallback when no precommand state is active.","notes":"Implemented precommand activation via routing instruction and runtime pre-tool hook execution.\n\nCode changes (sharedmodule/llmswitch-core):\n- Added precommand parser/state stack:\n  - src/router/virtual-router/pre-command-file-resolver.ts\n  - src/router/virtual-router/routing-pre-command-parser.ts\n  - src/router/virtual-router/routing-pre-command-actions.ts\n  - src/router/virtual-router/routing-pre-command-state-codec.ts\n- Extended routing instruction/state and persistence:\n  - src/router/virtual-router/routing-instructions.ts\n  - src/router/virtual-router/engine/routing-state/store.ts\n  - src/router/virtual-router/types.ts\n  - src/router/virtual-router/engine.ts\n- Propagated preCommandState to runtime metadata (__rt):\n  - src/conversion/hub/pipeline/hub-pipeline.ts\n- Wired pre-tool-call consumption from __rt.preCommandState:\n  - src/servertool/server-side-tools.ts\n  - src/servertool/pre-command-hooks.ts\n\nHost tests/docs updates (routecodex):\n- tests/servertool/routing-instructions.spec.ts\n- tests/servertool/pre-command-hooks.spec.ts\n- docs/SERVERTOOL_PRE_COMMAND_HOOKS.md\n\nValidation:\n1) cd sharedmodule/llmswitch-core \u0026\u0026 npm run build (pass; matrix pass)\n2) cd routecodex \u0026\u0026 npm run jest:run -- --runTestsByPath tests/servertool/pre-command-hooks.spec.ts tests/servertool/routing-instructions.spec.ts tests/servertool/servertool-auto-hook-trace.spec.ts tests/servertool/stop-message-auto.spec.ts tests/servertool/servertool-progress-logging.spec.ts tests/sharedmodule/chat-semantics-stage1.spec.ts --runInBand (57 passed)\n3) cd routecodex \u0026\u0026 npm run build:min (pass)\n4) cd routecodex \u0026\u0026 npm run install:global (pass, dev global smoke pass)","status":"in_progress","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T22:29:49.150522+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T23:08:09.168002+08:00","close_reason":"Implemented precommand activation/runtime hook path with validation","dependencies":[{"issue_id":"routecodex-98.7","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-08T08:32:17.872491+08:00","created_by":"import"}]}
{"id":"routecodex-98.8","title":"ServerTool two-queue auto hooks (A/B)","description":"Acceptance Criteria\n- Auto hook execution is split into Queue A (optional priority match) and Queue B (mandatory fallback sequence).\n- Queue A order is empty_reply_continue -\u003e stop_message_auto -\u003e clock_auto.\n- Queue B supports ordered execution and currently allows an empty list without behavior change.\n- Engine trace/log includes queue name and hook decision for both queues.\n- Regression tests cover queue order and B fallback invocation conditions.","notes":"- Implemented two-queue auto hook runner in servertool engine path:\n  - Queue A (optional): pre hooks + explicit primary order empty_reply_continue -\u003e stop_message_auto -\u003e clock_auto + remaining hooks\n  - Queue B (mandatory): reserved ordered list (currently empty, no behavior change)\n- Added queue metadata to hook trace events and log payload: queue, queueIndex, queueTotal.\n- Added stale-stop replay guard in virtual-router engine: stale stopMessage commands from non-latest marker are ignored once session already has active/lifecycle stop state, preventing clear/consumed re-arm while preserving first-time recovery.\n- Parser keeps stopMessage command extraction from latest marker message (inside \u003c** **\u003e only), allowing mode-only arming from codex sample shape.","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-08T00:14:05.727177+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-08T00:24:56.34068+08:00","closed_at":"2026-02-08T00:24:56.34068+08:00","dependencies":[{"issue_id":"routecodex-98.8","depends_on_id":"routecodex-98","type":"parent-child","created_at":"2026-02-08T08:32:17.873053+08:00","created_by":"import"}]}
{"id":"routecodex-99","title":"stopMessage lifecycle simulation and round accounting","description":"Acceptance Criteria\n- stopMessage tag parsing only reads `\u003c**...**\u003e` body; text outside tag never enters stopMessage state.\n- Armed state persists with max/used counters and is visible in per-request logs (used/max/remaining/active).\n- Each stop-triggered followup increments used and synchronizes memory + persisted state.\n- When used reaches max, state is cleaned from memory and persisted snapshot in same cycle.\n- Add simulation/regression tests covering set -\u003e trigger loop -\u003e cleanup and verify servertool JSON/file logs include compare and rounds.","notes":"Implemented and verified stopMessage lifecycle cycle: parse(\u003c**...**\u003e) -\u003e arm/persist -\u003e trigger count -\u003e max cleanup.\nEvidence:\n- sharedmodule/llmswitch-core/src/router/virtual-router/routing-stop-message-parser.ts (mode-only default max=10).\n- sharedmodule/llmswitch-core/src/router/virtual-router/routing-stop-message-actions.ts (mode command rearm/reset counters).\n- sharedmodule/llmswitch-core/src/servertool/handlers/stop-message-auto.ts (sync+async persist helper + compare rounds).\n- sharedmodule/llmswitch-core/src/servertool/stop-message-compare-context.ts (left/active fields in compare logs).\n- tests/servertool/servertool-progress-logging.spec.ts lifecycle simulation + compare assertions.\n- tests/servertool/stopmessage-session-scope.spec.ts mode-only persistence assertion.\nValidation:\n- npm run jest:run -- --runTestsByPath tests/servertool/routing-instructions.spec.ts tests/servertool/servertool-progress-logging.spec.ts tests/servertool/stopmessage-session-scope.spec.ts tests/servertool/stop-message-auto.spec.ts --runInBand\n- cd sharedmodule/llmswitch-core \u0026\u0026 npm run build\n- cd routecodex \u0026\u0026 npm run build:dev (includes install:global).","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-07T22:56:51.514851+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-07T23:12:10.759751+08:00","closed_at":"2026-02-07T23:12:10.759751+08:00","close_reason":"Implemented stopMessage full lifecycle with round logs and persistence sync"}
{"id":"routecodex-a7e","title":"Epic: Beads ä»»åŠ¡ç®¡ç†è½åœ°","description":"æŠŠä»»åŠ¡ä» AGENTS.md ç§»åˆ° bdï¼ˆBeadsï¼‰ç»Ÿä¸€ç®¡ç†ï¼›AGENTS.md åªä¿ç•™é€šç”¨å·¥ä½œåè®® + bd ä½¿ç”¨è§„èŒƒã€‚","status":"closed","priority":1,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:14:10.688996+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:16:00.844009+08:00","closed_at":"2026-02-03T12:16:00.844009+08:00","close_reason":"All children completed"}
{"id":"routecodex-a7e.1","title":"Chore: æ¸…ç† AGENTS.mdï¼ˆä»…ä¿ç•™é€šç”¨è§„åˆ™ + bd ä½¿ç”¨ï¼‰","description":"ç§»é™¤è¿‡æ—¶çš„ Skills / Landing the Plane ç­‰å†…å®¹ï¼›æ–°å¢ Beads/bd çš„ä»“åº“çº§ä½¿ç”¨çº¦å®šä¸å‘½ä»¤é€ŸæŸ¥ã€‚","notes":"å·²æ¸…ç† AGENTS.mdï¼šç§»é™¤è¿‡æ—¶æ®µè½ï¼›æ–°å¢ Beads/bd ä½¿ç”¨è§„èŒƒä¸å‘½ä»¤é€ŸæŸ¥ï¼ˆè§ AGENTS.mdï¼‰ã€‚","status":"closed","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:14:11.005415+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:15:53.614663+08:00","closed_at":"2026-02-03T12:15:53.614666+08:00","dependencies":[{"issue_id":"routecodex-a7e.1","depends_on_id":"routecodex-a7e","type":"parent-child","created_at":"2026-02-03T12:14:11.006014+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-a7e.2","title":"Chore: åœ¨ bd å†…åˆ›å»ºä»»åŠ¡ç®¡ç†è§„åˆ™ï¼ˆreferenceï¼‰","description":"å‚è€ƒå¡ç‰‡ï¼š\\n- bd ready / bd list / bd show\\n- bd create --parent \u003cepic\u003e\\n- ä¾èµ–ï¼šbd dep add \u003cblocked\u003e \u003cblocker\u003eï¼ˆé¿å…æŠŠ parent-child ä¹Ÿåšæˆ depï¼Œé˜²æ­¢ cycleï¼‰\\n- çŠ¶æ€ï¼šopen / in_progress / blocked / closed\\n- Epicï¼šç”¨ bd epic status è¿½è¸ªå®Œæˆåº¦ï¼›epic æœ¬èº«å¯è®¾ä¸º blockedï¼Œé¿å…å‡ºç°åœ¨ ready åˆ—è¡¨\\n- æ¨èï¼šbd init --stealthï¼ˆä¿æŒ .beads åªåœ¨æœ¬åœ°ï¼‰","notes":"å·²æ·»åŠ  reference è§„åˆ™å¡ï¼ˆæœ¬ issue å³ä¸ºè§„åˆ™å­˜æ¡£ï¼‰ã€‚","status":"closed","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:14:11.27531+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:15:53.518182+08:00","closed_at":"2026-02-03T12:15:53.518184+08:00","dependencies":[{"issue_id":"routecodex-a7e.2","depends_on_id":"routecodex-a7e","type":"parent-child","created_at":"2026-02-03T12:14:11.275868+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-j64","title":"Chore: åˆ‡æ¢ Beads ä¸º --no-dbï¼ˆissues.jsonl ä½œä¸ºå”¯ä¸€æ¥æºï¼‰","description":"ç›®æ ‡ï¼šåç»­æ–°å¢éœ€æ±‚ç»Ÿä¸€ç”¨ bd --no-db ç»´æŠ¤åˆ° .beads/issues.jsonlï¼ˆå¯ç‰ˆæœ¬åŒ–ï¼‰ï¼›å¿½ç•¥ .beads/*.db ç­‰æœ¬åœ°çŠ¶æ€æ–‡ä»¶ã€‚\\n\\néªŒæ”¶ï¼š\\n- .beads/issues.jsonl åŒ…å«å½“å‰ issues\\n- bd --no-db list/ready æ­£å¸¸å·¥ä½œ\\n- AGENTS.md å†™æ˜çº¦æŸï¼šæ–°å¢éœ€æ±‚å¿…é¡»å…ˆè½åˆ° bdï¼ˆ--no-dbï¼‰","notes":"å·²å®Œæˆï¼š\\n- å¯¼å‡ºå½“å‰ issues åˆ° .beads/issues.jsonl\\n- AGENTS.md çº¦æŸæ–°å¢éœ€æ±‚å¿…é¡»å…ˆç”¨ bd --no-db å»ºç«‹ issue\\n- .gitignore: ä»…è·Ÿè¸ª .beads/issues.jsonlï¼Œå¿½ç•¥å…¶å®ƒ .beads/*\\n","status":"closed","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:19:50.714931+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T19:28:31.384104+08:00","closed_at":"2026-02-03T12:20:48.417164+08:00"}
{"id":"routecodex-x7e","title":"Epic: Quota Manager + Routing Refactor V3","description":"æ‹†åˆ† VirtualRouter çš„å¥åº·/é…é¢ä¸º QuotaManagerï¼ˆå”¯ä¸€äº§å‡ºï¼‰ï¼Œå¹¶æŠŠ WebUI/æ§åˆ¶å¹³é¢/è·¯ç”±ç­–ç•¥/å‘½ä¸­æ—¥å¿—/ServerTool å‘½ä¸­è§£è€¦æˆå¯ç‹¬ç«‹æ¼”è¿›çš„æ¨¡å—ã€‚\\n\\néªŒæ”¶ï¼š\\n- QuotaManager ç»Ÿä¸€ cooldown/blacklist/quota/auth-verifyï¼ˆper provider.modelï¼‰\\n- WebUI åªèµ° /daemon/control/snapshot + /daemon/control/mutate\\n- è·¯ç”±è´Ÿè½½ç­–ç•¥ç®—æ³•/æ•°æ®è§£è€¦ï¼ˆæ‰€æœ‰ pool å¤ç”¨åŒç®—æ³•ï¼‰\\n- è·¯ç”±å‘½ä¸­ä¸ servertool å‘½ä¸­æˆä¸ºç‹¬ç«‹ç®¡é“èŠ‚ç‚¹","notes":"blocked by children: routecodex-x7e.3, routecodex-x7e.4, routecodex-x7e.5","status":"blocked","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:05:16.701038+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:09:30.839063+08:00"}
{"id":"routecodex-x7e.1","title":"QuotaManagerï¼šé…é¢/å¥åº·/å†·å´ç»Ÿä¸€ä¸­å¿ƒï¼ˆV3ï¼‰","description":"ç›®æ ‡ï¼šVirtualRouter ä¸å†è‡ªäº§ç”Ÿ cooldown/å¥åº·å†³ç­–ï¼›ç»Ÿä¸€ä» llmswitch-core QuotaManager è¾“å‡º quotaViewã€‚\\n\\nå·¥ä½œé¡¹ï¼š\\n- core: sharedmodule/llmswitch-core/src/quota/*ï¼ˆQuotaManager + storeï¼‰\\n- host: routecodex quota module è®¢é˜… provider error/success -\u003e core QuotaManager\\n- 402 å¤„ç†ï¼šblacklistUntil(resetAt/é…ç½®)ï¼Œé»˜è®¤ reset=12:00 local\\n- antigravity auth-verify/thought-signature ç­–ç•¥ç»Ÿä¸€è¿›å…¥ QuotaManager\\n\\néªŒæ”¶ï¼š\\n- VirtualRouter æ³¨å…¥ quotaView åï¼Œå¥åº·/å†·å´ä»¥ quotaView ä¸ºå‡†\\n- WebUI èƒ½çœ‹åˆ° cooldown/blacklist çŠ¶æ€","notes":"å·²å®ç°ï¼ˆæœ¬å·¥ä½œåŒºï¼‰ï¼š\\n- core: sharedmodule/llmswitch-core/src/quota/*ï¼ˆQuotaManager + apikey resetï¼‰\\n- host: src/manager/modules/quota/antigravity-quota-manager.ts ä½¿ç”¨ llmsBridge.createCoreQuotaManager + quotaView æ³¨å…¥\\n- docs: docs/QUOTA_MANAGER_V3.md\\n- tests: npm run test:routing-instructionsï¼ˆå« quota ç›¸å…³ç”¨ä¾‹ï¼‰\\n\nåŸºç¡€å®ç°å·²å®Œæˆï¼›ä»¥ä¸‹ä¸ºæ–°å¢/è¡¥é½éœ€æ±‚çš„æ‹†åˆ†ä»»åŠ¡ã€‚\n\næ‹†åˆ†ä¸ºå­ä»»åŠ¡ï¼šx7e.1.1~x7e.1.4ï¼ˆä»¥å­ä»»åŠ¡ä¸ºå‡†æ¨è¿›ä¸éªŒæ”¶ï¼‰ã€‚","status":"in_progress","priority":0,"issue_type":"epic","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-03T12:06:53.224513+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T19:28:31.384807+08:00","dependencies":[{"issue_id":"routecodex-x7e.1","depends_on_id":"routecodex-x7e","type":"parent-child","created_at":"2026-02-03T12:06:53.225112+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-x7e.1.1","title":"Quota resetAt è§„åˆ™ï¼šconfig/é»˜è®¤/æ—¶åŒº","description":"å®šä¹‰ 402/å†·å´çš„ resetAt è®¡ç®—è§„åˆ™ä¸å¯é…ç½®é¡¹ï¼ˆæœªé…ç½®æ—¶é»˜è®¤åˆ° 12:00 æœ¬åœ°æ—¶é—´ï¼Œéœ€ä¸ç°æœ‰å®ç°å¯¹é½ï¼‰ã€‚\n\nä¼˜å…ˆçº§ï¼šupstream resetAt \u003e config resetAt \u003e default 12:00 localã€‚\nå…¼å®¹ï¼šå¦‚æœ upstream æä¾› resetAt=UTCï¼Œéœ€è¦æ­£ç¡®æ¢ç®—åˆ°æœ¬åœ°å±•ç¤ºã€‚","acceptance_criteria":"- å¯åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½® resetAt è§„åˆ™ï¼ˆæ–‡æ¡£å†™æ¸…å­—æ®µ/ç¤ºä¾‹ï¼‰ã€‚\n- 402 æœªæä¾› resetAt æ—¶ï¼ŒblacklistUntil ä½¿ç”¨ config/default è®¡ç®—ã€‚\n- å•æµ‹è¦†ç›–ï¼šè·¨æ—¶åŒº/å¤ä»¤æ—¶è¾¹ç•Œï¼ˆè‡³å°‘ 2 ä¾‹ï¼‰ã€‚","notes":"\næ‰§è¡Œé¡ºåºï¼šå…ˆè½ config å­—æ®µ/é»˜è®¤è§„åˆ™/æµ‹è¯•ï¼Œå†æ¨è¿› x7e.1.2ï¼ˆ402 å¤„ç†ï¼‰ã€‚\n\nå®Œæˆï¼š\n- æ”¯æŒ config: virtualrouter.quota.apikeyDailyResetTimeï¼ˆHH:MM / HH:MMZï¼‰å¹¶åœ¨ runtime init æ—¶æ³¨å†Œåˆ° quota moduleï¼ˆapikey onlyï¼‰ã€‚\n- æ–‡æ¡£è¡¥å……é…ç½®ç¤ºä¾‹ï¼šdocs/QUOTA_MANAGER_V3.mdã€‚\n- å›å½’ï¼šnpm run test:routing-instructions é€šè¿‡ï¼›llmswitch-core: npm run test:quota-managerï¼ˆæ–°å¢ DST local reset ç”¨ä¾‹ï¼‰é€šè¿‡ã€‚","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-03T12:37:36.030193+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T13:03:43.785536+08:00","closed_at":"2026-02-03T13:03:43.785536+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.1","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-03T19:28:31.405335+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.1.2","title":"402 insufficient_quotaï¼šblacklistUntil(resetAt) + quota=0","description":"é‡åˆ° HTTP 402ï¼ˆinsufficient_quota / daily_cost_limit_exceeded ç­‰ï¼‰æ—¶ï¼Œç»Ÿä¸€ç”± QuotaManager è®°å½•ï¼š\n- quota=0\n- cooldown/blacklistUntil=resetAtï¼ˆä¼˜å…ˆç”¨ upstream resetAtï¼‰\nå¹¶ç¡®ä¿ VirtualRouter çœ‹åˆ° quotaView åä¸ä¼šç»§ç»­å‘½ä¸­è¯¥ keyã€‚","acceptance_criteria":"- 402 ååŒ provider.model ä¸å†è¢«é€‰ä¸­ï¼ˆç›´åˆ° resetAt æˆ–æ‰‹åŠ¨æ¢å¤ï¼‰ã€‚\n- resetAt åˆ°æœŸåè‡ªåŠ¨æ¢å¤å¯ç”¨ï¼ˆæˆ– quota\u003e0 åå¯ç”¨ï¼Œä¾å®ç°å†³å®šå¹¶å†™æ˜ï¼‰ã€‚\n- é€šè¿‡ /daemon/control/snapshot å¯è§‚å¯Ÿåˆ° cooldown/blacklistUntilã€‚","notes":"\nå®Œæˆï¼š\n- llmswitch-core QuotaManager 402 resetAt æå–å¢å¼ºï¼šæ”¯æŒä» provider error message / upstreamMessage ä¸­è§£æå†…åµŒ JSON çš„ resetAtï¼ˆä¸å†è¦æ±‚ details.resetAtï¼‰ã€‚\n- å›å½’ï¼šsharedmodule/llmswitch-core npm run test:quota-manager é€šè¿‡ï¼›routecodex npm run test:routing-instructions é€šè¿‡ã€‚","status":"closed","priority":0,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-03T12:37:36.153923+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T13:07:37.560877+08:00","closed_at":"2026-02-03T13:07:37.560877+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.2","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-03T19:28:31.405824+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.1.2","depends_on_id":"routecodex-x7e.1.1","type":"blocks","created_at":"2026-02-03T19:28:31.406273+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.1.3","title":"Quota æŒä¹…åŒ–ï¼šå¯åŠ¨æ¢å¤ + æ— æŒä¹…åŒ–è§£ç»‘è§„åˆ™","description":"éœ€è¦æŠŠ quota/cooldown/blacklistUntil æŒä¹…åŒ–åˆ°æœ¬åœ°ï¼Œå¹¶åœ¨è¿›ç¨‹é‡å¯åæ¢å¤ï¼›åŒæ—¶æ˜ç¡® claude/gemini session ç»‘å®šåœ¨â€œæ— æŒä¹…åŒ–/æŒä¹…åŒ–å¤±è´¥â€åœºæ™¯ä¸‹çš„è§£ç»‘ç­–ç•¥ã€‚","acceptance_criteria":"- é‡å¯å quotaView æ¢å¤ï¼ˆè‡³å°‘åŒ…å« cooldown/blacklistUntilï¼‰ã€‚\n- æŒä¹…åŒ–å¤±è´¥æ—¶ï¼šä¸ä¼šå†™å›åˆ° configï¼›ä¼šæŒ‰è§„åˆ™è§¦å‘è§£ç»‘å¹¶è®°å½•æ—¥å¿—ã€‚\n- æ–‡æ¡£è¡¥å……æŒä¹…åŒ–è·¯å¾„/æ ¼å¼/è¿ç§»ç­–ç•¥ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:37:36.270802+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:37:36.270802+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.3","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-03T19:28:31.406811+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.1.4","title":"Quota mutateï¼šæ‰‹åŠ¨æ¢å¤/è°ƒæ•´ quota + æ¸… cooldown","description":"å¯¹æ¥ control planeï¼š/daemon/control/mutate æä¾›ç»Ÿä¸€çš„ quota.* æ“ä½œï¼ˆæ¢å¤ã€è®¾ç½® quotaã€æ¸… cooldown/blacklistï¼‰ï¼Œå¹¶è½åˆ° QuotaManager ä½œä¸ºå”¯ä¸€å†™å…¥å£ã€‚","acceptance_criteria":"- mutate æ”¯æŒè‡³å°‘ 3 ç±»æ“ä½œï¼šclearCooldownã€setQuotaã€restoreNowï¼ˆåç§°ä»¥å®ç°ä¸ºå‡†ï¼‰ã€‚\n- æ“ä½œå snapshot ç«‹åˆ»å¯è§å¹¶å½±å“è·¯ç”±é€‰æ‹©ã€‚\n- æœ‰æœ€å°é‰´æƒ/å®‰å…¨è¯´æ˜ï¼ˆä»…æœ¬åœ°/ç®¡ç†å‘˜ï¼‰ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:37:36.391064+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:37:36.391064+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.4","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-03T19:28:31.407317+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.1.4","depends_on_id":"routecodex-x7e.1.2","type":"blocks","created_at":"2026-02-03T19:28:31.407785+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.1.5","title":"WebUI QuotaPool Reset æœªæ¸… model-capacity cooldown","description":"ç°è±¡ï¼šdaemon-admin WebUI çš„ Quota Pool å¤šé€‰ provider åç‚¹ Resetï¼Œåªé‡ç½® quotaStateï¼Œä½† provider ä»æ˜¾ç¤ºä¸å¯ç”¨ï¼ˆcooldown/ç±»ä¼¼é»‘åå•ï¼‰ï¼Œå¯¼è‡´ VirtualRouter ç»§ç»­ä¸é€‰å®ƒã€‚\\n\\nå¤ç°ï¼šWebUI â†’ Quota Pool â†’ å‹¾é€‰å¤šä¸ª provider â†’ Reset â†’ åˆ·æ–°åä»çœ‹åˆ° reason=cooldown:model-capacity æˆ– cooldownUntil ä»åœ¨æœªæ¥ã€‚\\n\\nåŸå› ï¼šProviderQuotaDaemonModule.resetProvider() æ²¡æœ‰æ¸…ç† ProviderModelBackoffTracker(modelBackoff) çš„ capacity backoffï¼›quotaView ä¼šæŠŠ modelBackoff å åŠ æˆ cooldownUntil/reasonï¼Œä»è€Œç»§ç»­ gate selectionã€‚","acceptance_criteria":"1) Reset(å•ä¸ª/å¤šé€‰) åï¼Œè‹¥ä»…å› ä¸º modelBackoff å¯¼è‡´ cooldownï¼Œåˆ™ quotaView(providerKey).cooldownUntil å˜ä¸º null ä¸” reason=okã€‚\\n2) Recover ä¹ŸåŒæ ·æ¸…ç† modelBackoffã€‚\\n3) å›å½’æµ‹è¯•è¦†ç›–ï¼šresetProvider clears modelBackoff.","notes":"Fix implemented (2026-02-04):\\n- Clear modelBackoff on reset/recover so cooldown:model-capacity doesnâ€™t persist after WebUI Reset.\\n- Code: src/manager/modules/quota/provider-quota-daemon.model-backoff.ts (add clearAll), src/manager/modules/quota/provider-quota-daemon.ts (reset/resetProvider/recoverProvider).\\n- Test: tests/manager/quota/provider-quota-daemon-module.spec.ts (resetProvider clears modelBackoff).\\nVerification:\\n- npm run build:dev (passed; includes install:global + e2e + mock:regressions + blackbox antigravity parity).\nDelivered:\\n- Commit: 1b9290035\\n- Verified via npm run build:dev (includes install:global + mock:regressions + test:blackbox-antigravity-parity).","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-04T08:44:49.052117+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T08:46:40.782834+08:00","closed_at":"2026-02-04T08:46:29.478568+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.5","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-04T08:46:04.903571+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.1.6","title":"daemon-admin: Reset provider-quota module æŒ‰é’®åœ¨æ–°æ¶æ„æ— æ•ˆ","description":"ç°è±¡ï¼šdaemon-admin WebUI çš„æŒ‰é’® \"Reset provider-quota module\" è°ƒç”¨ /daemon/modules/provider-quota/resetï¼Œä½†å½“å‰è¿›ç¨‹åªæ³¨å†Œ quota æ¨¡å—ï¼ˆid=quotaï¼‰ï¼Œæœªæ³¨å†Œ provider-quota æ¨¡å—ï¼ˆid=provider-quotaï¼‰ï¼Œå¯¼è‡´ç‚¹å‡»åæ— æ•ˆæœï¼ˆmodule not foundï¼‰ã€‚\\n\\né¢„æœŸï¼šè¯¥æŒ‰é’®ç”¨äºæ¸…ç† quotaView çš„ cooldown/blacklistï¼ˆåŒ…æ‹¬æ‰‹åŠ¨ offline + 429 é€€é¿ç­‰æœ¬åœ°çŠ¶æ€ï¼‰ï¼Œè®© VirtualRouter é‡æ–°å¯é€‰ã€‚\\n\\nå¤„ç†ï¼šåœ¨ /daemon/modules/:id/reset ä¸­ä¸º id=provider-quota ä¸” module ä¸å­˜åœ¨æ—¶åšæ˜¾å¼ fallbackï¼šè°ƒç”¨ quota.getAdminSnapshot() æšä¸¾ providerKeysï¼Œå¹¶é€ä¸ª quota.resetProvider(key) + persistNowï¼Œå† refreshNow ä»¥ä¾¿ antigravity ç«‹å³å›æ‹‰çœŸå®é…é¢ã€‚","acceptance_criteria":"1) å½“ provider-quota module ä¸å­˜åœ¨æ—¶ï¼ŒPOST /daemon/modules/provider-quota/reset è¿”å› 200 ä¸” body.fallback.kind=quota.reset-allã€‚\\n2) fallback ä¼šå¯¹ snapshot ä¸­æ‰€æœ‰ providerKeys è°ƒç”¨ resetProviderï¼Œå¹¶è§¦å‘ persistNowã€‚\\n3) Jest è¦†ç›–è¯¥ fallback è¡Œä¸ºã€‚","notes":"Implemented fallback (2026-02-04):\\n- When POST /daemon/modules/provider-quota/reset hits 404 (module absent), server now falls back to quota module: enumerate providerKeys via getAdminSnapshot, call resetProvider for each, persistNow, then refreshNow.\\n- Code: src/server/runtime/http-server/daemon-admin/status-handler.ts (reset route).\\n- Test: tests/server/daemon-admin/status-handler-reset-provider-quota-fallback.spec.ts (covers cookie auth + fallback).\\nEvidence:\\n- Jest: npm run jest:run -- --runTestsByPath tests/server/daemon-admin/status-handler-reset-provider-quota-fallback.spec.ts (pass).\\n- Verified via npm run build:dev (pass, includes install:global + blackbox antigravity parity).\\n- Commit: ae5e94b6f","status":"closed","priority":1,"issue_type":"bug","owner":"bot@routecodex.com","created_at":"2026-02-04T10:46:37.368051+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T10:47:32.923497+08:00","closed_at":"2026-02-04T10:47:24.260308+08:00","dependencies":[{"issue_id":"routecodex-x7e.1.6","depends_on_id":"routecodex-x7e.1","type":"parent-child","created_at":"2026-02-04T10:46:59.555472+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.2","title":"Control planeï¼šWebUI å•å…¥å£ snapshot/mutate","description":"ç›®æ ‡ï¼šWebUI åªä¾èµ–ä¸€ä¸ªç«¯å£ï¼Œç»Ÿä¸€ï¼šserver discoveryã€broadcast restartã€quota æ“ä½œã€è·¯ç”±/å‘½ä¸­è§‚æµ‹ã€‚\\n\\næ¥å£ï¼š\\n- GET /daemon/control/snapshot\\n- POST /daemon/control/mutateï¼ˆservers.restart / quota.* / runtime.restartï¼‰\\n\\néªŒæ”¶ï¼š\\n- daemon-admin UI æœ‰ Control tab ä¸”å¯æ“ä½œ","notes":"å·²å®ç°ï¼ˆæœ¬å·¥ä½œåŒºï¼‰ï¼š\\n- API: src/server/runtime/http-server/daemon-admin/control-handler.tsï¼ˆ/daemon/control/snapshot, /daemon/control/mutateï¼‰\\n- UI: docs/daemon-admin-ui.htmlï¼ˆControl tabï¼‰\\n- docs: docs/DAEMON_CONTROL_PLANE.md\\n- CLI: src/cli/commands/restart.ts æ”¯æŒ broadcast + --port\\n- tests: npm run test:routing-instructionsï¼ˆå« daemon-admin / quota refresh e2eï¼‰\\n","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:06:53.347752+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:07:08.638808+08:00","closed_at":"2026-02-03T12:07:08.63881+08:00","dependencies":[{"issue_id":"routecodex-x7e.2","depends_on_id":"routecodex-x7e","type":"parent-child","created_at":"2026-02-03T12:06:53.348295+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-x7e.3","title":"VirtualRouterï¼šè·¯ç”±ç­–ç•¥/è´Ÿè½½ç®—æ³•é‡æ„","description":"ç›®æ ‡ï¼šrouting selection ç®—æ³•ä¸æ•°æ®åˆ†ç¦»ï¼›åŒç®—æ³•é€‚é…ä¸åŒ pool é…ç½®ï¼›ä¸º WebUI ç»Ÿä¸€ç¼–è¾‘å…¥å£å‡†å¤‡ã€‚\\n\\nå·¥ä½œé¡¹ï¼š\\n- æŠ½è±¡ load balancer/selection deps\\n- sticky/å¥åº·åº¦é€»è¾‘æ”¶æ•›ï¼ˆå°½é‡ç”± quota manager é©±åŠ¨ï¼‰\\n- ç»Ÿä¸€ç­–ç•¥é…ç½®ç»“æ„å¹¶å¯åºåˆ—åŒ–","status":"in_progress","priority":0,"issue_type":"epic","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-03T12:06:53.472515+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T19:28:31.385275+08:00","dependencies":[{"issue_id":"routecodex-x7e.3","depends_on_id":"routecodex-x7e","type":"parent-child","created_at":"2026-02-03T12:06:53.473117+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-x7e.3.1","title":"WebUIï¼šè·¯ç”±ç­–ç•¥ Form UIï¼ˆrouting/loadBalancing ç¼–è¾‘ + å†™ config + restartï¼‰","description":"ä» task.md è¿ç§»ï¼šQuota Manager V3 + Control Plane çš„æœªå®Œæˆé¡¹ã€‚\\n\\nç›®æ ‡ï¼šåœ¨ daemon-admin UI æä¾›è·¯ç”±ç­–ç•¥ç¼–è¾‘è¡¨å•ï¼š\\n- ç¼–è¾‘ routing.targets / loadBalancing\\n- å†™å› configï¼ˆ~/.routecodex/config.json æˆ–æŒ‡å®šè·¯å¾„ï¼‰\\n- è§¦å‘ restartï¼ˆbroadcast/port æŒ‡å®šï¼‰\\n\\néªŒæ”¶ï¼š\\n- UI å¯ç¼–è¾‘å¹¶ä¿å­˜ config\\n- ä¿å­˜åå¯ä¸€é”®é‡å¯å¹¶ç”Ÿæ•ˆï¼ˆstatus/version å¯¹é½ï¼‰","status":"open","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:35:10.653566+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:35:10.653566+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.1","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.408312+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.1","depends_on_id":"routecodex-x7e.3.5","type":"blocks","created_at":"2026-02-03T19:28:31.408759+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.2","title":"Selection engineï¼šç®—æ³•/æ•°æ®åˆ†ç¦»ï¼ˆpool å¤ç”¨ï¼‰","description":"æŠŠ routing selection çš„ç®—æ³•ä¸æ•°æ®/çŠ¶æ€åˆ†ç¦»ï¼š\n- ç®—æ³•ï¼šçº¯å‡½æ•° + å¯æµ‹è¯•\n- æ•°æ®ï¼šquotaViewã€targetsã€session bindingï¼ˆå¦‚éœ€è¦ï¼‰\nç›®æ ‡ï¼šä¸åŒ pool åªæ¢é…ç½®ï¼Œä¸æ¢ç®—æ³•å®ç°ã€‚","acceptance_criteria":"- åŒä¸€ selection engine å¯æœåŠ¡å¤šä¸ª poolï¼ˆåªé€šè¿‡ config/inputs åŒºåˆ†ï¼‰ã€‚\n- æ–°å¢/è°ƒæ•´ç­–ç•¥ä¸éœ€è¦æ”¹åŠ¨ provider å±‚ã€‚\n- ä¸ºå…³é”®åˆ†æ”¯æä¾›å•æµ‹ï¼ˆè‡³å°‘ 3 ä¾‹ï¼šround-robinã€éšæœºã€ä¼˜å…ˆçº§ï¼‰ã€‚","notes":"\néªŒè¯/ç»“è®ºï¼š\n- é€‰æ‹©ç®—æ³•å·²ä¸ engine çŠ¶æ€è§£è€¦ï¼šsharedmodule/llmswitch-core/src/router/virtual-router/engine-selection.tsï¼ˆselectProviderImplï¼‰+ load balancerï¼ˆload-balancer.tsï¼‰+ tier-selection/sticky-pool ç­‰ã€‚\n- VirtualRouterEngine ä»…ç»„è£… deps/state å¹¶è°ƒç”¨ selectionï¼›ä¸åŒ pool å¤ç”¨åŒä¸€å¥—ç®—æ³•å®ç°ã€‚\n- è¦†ç›–ï¼štests/servertool/virtual-router-quota-routing.spec.ts / tests/servertool/virtual-router-priority-selection.spec.tsï¼›å›å½’ï¼šnpm run test:routing-instructions é€šè¿‡ã€‚","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:38:10.827368+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T13:19:05.525387+08:00","closed_at":"2026-02-03T13:19:05.525387+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.2","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.409259+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.3","title":"ç§»é™¤ sticky + session binding è§„åˆ™é‡åšï¼ˆclaude/geminiï¼‰","description":"å½“å‰ sticky/å¥åº·åº¦ç­–ç•¥å¯¼è‡´æŸäº›æ¨¡å‹æ°¸è¿œä¸ä¼šè¢«å‘½ä¸­ã€‚éœ€è¦ï¼š\n- ç§»é™¤ sticky ä½œä¸ºè·¯ç”±ç®—æ³•çš„éšå¼å‰¯ä½œç”¨ï¼ˆæ”¹ä¸ºæ˜¾å¼ session lease / binding è§„åˆ™ï¼‰\n- ç»‘å®šå‰æï¼šé¦–æ¬¡æˆåŠŸå“åº”åæ‰ç»‘å®š\n- è§£ç»‘è§¦å‘ï¼šquota=0ã€alias è¢« blacklist/cooldownã€æ‰‹åŠ¨è§£ç»‘ã€æŒä¹…åŒ–ç¼ºå¤±/å¤±è´¥ã€reset åå¯é‡æ–°ç»‘å®š\n- æ–° session å¿…é¡»å¯é‡æ–°ç»‘å®š","acceptance_criteria":"- thinking pool ä¸­ claude/gemini å¯åœ¨æ»¡è¶³å¯ç”¨æ€§æ—¶è¢«è½®è¯¢å‘½ä¸­ã€‚\n- quota=0 æˆ– blacklist æ—¶ä¼šè§£ç»‘å¹¶è·³è¿‡è¯¥ targetã€‚\n- ç»‘å®š/è§£ç»‘äº‹ä»¶åœ¨æ—¥å¿—ä¸ control snapshot å¯è§‚æµ‹ã€‚","notes":"\næ‹†åˆ†ä¸ºå­ä»»åŠ¡ x7e.3.3.1~ï¼ˆå®ç°/éªŒè¯/æŒä¹…åŒ–åˆ†ç¦»ï¼‰ã€‚","status":"open","priority":0,"issue_type":"epic","owner":"bot@routecodex.com","created_at":"2026-02-03T12:38:10.944832+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:45:13.395857+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.3","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.409747+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.3.1","title":"Session bindingï¼šé¦–æ¬¡æˆåŠŸç»‘å®š + quota/blacklist è§£ç»‘","description":"å®ç° claude/gemini çš„ session lease/binding æ ¸å¿ƒè§„åˆ™ï¼š\n- åªæœ‰é¦–æ¬¡æˆåŠŸå“åº”åæ‰ç»‘å®šåˆ° target\n- è§£ç»‘è§¦å‘ï¼šquota=0ã€blacklistUntil/cooldownã€alias blacklistã€æ‰‹åŠ¨è§£ç»‘\n- è§£ç»‘åå…è®¸åœ¨æ–°è¯·æ±‚é‡æ–°ç»‘å®š\n\næ³¨æ„ï¼šä¸ä¾èµ–æŒä¹…åŒ–ï¼ˆæŒä¹…åŒ–å•ç‹¬ä»»åŠ¡ï¼‰ã€‚","acceptance_criteria":"- thinking pool ä¸­ claude/gemini åœ¨å¯ç”¨æ—¶å¯è¢«è½®è¯¢å‘½ä¸­ï¼ˆä¸å†â€œæ°¸è¿œä¸ä¼šå‘½ä¸­â€ï¼‰ã€‚\n- quota=0 æˆ– blacklist æ—¶ç«‹å³è§£ç»‘å¹¶è·³è¿‡ã€‚\n- æ—¥å¿—ä¸ control snapshot å¯è§‚æµ‹ç»‘å®š/è§£ç»‘ã€‚","notes":"\nå®Œæˆ/è¡¥é½å¯è§‚æµ‹æ€§ï¼š\n- VirtualRouterEngine ä»…åœ¨ provider success æ—¶ commit session bindingï¼ˆå·²æœ‰ï¼‰ï¼›è¡¥å…… stage logï¼šç»‘å®š commit / quotaView è§¦å‘ release/unpinï¼ˆenv: ROUTECODEX_STAGE_LOGï¼‰ã€‚\n- Control plane snapshot æš´éœ² antigravity alias leasesï¼ˆbest-effort è¯»å– ~/.routecodex/state/antigravity-alias-leases.jsonï¼‰ï¼šGET /daemon/control/snapshot -\u003e routing.antigravityAliasLeasesã€‚\n- æµ‹è¯•ï¼štests/server/http-server/daemon-admin.e2e.spec.ts è¦†ç›– snapshot è¯»å– leases æ–‡ä»¶ï¼›å›å½’ï¼šnpm run test:routing-instructions é€šè¿‡ã€‚","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:45:13.499755+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T13:25:54.050329+08:00","closed_at":"2026-02-03T13:25:54.050329+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.3.1","depends_on_id":"routecodex-x7e.3.3","type":"parent-child","created_at":"2026-02-03T19:28:31.410221+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.3.1","depends_on_id":"routecodex-x7e.1.2","type":"blocks","created_at":"2026-02-03T19:28:31.410671+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.3.2","title":"Session bindingï¼šæŒä¹…åŒ–/é‡å¯æ¢å¤ + æ— æŒä¹…åŒ–è§£ç»‘","description":"æŠŠ session binding çŠ¶æ€ä¸ QuotaManager æŒä¹…åŒ–è”åŠ¨ï¼š\n- é‡å¯åæ¢å¤ bindingï¼ˆå¦‚æœæŒä¹…åŒ–å¯ç”¨ï¼‰\n- æ— æŒä¹…åŒ–/æŒä¹…åŒ–å¤±è´¥æ—¶ï¼šæŒ‰è§„åˆ™è§£ç»‘ï¼ˆé¿å…ç²˜ä½ä¸å¯ç”¨ targetï¼‰\n- ä¸ quota resetAt åˆ°æœŸåçš„é‡æ–°ç»‘å®šè¡Œä¸ºå¯¹é½","acceptance_criteria":"- é‡å¯å binding çŠ¶æ€ç¬¦åˆé¢„æœŸï¼ˆæœ‰/æ— æŒä¹…åŒ–ä¸¤ç§è·¯å¾„ï¼‰ã€‚\n- æŒä¹…åŒ–ç¼ºå¤±ä¸ä¼šå¯¼è‡´æŸ target æ°¸ä¹…ç²˜ä½ã€‚\n- æœ‰é’ˆå¯¹æ€§çš„å›å½’æµ‹è¯•è¦†ç›–ã€‚","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:45:13.601962+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:45:13.601962+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.3.2","depends_on_id":"routecodex-x7e.3.3","type":"parent-child","created_at":"2026-02-03T19:28:31.411157+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.3.2","depends_on_id":"routecodex-x7e.1.3","type":"blocks","created_at":"2026-02-03T19:28:31.411658+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.3.3","title":"Antigravity é˜Ÿåˆ—ï¼šå•æ´»è·ƒ alias + çŸ­å†·å´(\u003c=3min)ä¸åˆ‡æ¢","description":"åœ¨ quotaView æ¨¡å¼ä¸‹ï¼Œantigravity çš„ alias è°ƒåº¦æ”¹ä¸ºæŒ‰é˜Ÿåˆ—(å¦‚ gemini-3-pro / gemini-3-flash / claude) å•æ´»è·ƒï¼šå½“ head alias ä»æœ‰ quota æ—¶ï¼Œè¯¥é˜Ÿåˆ—åªè°ƒåº¦è¯¥ aliasï¼›è‹¥å‡ºç° cooldown ä¸”å‰©ä½™\u003c=3minï¼Œä¸åˆ‡æ¢ï¼›å‰©ä½™\u003e3min æˆ–é»‘åå•/å‡ºæ± åˆ™åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª aliasï¼Œå¹¶å°†è¢«åˆ‡æ¢ alias æ”¾åˆ°é˜Ÿå°¾ã€‚","acceptance_criteria":"- æ–°å¢ config: virtualrouter.loadBalancing.aliasSelection.antigravitySingleActiveQueuesEnabled=true æ—¶ç”Ÿæ•ˆï¼ˆé»˜è®¤ä¸æ”¹å˜ç°æœ‰ sticky-queueï¼‰ã€‚\\n- çŸ­å†·å´é˜ˆå€¼å¯é…ç½®ï¼ˆé»˜è®¤ 180000msï¼‰ã€‚\\n- quotaView ä¸‹ï¼šçŸ­å†·å´(\u003c=é˜ˆå€¼)ä¸åˆ‡æ¢ aliasï¼›é•¿å†·å´(\u003eé˜ˆå€¼)/blacklist/out-of-pool ä¼šåˆ‡æ¢å¹¶å…¥é˜Ÿå°¾ã€‚\\n- å¢åŠ  llmswitch-core å•æµ‹è¦†ç›–çŸ­/é•¿å†·å´è¡Œä¸ºã€‚","notes":"Implemented quota-aware single-active alias queues for Antigravity (per queueId: gemini-3-pro / gemini-3-flash / claude).\\nConfig (llmswitch-core): virtualrouter.loadBalancing.aliasSelection.antigravitySingleActiveQueuesEnabled + antigravityShortCooldownNoSwitchMs (default 180000).\\nLogic: sharedmodule/llmswitch-core/src/router/virtual-router/engine-selection/tier-selection-select.ts\\nBootstrap/types: sharedmodule/llmswitch-core/src/router/virtual-router/types.ts, sharedmodule/llmswitch-core/src/router/virtual-router/bootstrap.ts\\nScript test: sharedmodule/llmswitch-core/scripts/tests/virtual-router-antigravity-single-active-queue.mjs (wired into npm run test:virtual-router)\\nLocal config: /Users/fanzhang/.routecodex/config.json\\nVerification:\\n- (sharedmodule/llmswitch-core) npm run test:virtual-router âœ…\\n- (routecodex) npm run test:routing-instructions âœ…","status":"closed","priority":0,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-04T22:04:13.274314+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-04T22:16:49.0968+08:00","closed_at":"2026-02-04T22:16:49.0968+08:00","close_reason":"Implemented antigravity single-active queues + verified","dependencies":[{"issue_id":"routecodex-x7e.3.3.3","depends_on_id":"routecodex-x7e.3.3","type":"parent-child","created_at":"2026-02-04T23:50:39.386329+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.4","title":"Availability gatingï¼šä»…ç”¨ quotaViewï¼ˆå»æ‰ legacy health/cooldown æ—è·¯ï¼‰","description":"VirtualRouter ä¸å†è‡ªäº§ç”Ÿå¥åº·åº¦/cooldown æ¨å¯¼ï¼›æ‰€æœ‰å¯ç”¨æ€§åˆ¤æ–­åªæ¥è‡ª QuotaManager è¾“å‡ºçš„ quotaViewï¼ˆper provider.modelï¼‰ã€‚\næ³¨æ„ï¼šä¿æŒ provider å±‚â€œåªåš transportâ€çš„çº¦æŸã€‚","acceptance_criteria":"- VirtualRouter ä¸å†å†™å…¥/æ¨å¯¼ cooldownï¼›åªè¯» quotaViewã€‚\n- healthmanager/legacy health è¾“å‡ºè¢«ç§»é™¤æˆ–ä»…ä¿ç•™è§‚æµ‹ï¼ˆä¸å½±å“è·¯ç”±ï¼‰ã€‚\n- ç›¸å…³è¡Œä¸ºé€šè¿‡è·¯ç”±æµ‹è¯•è¦†ç›–ã€‚","notes":"\néªŒè¯/è¡¥é½ï¼š\n- VirtualRouterEngine åœ¨ quotaView æ¨¡å¼ä¸‹ handleProviderError ç›´æ¥ returnï¼Œä¸å†äº§ç”Ÿ router-local cooldown TTLï¼›updateDeps(enable quotaView) ä¼šæ¸…ç©º providerCooldownsã€‚\n- æ–°å¢å›å½’ç”¨ä¾‹ï¼štests/servertool/virtual-router-series-cooldown.spec.ts è¦†ç›–â€œquotaView enabled ä¸äº§ç”Ÿ cooldownâ€ã€‚\n- å›å½’ï¼šnpm run test:routing-instructions é€šè¿‡ã€‚","status":"closed","priority":0,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:38:11.06094+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T13:11:52.755829+08:00","closed_at":"2026-02-03T13:11:52.755829+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.4","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.41216+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.4","depends_on_id":"routecodex-x7e.1.2","type":"blocks","created_at":"2026-02-03T19:28:31.412634+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.5","title":"Policy schemaï¼šå¯åºåˆ—åŒ– + Control snapshot/mutate å¯¹æ¥","description":"å®šä¹‰ç»Ÿä¸€çš„ routing policy æ•°æ®ç»“æ„ï¼ˆtargetsã€loadBalancingã€filtersã€weights ç­‰ï¼‰å¹¶å¯åºåˆ—åŒ–åˆ° configï¼›Control plane çš„ snapshot/mutate åªåšè¯»å†™/é‡å¯ï¼Œä¸åšè·¯ç”±å†³ç­–ã€‚","acceptance_criteria":"- snapshot æš´éœ² policyï¼ˆåªè¯»ï¼‰ä¸å…¶ç‰ˆæœ¬/hashã€‚\n- mutate æ”¯æŒå†™å…¥ policy å¹¶è§¦å‘ broadcast restartã€‚\n- docs è¯´æ˜ schema ä¸å…¼å®¹/è¿ç§»ç­–ç•¥ã€‚","notes":"\nå¼€å§‹ï¼šä¸‹ä¸€æ­¥è¡¥é½ policy hash + mutate å†™å…¥ policy + broadcast restartï¼ˆæŒ‰ x7e.3.5 éªŒæ”¶ï¼‰ã€‚\nImplemented control-plane routing policy schema + snapshot/mutate.\\n- Snapshot now exposes routing.policy + routing.policyHash.\\n- Mutate action routing.policy.set writes to configPath and triggers best-effort broadcast restart.\\nEvidence: npm run test:routing-instructions (passed on 2026-02-03).\\nFiles: src/server/runtime/http-server/daemon-admin/control-handler.ts, src/server/runtime/http-server/daemon-admin/routing-policy.ts, docs/ROUTING_POLICY_SCHEMA.md\nAdditional verification: npm run build:dev passed (includes install:global + blackbox antigravity parity) on 2026-02-03; global routecodex prints version 0.89.1663.","status":"closed","priority":1,"issue_type":"task","assignee":"RouteCodex Bot","owner":"bot@routecodex.com","created_at":"2026-02-03T12:38:11.176784+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T15:23:04.799622+08:00","closed_at":"2026-02-03T15:20:42.874319+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.5","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.413129+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.5","depends_on_id":"routecodex-x7e.3.2","type":"blocks","created_at":"2026-02-03T19:28:31.4136+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.5","depends_on_id":"routecodex-x7e.3.4","type":"blocks","created_at":"2026-02-03T19:28:31.414058+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.6","title":"Docsï¼šè·¯ç”±ç­–ç•¥/ç»‘å®šè§„åˆ™/è¿ç§»è¯´æ˜","description":"è¡¥é½ docsï¼š\n- selection engine è¾“å…¥/è¾“å‡º\n- session binding è§„åˆ™ï¼ˆclaude/geminiï¼‰\n- quotaView gating åŸåˆ™\n- ä¸æ—§ç‰ˆ sticky/health çš„è¿ç§»è¯´æ˜","acceptance_criteria":"- docs å®Œæ•´å¯è¯»ï¼ˆå«ç¤ºä¾‹ configï¼‰ã€‚\n- èƒ½è¢« WebUI è¡¨å•å¤ç”¨ï¼ˆå­—æ®µå‘½åä¸€è‡´ï¼‰ã€‚","status":"open","priority":2,"issue_type":"chore","owner":"bot@routecodex.com","created_at":"2026-02-03T12:38:11.288638+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:38:11.288638+08:00","dependencies":[{"issue_id":"routecodex-x7e.3.6","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-03T19:28:31.414568+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.6","depends_on_id":"routecodex-x7e.3.5","type":"blocks","created_at":"2026-02-03T19:28:31.415054+08:00","created_by":"import"},{"issue_id":"routecodex-x7e.3.6","depends_on_id":"routecodex-x7e.3.3.2","type":"blocks","created_at":"2026-02-03T19:28:31.415556+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.3.7","title":"LM Studio /v1/responses SSE æ—  event: æ—¶å…¼å®¹ data.type + é”™è¯¯å¯æ„ŸçŸ¥","description":"Problem\n- èµ° lmstudio(type=responses) æ—¶ï¼ŒLM Studio ä¸Šæ¸¸ SSE å¸¸è§åªå‘ data: {\"type\": \"response.*\"} è€Œä¸å¸¦ event: è¡Œã€‚\n- llmswitch-core responses SSEâ†’JSON è½¬æ¢å°†ç¼ºçœ event è§†ä¸º \"message\"ï¼Œä¸åœ¨ allowedEventTypes å†…ï¼Œå¯¼è‡´ SSE_TO_JSON_ERRORï¼ˆterminatedï¼‰ï¼Œå®¢æˆ·ç«¯ä¾§åªçœ‹åˆ°æ–­æµ/ä¸æ˜é”™è¯¯ï¼ˆä¾‹å¦‚ [object Object]ï¼‰ã€‚\n\nAcceptance Criteria\n1) llmswitch-core SSE parser/è½¬æ¢å™¨åœ¨ç¼ºå¤± event: è¡Œæ—¶ï¼Œèƒ½ä» data JSON çš„ type å­—æ®µæ¨å¯¼äº‹ä»¶ç±»å‹ï¼Œå¹¶å®Œæˆ responses SSEâ†’JSON è½¬æ¢ï¼ˆè‡³å°‘è¦†ç›– response.output_item.added / response.completed / errorï¼‰ã€‚\n2) è‹¥ä»å‘ç”Ÿ SSEâ†’JSON è½¬æ¢å¤±è´¥ï¼Œroutecodex éœ€è¦åœ¨å·²å¼€å§‹ SSE streaming çš„æƒ…å†µä¸‹å‘å®¢æˆ·ç«¯å†™å‡ºæ ‡å‡† error eventï¼ˆä¸å†é™é»˜æ–­æµï¼‰ã€‚\n3) æ·»åŠ å›å½’æµ‹è¯•ï¼šè¾“å…¥ä¸ºä¸å¸¦ event: çš„ SSE frameï¼Œæ–­è¨€èƒ½å¾—åˆ°æ­£ç¡®äº‹ä»¶æˆ–å¯é¢„æœŸé”™è¯¯ã€‚\n\nEvidence\n- ~/.routecodex/state/router/*/health.jsonl ä¸­å‡ºç° code=SSE_TO_JSON_ERROR, stage=provider.httpï¼Œtarget=lmstudio.*(process=chat, protocol=openai-responses)ã€‚\n- è·¯ç”±æ—¥å¿—ï¼švirtual-router-hit -\u003e lmstudio[key1].qwen3-coder-next-mlx, outboundStream=trueã€‚","notes":"Fix\n- llmswitch-core SSE parser: when `event:` is missing (defaults to \"message\"), infer event type from `data.type` (only if it is an allowed event type).\n- routecodex SSE stream error handler: emit OpenAI-style SSE `event: error` payload {type,status,error{message,code,request_id}} instead of `{message}` (LM Studio UI previously shows [object Object]).\n\nEvidence (commands)\n- sharedmodule/llmswitch-core: `npm run build:ci` OK.\n- sharedmodule/llmswitch-core: `node scripts/tests/responses-sse-parser-lmstudio-no-event.mjs` =\u003e âœ… passed.\n- sharedmodule/llmswitch-core: `node scripts/tests/loop-rt-responses.mjs` =\u003e âœ… responses pure roundtrip passed; âœ… responses client roundtrip passed (LM Studio compatible).\n- routecodex: `npm run build:dev` OK (includes install:global + suite).\n\nKey files\n- sharedmodule/llmswitch-core/src/sse/sse-to-json/parsers/sse-parser.ts\n- sharedmodule/llmswitch-core/scripts/tests/responses-sse-parser-lmstudio-no-event.mjs\n- sharedmodule/llmswitch-core/scripts/tests/run-matrix-ci.mjs\n- src/server/handlers/handler-utils.ts\n- src/server/handlers/sse-dispatcher.ts\n","status":"closed","priority":0,"issue_type":"task","assignee":"codex","owner":"bot@routecodex.com","created_at":"2026-02-05T12:06:53.631487+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-05T12:25:00.399071+08:00","closed_at":"2026-02-05T12:25:00.399071+08:00","close_reason":"LM Studio SSE no-event frames now parsed via data.type; stream errors surfaced as OpenAI-style SSE error","dependencies":[{"issue_id":"routecodex-x7e.3.7","depends_on_id":"routecodex-x7e.3","type":"parent-child","created_at":"2026-02-05T12:27:07.943843+08:00","created_by":"import"}]}
{"id":"routecodex-x7e.4","title":"Routing hitï¼šå‘½ä¸­/ç†ç”±/ç»Ÿè®¡ç‹¬ç«‹æ¨¡å—","description":"ç›®æ ‡ï¼švirtual-router-hitï¼ˆå« reason/stopMessage/penaltyï¼‰ä¸ stats è¾“å‡ºæœ‰å”¯ä¸€æ¨¡å—ã€‚\\n\\néªŒæ”¶ï¼š\\n- llmsStats / debug logger / webui å¤ç”¨åŒä¸€ä»½æ•°æ®","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:06:53.5982+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:06:53.5982+08:00","dependencies":[{"issue_id":"routecodex-x7e.4","depends_on_id":"routecodex-x7e","type":"parent-child","created_at":"2026-02-03T12:06:53.598818+08:00","created_by":"RouteCodex Bot"}]}
{"id":"routecodex-x7e.5","title":"ServerToolï¼šå‘½ä¸­é€»è¾‘æŠ½ä¸º pipeline èŠ‚ç‚¹","description":"ç›®æ ‡ï¼šservertool match/execute ä» response conversion ä¸­æŠ½ç¦»æˆç‹¬ç«‹æµæ°´çº¿èŠ‚ç‚¹ï¼Œä¾¿äºæµ‹è¯•ä¸è§‚æµ‹ã€‚\\n\\néªŒæ”¶ï¼š\\n- no_servertool_match ç­‰æ—¥å¿—/æŒ‡æ ‡åœ¨ç»Ÿä¸€èŠ‚ç‚¹äº§ç”Ÿ","status":"open","priority":1,"issue_type":"task","owner":"bot@routecodex.com","created_at":"2026-02-03T12:06:53.721922+08:00","created_by":"RouteCodex Bot","updated_at":"2026-02-03T12:06:53.721922+08:00","dependencies":[{"issue_id":"routecodex-x7e.5","depends_on_id":"routecodex-x7e","type":"parent-child","created_at":"2026-02-03T12:06:53.722476+08:00","created_by":"RouteCodex Bot"}]}
