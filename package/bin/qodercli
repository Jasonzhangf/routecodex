#!/usr/bin/env node

const path = require('path');
const fs = require('fs');
const { spawn } = require('child_process');

const BINARY_NAME = 'qodercli';
const PACKAGE_ROOT = path.resolve(__dirname, '..');
const BIN_DIR = path.join(PACKAGE_ROOT, 'bin');
const binPath = path.join(BIN_DIR, BINARY_NAME + (process.platform === 'win32' ? '.exe' : ''));

function showInstallationError() {
  console.error('❌ qodercli binary not found');
  console.error('This usually means the installation process failed or was incomplete.');
  console.error('📋 System Information for debugging:');
  console.error(`   Platform: ${process.platform} (${process.arch})`);
  console.error(`   Node.js: ${process.version}`);
  console.error(`   npm: ${process.env.npm_version || 'unknown'}`);
  console.error(`   Binary path: ${binPath}`);
  console.error('');
}

// check if the binary file exists
if (!fs.existsSync(binPath)) {
  showInstallationError();
  process.exit(1);
}

// execute the actual binary file
const child = spawn(binPath, process.argv.slice(2), {
  stdio: 'inherit',
  windowsHide: false
});

child.on('close', (code) => {
  process.exit(code);
});

child.on('error', (error) => {
  console.error('execution failed:', error.message);
  process.exit(1);
});
