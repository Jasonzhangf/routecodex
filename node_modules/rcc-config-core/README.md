# rcc-config-core - Provider Defaults & Canonical Model

`rcc-config-core` 负责从用户配置与系统配置中构建 canonical 配置模型，并导出 RouteCodex 所需的 assembler 配置。

## Provider 默认行为入口

- Provider 的默认行为（协议族、默认端点、默认模型、超时/重试策略等）由
  `interpreter/provider-defaults.js` 统一定义，目前覆盖：
  - `openai`
  - `responses`
  - `anthropic`
- 该模块只作为 **系统默认表** 使用，最终结果仍可被用户配置覆盖。
 - 默认行为以 `providerType` 为维度（协议族：openai / anthropic / responses / gemini），
   不区分 glm/qwen/lmstudio/iflow 等厂商；这些厂商差异由上层兼容模块处理。

## Canonical Providers

- `interpreter/build-canonical.js` 中的 `normalizeProvider()` 会将：
  - `provider-defaults.js` 中的默认值；
  - `userConfig.virtualrouter.providers[provId]`；
  合并为 canonical provider 对象。
- 对于已在默认表中注册的 family（如 openai / responses / anthropic），canonical provider 目前包含：
  - `providerType`
  - `protocol`
  - `baseUrl`
  - `endpoint`
  - `defaultModel`
  - `timeoutMs`
  - `maxRetries`
  - `authCapabilities`（必需/可选认证类型）
  - 注意：canonical provider 中仅包含 **行为配置**，不包含任何兼容 patch 逻辑；
    glm/qwen/lmstudio/iflow 等兼容差异由 RouteCodex 的 Compatibility 层处理。

## Assembler 输出

- `exporters/export-assembler-v2.js` 会将 canonical providers 中的行为字段透传到
  `modules.provider.config` 中，字段包括：
  - `providerType`
  - `protocol`
  - `baseUrl`
  - `endpoint`
  - `defaultModel`
  - `timeoutMs`
  - `maxRetries`
  - `headers`
  - `authCapabilities`
- RouteCodex 的 Provider V2（openai-standard）将优先消费这些字段，逐步替换内部硬编码的
  service profiles。Provider 层只使用这些配置创建 HTTP 客户端和认证，**不负责任何厂商兼容 patch**。

## 后续扩展

- 其他 provider family（如 glm / qwen / lmstudio / iflow 等）可以按 `provider-defaults.js`
  的格式逐步补充默认行为，在 canonical 与 assembler 层先对齐，再在 RouteCodex 侧切换消费逻辑。
