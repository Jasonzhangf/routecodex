# GLM API å‚è€ƒæ–‡æ¡£

æœ¬æ–‡æ¡£æè¿°äº†æ™ºè°±AIï¼ˆGLMï¼‰æ¨¡å‹çš„APIæ¥å£ï¼ŒåŒ…æ‹¬å¯¹è¯è¡¥å…¨ã€å‚æ•°é…ç½®ã€å“åº”æ ¼å¼ç­‰è¯¦ç»†ä¿¡æ¯ã€‚

## ğŸ“‹ æ¦‚è¿°

GLMï¼ˆGeneral Language Modelï¼‰æ˜¯æ™ºè°±AIå¼€å‘çš„å¤§è¯­è¨€æ¨¡å‹ç³»åˆ—ï¼Œæ”¯æŒå¤šç§ä»»åŠ¡ç±»å‹ï¼ŒåŒ…æ‹¬å¯¹è¯ã€ä»£ç ç”Ÿæˆã€æ¨ç†ç­‰ã€‚RouteCodexé€šè¿‡`glm-compatibility`æ¨¡å—æä¾›å¯¹GLMæ¨¡å‹çš„å®Œæ•´æ”¯æŒã€‚

## ğŸ¯ æ”¯æŒçš„æ¨¡å‹

### GLM-4.6 ç³»åˆ—
- **glm-4.6**: æœ€æ–°æ——èˆ°æ¨¡å‹ï¼Œä¸“ä¸ºæ™ºèƒ½ä½“åº”ç”¨æ‰“é€ 
- **glm-4.5**: å¤æ‚æ¨ç†ã€è¶…é•¿ä¸Šä¸‹æ–‡æ”¯æŒ
- **glm-4.5-air**: è½»é‡çº§ç‰ˆæœ¬ï¼Œå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
- **glm-4.5-x**: å¢å¼ºç‰ˆæœ¬ï¼Œæ”¯æŒæ›´å¤æ‚çš„ä»»åŠ¡
- **glm-4.5-airx**: é«˜æ€§èƒ½è½»é‡ç‰ˆæœ¬
- **glm-4.5-flash**: å¿«é€Ÿå“åº”ç‰ˆæœ¬

### GLM-4 ç³»åˆ—
- **glm-4-plus**: å¢å¼ºç‰ˆæœ¬
- **glm-4-air-250414**: 2025å¹´4æœˆç‰ˆæœ¬
- **glm-4-airx**: é«˜æ€§èƒ½ç‰ˆæœ¬
- **glm-4-flashx**: æé€Ÿç‰ˆæœ¬
- **glm-4-flashx-250414**: 2025å¹´4æœˆæé€Ÿç‰ˆæœ¬

### GLM-Z1 ç³»åˆ—
- **glm-z1-air**: æ¨ç†ä¸“ç”¨è½»é‡ç‰ˆæœ¬
- **glm-z1-airx**: æ¨ç†ä¸“ç”¨é«˜æ€§èƒ½ç‰ˆæœ¬
- **glm-z1-flash**: æ¨ç†ä¸“ç”¨å¿«é€Ÿç‰ˆæœ¬
- **glm-z1-flashx**: æ¨ç†ä¸“ç”¨æé€Ÿç‰ˆæœ¬

## ğŸ”§ APIç«¯ç‚¹

### å¯¹è¯è¡¥å…¨
```
POST https://open.bigmodel.cn/api/paas/v4/chat/completions
```

### è®¤è¯æ–¹å¼
```
Authorization: Bearer <your-api-key>
Content-Type: application/json
```

## ğŸ“¨ è¯·æ±‚å‚æ•°

### åŸºç¡€å‚æ•°

| å‚æ•° | ç±»å‹ | å¿…éœ€ | é»˜è®¤å€¼ | æè¿° |
|------|------|------|--------|------|
| `model` | string | âœ… | - | æ¨¡å‹åç§°ï¼Œè¯¦è§æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨ |
| `messages` | array | âœ… | - | å¯¹è¯æ¶ˆæ¯åˆ—è¡¨ |
| `stream` | boolean | âŒ | false | æ˜¯å¦å¯ç”¨æµå¼è¾“å‡º |
| `temperature` | number | âŒ | 1.0 | é‡‡æ ·æ¸©åº¦ï¼ŒèŒƒå›´[0.0, 1.0] |
| `top_p` | number | âŒ | 0.95 | æ ¸é‡‡æ ·å‚æ•°ï¼ŒèŒƒå›´(0.0, 1.0] |
| `max_tokens` | integer | âŒ | - | æœ€å¤§è¾“å‡ºtokenæ•° |
| `do_sample` | boolean | âŒ | true | æ˜¯å¦å¯ç”¨é‡‡æ ·ç­–ç•¥ |

### æ¶ˆæ¯æ ¼å¼

#### ç”¨æˆ·æ¶ˆæ¯
```json
{
  "role": "user",
  "content": "ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬å†…å®¹"
}
```

#### ç³»ç»Ÿæ¶ˆæ¯
```json
{
  "role": "system",
  "content": "ç³»ç»Ÿè®¾å®šå†…å®¹"
}
```

#### åŠ©æ‰‹æ¶ˆæ¯
```json
{
  "role": "assistant",
  "content": "åŠ©æ‰‹å›å¤å†…å®¹"
}
```

#### å·¥å…·æ¶ˆæ¯
```json
{
  "role": "tool",
  "content": "å·¥å…·è¿”å›ç»“æœ",
  "tool_call_id": "å·¥å…·è°ƒç”¨ID"
}
```

### æ€è€ƒé“¾é…ç½®ï¼ˆGLM-4.5+ï¼‰

```json
{
  "thinking": {
    "type": "enabled" | "disabled"
  }
}
```

### å·¥å…·è°ƒç”¨

#### å‡½æ•°å·¥å…·
```json
{
  "tools": [{
    "type": "function",
    "function": {
      "name": "å‡½æ•°åç§°",
      "description": "å‡½æ•°æè¿°",
      "parameters": {
        "type": "object",
        "properties": {
          "å‚æ•°å": {
            "type": "string",
            "description": "å‚æ•°æè¿°"
          }
        },
        "required": ["å¿…éœ€å‚æ•°"]
      }
    }
  }]
}
```

#### å·¥å…·é€‰æ‹©
```json
{
  "tool_choice": "auto"
}
```

### è¾“å‡ºæ ¼å¼

```json
{
  "response_format": {
    "type": "text" | "json_object"
  }
}
```

### åœæ­¢è¯

```json
{
  "stop": ["åœæ­¢è¯1", "åœæ­¢è¯2"]
}
```

## ğŸ“¤ å“åº”æ ¼å¼

### æˆåŠŸå“åº”

```json
{
  "id": "ä»»åŠ¡ID",
  "request_id": "è¯·æ±‚ID",
  "created": 1234567890,
  "model": "ä½¿ç”¨çš„æ¨¡å‹åç§°",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "å›å¤å†…å®¹",
        "reasoning_content": "æ€è€ƒå†…å®¹ï¼ˆå¯é€‰ï¼‰",
        "tool_calls": [
          {
            "id": "è°ƒç”¨ID",
            "type": "function",
            "function": {
              "name": "å‡½æ•°åç§°",
              "arguments": "{"å‚æ•°": "å€¼"}"
            }
          }
        ]
      },
      "finish_reason": "stop" | "tool_calls" | "length" | "sensitive" | "network_error"
    }
  ],
  "usage": {
    "prompt_tokens": 100,
    "completion_tokens": 50,
    "total_tokens": 150,
    "prompt_tokens_details": {
      "cached_tokens": 0
    }
  }
}
```

### æµå¼å“åº”

æµå¼å“åº”ä½¿ç”¨Server-Sent Events (SSE)æ ¼å¼ï¼š

```
data: {"id":"","object":"chat.completion.chunk","created":1234567890,"model":"glm-4","choices":[{"index":0,"delta":{"content":"å†…å®¹ç‰‡æ®µ"},"finish_reason":null}]}

data: [DONE]
```

## ğŸ› ï¸ å…¼å®¹æ€§å¤„ç†

RouteCodexçš„`glm-compatibility`æ¨¡å—å¤„ç†ä»¥ä¸‹å…¼å®¹æ€§é—®é¢˜ï¼š

### æ€è€ƒå†…å®¹å¤„ç†
- **è¾“å…¥**: è‡ªåŠ¨æ·»åŠ `thinking`å‚æ•°åˆ°GLM-4.5+æ¨¡å‹
- **è¾“å‡º**: æ¸…ç†ç§æœ‰çš„`<think>...</think>`æ ‡ç­¾
- **é…ç½®**: æ”¯æŒæŒ‰æ¨¡å‹é…ç½®æ€è€ƒåŠŸèƒ½

### å·¥å…·è°ƒç”¨å…¼å®¹
- æ ¼å¼è½¬æ¢: OpenAI å·¥å…·æ ¼å¼ â†” GLM å·¥å…·æ ¼å¼ï¼ˆä»…åšæœ€å°å¿…è¦çš„å­—æ®µè§„èŒƒåŒ–ï¼Œä¸åšè¯­ä¹‰æ”¹å†™ï¼‰
- å†å²ä¿ç•™: ä¸å†æ¸…ç†å†å²å·¥å…·è°ƒç”¨ï¼Œé¿å…æ¨¡å‹é—å¿˜æˆ–é‡å¤è°ƒç”¨ï¼ˆæ­¤å‰ä¸ºè§„é¿ 1210/1214 çš„åšæ³•å·²åºŸå¼ƒï¼‰
- ç©ºå€¼è§„æ•´: ä»…è§„èŒƒå½“å‰è½®çš„å­—æ®µç±»å‹ï¼ˆå¦‚ function.arguments å­—ç¬¦ä¸²åŒ–ï¼‰ï¼Œä¸ä¼šåˆ é™¤å†å²æ¶ˆæ¯
- é”™è¯¯å¤„ç†: é’ˆå¯¹ GLM è¿”å›æ ¼å¼å·®å¼‚ï¼ˆå¦‚ reasoning_contentã€usage å­—æ®µï¼‰åšæœ€å°ä¿®å¤

### æ¶ˆæ¯æ¸…ç†
- **ç©ºæ¶ˆæ¯åˆ é™¤**: åˆ é™¤æ— å†…å®¹ä¸”æ— å·¥å…·è°ƒç”¨çš„æ¶ˆæ¯
- **ç³»ç»Ÿæ¶ˆæ¯**: ä¿ç•™ç³»ç»Ÿæ¶ˆæ¯ç”¨äºè¡Œä¸ºè®¾å®š
- **å·¥å…·å†å²**: ä»…åœ¨â€œå‘é€å‰â€ä¿ç•™æœ€è¿‘ä¸€è½®çš„ `assistant.tool_calls`ï¼Œå¹¶å°†è¯¥æ¡ `content=null`ï¼›ä¸æ¸…ç† `role:tool` å†å²ã€ä¸åˆ é™¤æ—©æœŸåŠ©æ‰‹æ¶ˆæ¯ï¼ˆä»…ç§»é™¤å…¶ `tool_calls` å­—æ®µï¼‰ã€‚è¯¥è§„èŒƒä¸ºé»˜è®¤ç­–ç•¥ï¼Œæ— éœ€ä»»ä½•å¼€å…³ã€‚

### å“åº”æ ‡å‡†åŒ–
- **æ ¼å¼è½¬æ¢**: GLMå“åº”æ ¼å¼ â†’ OpenAIæ ‡å‡†æ ¼å¼
- **å­—æ®µæ˜ å°„**: `created_at` â†’ `created`ç­‰
- **ä½¿ç”¨ç»Ÿè®¡**: `output_tokens` â†’ `completion_tokens`

## ğŸ” æ¨¡å‹ç‰¹æ€§

### GLM-4.6ç‰¹æ€§
- **æœ€å¤§ä¸Šä¸‹æ–‡**: 128K tokens
- **å·¥å…·è°ƒç”¨**: å®Œæ•´æ”¯æŒï¼Œæœ€å¤š128ä¸ªå‡½æ•°
- **æµå¼è¾“å‡º**: æ”¯æŒå·¥å…·è°ƒç”¨çš„æµå¼å“åº”
- **å¤šæ¨¡æ€**: æ”¯æŒæ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘ã€è§†é¢‘
- **æ¨ç†èƒ½åŠ›**: æ”¯æŒå¤æ‚æ¨ç†ä»»åŠ¡

### GLM-4.5ç‰¹æ€§
- **æœ€å¤§ä¸Šä¸‹æ–‡**: 96K tokens
- **æ€è€ƒé“¾**: æ”¯æŒå¯é…ç½®çš„æ€è€ƒè¿‡ç¨‹
- **å·¥å…·æ”¯æŒ**: æ”¯æŒWebæœç´¢å’ŒçŸ¥è¯†åº“æ£€ç´¢
- **æ¨ç†ä¼˜åŒ–**: é’ˆå¯¹æ¨ç†ä»»åŠ¡ä¼˜åŒ–

### GLM-Z1ç‰¹æ€§
- **æ¨ç†ä¸“ç”¨**: ä¸“ä¸ºæ¨ç†ä»»åŠ¡è®¾è®¡
- **æœ€å¤§è¾“å‡º**: 32K tokens
- **æ€è€ƒæ ‡ç­¾**: åœ¨contentä¸­ä½¿ç”¨`<think>`æ ‡ç­¾

## ğŸ“Š æ€§èƒ½å‚æ•°

### æ¸©åº¦å‚æ•°å»ºè®®
- **åˆ›æ„å†™ä½œ**: temperature=0.8-1.0
- **ä»£ç ç”Ÿæˆ**: temperature=0.2-0.4
- **äº‹å®é—®ç­”**: temperature=0.1-0.3
- **ç¿»è¯‘ä»»åŠ¡**: temperature=0.1-0.2

### æœ€å¤§Tokenå»ºè®®
- **çŸ­å¯¹è¯**: max_tokens=1024-2048
- **é•¿æ–‡æœ¬**: max_tokens=4096-8192
- **ä»£ç ç”Ÿæˆ**: max_tokens=4096-16384
- **æ–‡æ¡£æ€»ç»“**: max_tokens=8192-32768

## âš ï¸ æ³¨æ„äº‹é¡¹

### æ¶ˆæ¯é¡ºåºè¦æ±‚
- ä¸èƒ½åªåŒ…å«ç³»ç»Ÿæ¶ˆæ¯æˆ–åŠ©æ‰‹æ¶ˆæ¯
- ç”¨æˆ·æ¶ˆæ¯å’ŒåŠ©æ‰‹æ¶ˆæ¯å¿…é¡»äº¤æ›¿å‡ºç°
- å·¥å…·æ¶ˆæ¯å¿…é¡»è·Ÿåœ¨å¯¹åº”çš„åŠ©æ‰‹æ¶ˆæ¯ä¹‹å

### å·¥å…·è°ƒç”¨é™åˆ¶
- æœ€å¤šæ”¯æŒ128ä¸ªå‡½æ•°å·¥å…·
- å‡½æ•°åç§°åªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿å’Œç ´æŠ˜å·
- å‡½æ•°åç§°æœ€å¤§é•¿åº¦64ä¸ªå­—ç¬¦
- å‚æ•°å¿…é¡»ç¬¦åˆJSON Schemaè§„èŒƒ

### å†…å®¹è¿‡æ»¤
- å“åº”å¯èƒ½åŒ…å«`content_filter`å­—æ®µ
- `level 0-3`è¡¨ç¤ºä¸¥é‡ç¨‹åº¦ï¼Œ0æœ€ä¸¥é‡
- å¯èƒ½æ¶‰åŠç”¨æˆ·è¾“å…¥ã€æ¨¡å‹æ¨ç†ã€å†å²ä¸Šä¸‹æ–‡

## ğŸ”§ ç¯å¢ƒå˜é‡

RouteCodex æ”¯æŒæœ‰é™çš„å…¼å®¹æ€§ç¯å¢ƒå˜é‡ï¼›ä¸â€œå·¥å…·å†å²æ¸…ç†â€ç›¸å…³çš„å¼€å…³å·²åºŸå¼ƒï¼š

```bash
# å¼ºåˆ¶ç¦ç”¨æ€è€ƒåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰
export RCC_GLM_DISABLE_THINKING=1

# å·²åºŸå¼ƒï¼šå†å²å·¥å…·æ¸…ç†ç›¸å…³å¼€å…³ï¼ˆä¸å†éœ€è¦ï¼‰
# export RCC_GLM_TRIM_TOOL_HISTORY=1
# export RCC_GLM_TRIM_TOOL_KEEP_LAST_TOOL=3
# export RCC_GLM_TRIM_TOOL_KEEP_LAST_ASSIST=1

# æ¨ç†å†…å®¹ç­–ç•¥ï¼šauto|strip|preserveï¼ˆä¿ç•™ï¼Œç”¨äºå“åº”ä¾§æ€è€ƒå†…å®¹ç­–ç•¥ï¼‰
export RCC_REASONING_POLICY=auto
```

## ğŸ“ˆ é”™è¯¯ç 

### å¸¸è§é”™è¯¯
- **1210**: å·¥å…·è°ƒç”¨æ ¼å¼é”™è¯¯
- **1214**: å·¥å…·è°ƒç”¨é…å¯¹é”™è¯¯
- **empty_prompt_after_cleanup**: æ¸…ç†åæ¶ˆæ¯ä¸ºç©º
- **sensitive**: å†…å®¹è¢«å®‰å…¨å®¡æ ¸æ‹¦æˆª
- **network_error**: æ¨¡å‹æ¨ç†å¼‚å¸¸

### å¤„ç†å»ºè®®
1. éªŒè¯æ¶ˆæ¯æ ¼å¼å’Œé¡ºåº
2. æ£€æŸ¥å·¥å…·è°ƒç”¨æ ¼å¼
3. ç¡®ä¿å†…å®¹ç¬¦åˆä½¿ç”¨è§„èŒƒ
4. é€‚å½“è°ƒæ•´å‚æ•°é…ç½®

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [GLMå…¼å®¹æ€§å®ç°](../glm-compatibility.ts)
- [å…¼å®¹æ€§æ¨¡å—README](./README.md)
- [RouteCodexé…ç½®æŒ‡å—](../../../docs/CONFIG_ARCHITECTURE.md)
- [æ™ºè°±AIå®˜æ–¹æ–‡æ¡£](https://docs.bigmodel.cn/)

---

**æœ€åæ›´æ–°**: 2025-10-29
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**å…¼å®¹æ€§ç‰ˆæœ¬**: RouteCodex >= 0.2.7
